/*!
 * Name: @dsf/cli-platform
 * Version: 0.2.46-alpha.11
 * Description: 平台基础包
 * BuildTime: 2021/7/14 下午4:42:57
 */
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[1],{187:function(e,t,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}o.d(t,"a",(function(){return i}))},188:function(e,t,o){"use strict";function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e}o.d(t,"a",(function(){return n}))},475:function(e,t,o){var i=o(17),n=o(466).entries;i({target:"Object",stat:!0},{entries:function(e){return n(e)}})},946:function(e,t,o){"use strict";var i=o(187),n=o(188),s=(o(24),o(25),o(475),function(){function e(){Object(i["a"])(this,e),this.events={}}return Object(n["a"])(e,[{key:"listen",value:function(e,t){if(void 0===this.events[e])this.events[e]=[t];else{var o=this.events[e];if(!_.isArray(o))return void"请使用 on 来监听 ".concat(e," 事件");o.push(t)}}},{key:"dispatch",value:function(e,t){var o=this.events[e];o&&_.isArray(o)&&o.forEach((function(e){e(t)}))}},{key:"on",value:function(e,t){void 0===this.events[e]?this.events[e]=t:_.isArray(this.events[e])&&"请使用 listen 来监听 ".concat(e," 事件")}},{key:"emit",value:function(e,t){var o=this.events[e];o&&(_.isArray(o)||o(t))}},{key:"off",value:function(e){this.events[e]=void 0}},{key:"clear",value:function(){this.events={}}},{key:"$getAllListener",value:function(){return Object.entries(this.events)}}]),e}()),r=new s;window.$simpleEventBus=r,t["a"]=r},949:function(e,t,o){var i=o(17),n=o(21),s=o(950).f,r=n((function(){return!Object.getOwnPropertyNames(1)}));i({target:"Object",stat:!0,forced:r},{getOwnPropertyNames:s})},950:function(e,t,o){var i=o(87),n=o(186).f,s={}.toString,r="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return n(e)}catch(t){return r.slice()}};e.exports.f=function(e){return r&&"[object Window]"==s.call(e)?a(e):n(i(e))}},951:function(e,t,o){"use strict";o.d(t,"a",(function(){return s}));var i=o(187),n=o(188),s=(o(15),o(24),o(25),o(949),function(){function e(t,o){var n=this;Object(i["a"])(this,e),this.config=t,o||this.alert("url里面缺少必要的opt参数"),this.config[o]||this.alert("[".concat(this.config.name,"] url里面的opt参数没有对应的配置项")),Object.getOwnPropertyNames(this.config[o]).forEach((function(e){n[e]=n.config[o][e]}))}return Object(n["a"])(e,[{key:"alert",value:function(e){throw dsf.layer.alert({title:"警告",type:"warning",message:e}),new Error(e)}}]),e}())},982:function(e,t,o){"use strict";o.r(t);var i=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"ds-dormitory-container"},[o("left-menu",{attrs:{title:e.leftMenuTitle},scopedSlots:e._u([{key:"inner",fn:function(){return[o(e.dynamicLeft,e._b({ref:"left",tag:"component"},"component",e.commonProps,!1,!0))]},proxy:!0}])}),o("div",{staticClass:"ds-dormitory-right"},[o("div",{staticClass:"top-tool-container"},[o(e.dynamicTop,e._b({ref:"top",tag:"component"},"component",e.commonProps,!1,!0))],1),o(e.dynamicRoom,e._b({ref:"room",tag:"component"},"component",e.commonProps,!1,!0))],1)],1)},n=[];i._withStripped=!0;o(24),o(25),o(509);var s=o(946),r=(o(10),o(35),o(476),o(202),o(28),o(48),o(23),function(){_.isFunction(Date.prototype.Format)||(Date.prototype.Format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var o in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length))),t)new RegExp("("+o+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?t[o]:("00"+t[o]).substr((""+t[o]).length)));return e})}),a=function(e,t){var o=function(e,t){return t||e};return _.assignWith({},e,t,o)},l=function(e,t){if(!e||0===e.length)return[];var o=[];return e.forEach((function(e){var i=Object.assign({},e);i.roomDtos=e.roomDtos.filter((function(e){var o=t.find((function(t){return t.val===e.statusValue}));return!!o&&o.checked})),o.push(i)})),o},c=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];for(var i in t)-1===o.indexOf(i)&&(e[i]=t[i])},u=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"ds-dormitory-left"},[o("div",{staticClass:"title"},["string"===e.dsf.type(e.title)?[o("label",{staticClass:"active"},[e._v(e._s(e.title))])]:"array"===e.dsf.type(e.title)?e._l(e.title,(function(t){return o("label",{key:t.id,class:{active:e.activeOpt===t.id},on:{click:function(o){return e.labelClick(t)}}},[e._v(" "+e._s(t.title)+" ")])})):e._e()],2),e._t("inner")],2)},m=[];u._withStripped=!0;var d={name:"leftMenu",props:{title:{type:[String,Array],default:""}},computed:{activeOpt:function(){var e;return null===(e=this.$route.query)||void 0===e?void 0:e.opt}},methods:{labelClick:function(e){var t=e.query;this.$router.replace({query:t})}}},f=d,h=o(0),p=Object(h["a"])(f,u,m,!1,null,null,null);p.options.__file="pc/dormitory/room/leftMenu.vue";var v=p.exports,g=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"top-tool"},[o("div",{staticClass:"title"},[e._v(e._s(e.title))]),o("div",{staticClass:"sec-box"},[o("color-state-list",{attrs:{"room-state-list":e.roomStateList}}),o("time-range",{attrs:{"only-choose-future":!e.queryTimeCouldChooseHistory,form:e.queryTime}}),o("dsf-button",{on:{click:e.doQuery}},[e._v("搜索")])],1)])},y=[];g._withStripped=!0;var b=o(6),R=o(266),I={queryRoomList:"queryRoomList",treeNextLevel:"treeNextLevel",treeCurrent:"treeCurrent",chosenRoomCheckOut:"chosenRoomCheckOut",reserveRoomCancel:"reserveRoomCancel",restoreSelectRoom:"restoreSelectRoom",restoreAllRoom:"restoreAllRoom",autoCheckIn:"autoCheckIn",refreshGroupList:"refreshGroupList",resetOccupiedRoom:"resetOccupiedRoom",resetCheckedRoom:"resetCheckedRoom",sureRoomResource:"sureRoomResource",autoRoomResource:"autoRoomResource"},C=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"date-box"},[o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间",readonly:this.readonlyArr[0],"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm","picker-options":e.pickerOption1},on:{change:e.changeTime1},model:{value:e.form.sDate,callback:function(t){e.$set(e.form,"sDate",t)},expression:"form.sDate"}}),o("span",{staticClass:"time-divider"},[e._v("至")]),o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间",readonly:this.readonlyArr[1],"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm","picker-options":e.pickerOption2},model:{value:e.form.eDate,callback:function(t){e.$set(e.form,"eDate",t)},expression:"form.eDate"}})],1)},k=[];C._withStripped=!0;var L={name:"timeRange",props:{form:{type:Object,default:function(){return{sDate:"",eDate:""}}},readonlyArr:{type:Array,default:function(){return[!1,!1]}},onlyChooseFuture:{type:Boolean,default:!1}},data:function(){return{pickerOption1:{disabledDate:this.disabledDate1},pickerOption2:{disabledDate:this.disabledDate2}}},computed:{time1:function(){return new Date(this.form.sDate).getTime()},time2:function(){return new Date(this.form.eDate).getTime()}},methods:{disabledDate1:function(e){if(!this.onlyChooseFuture)return!1;var t=(new Date).Format("yyyy-MM-dd");t=new Date(t+" 00:00:00").getTime();var o=new Date(e).getTime();return o<t},disabledDate2:function(e){var t=new Date(e).getTime();return t<this.time1},changeTime1:function(){this.time1>=this.time2&&(this.form.eDate="")}}},S=L,D=Object(h["a"])(S,C,k,!1,null,null,null);D.options.__file="pc/dormitory/dialog/timeRange.vue";var x=D.exports,O=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ul",{staticClass:"ds-state-list"},e._l(e.roomStateList,(function(t,i){return o("li",{key:t.val},[o("label",{on:{click:function(o){return e.checkState(t,i)}}},[o("i",{style:e.getSty(t)}),o("span",[e._v(e._s(t.txt))])])])})),0)},w=[];O._withStripped=!0;o(33);var T={name:"colorStateList",props:{roomStateList:{type:Array,default:function(){return[]}},checkAble:{type:Boolean,default:!0}},created:function(){this.roomStateList.forEach((function(e){e.checked=!0}))},methods:{getSty:function(e){return{backgroundColor:e.checked?e.bgColor:"rgba(255,255,255,0)",border:e.checked?"none":"2px solid "+e.color}},checkState:function(e,t){if(this.checkAble){var o=_.cloneDeep(this.roomStateList),i=Object.assign({},e);i.checked=!i.checked,o.splice(t,1,i),this.$store.commit("dormitory/changeRoomStateList",o)}}}},F=T,j=Object(h["a"])(F,O,w,!1,null,null,null);j.options.__file="pc/dormitory/room/colorStateList.vue";var q=j.exports,N={name:"guestsTopTool",inject:["rightConfigPointer"],props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}}},computed:Object(b["a"])(Object(b["a"])({},Object(R["mapState"])("dormitory",["roomStateList"])),{},{rightConfig:function(){return this.rightConfigPointer()}}),data:function(){return{title:"",queryTimeCouldChooseHistory:!1}},components:{timeRange:x,colorStateList:q},created:function(){c(this,this.rightConfig,["roomStateList"])},methods:{doQuery:function(){s["a"].emit(I.queryRoomList)}}},A=N,V=Object(h["a"])(A,g,y,!1,null,null,null);V.options.__file="pc/dormitory/room/guestsTopTool.vue";var B=V.exports,P=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"top-tool"},[o("div",{staticClass:"title"},[e._v(e._s(e.title))]),o("color-state-list",{attrs:{"room-state-list":e.roomStateList}}),o("inline-select-box")],1),e.team?o("div",{staticClass:"msg-box"},[o("div",{staticClass:"msg"},[o("label",[e._v("当前团体：")]),o("span",[e._v(e._s(e.team.teamName))]),o("span",{staticClass:"time"},[e._v(e._s(e.team.sDate))]),e._v("至 "),o("span",{staticClass:"time"},[e._v(e._s(e.team.eDate))])])]):e._e()])},E=[];P._withStripped=!0;var M=function(){var e=this,t=e.$createElement,o=e._self._c||t;return e.showSelect?o("div",{staticClass:"select-box"},e._l(e.selectList,(function(t,i){return o("el-select",{key:i,attrs:{placeholder:t.placeholder},on:{change:function(t){return e.changeSelect(i)}},model:{value:t.value,callback:function(o){e.$set(t,"value",o)},expression:"comp.value"}},e._l(t.option,(function(e,t){return o("el-option",{key:e.buildingId,attrs:{value:e.buildingId,label:e.name}})})),1)})),1):e._e()},G=[];M._withStripped=!0;o(46),o(15);var J={name:"inlineSelectBox",inject:["rightConfigPointer"],computed:{rightConfig:function(){return this.rightConfigPointer()}},data:function(){return{selectList:[],showSelect:!1,currentSelect:null,firstTime:!0}},created:function(){var e=dsf.url.queryString("predis");c(this,this.rightConfig),"1"!==e?(this.showSelect=!0,this.selectList.forEach((function(e){e.value="",e.option=[]})),this.queryBuildList()):this.getFirstArea()},methods:{queryBuildList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,o=t+1;if(this.selectList[o]){var i={};this.currentSelect&&(i={buildingId:this.currentSelect.buildingId,type:+this.currentSelect.typeValue+1}),this.$http.get(this.apiBuildingList.url,i).done((function(t){var i,n,s=e.selectList.slice(o,o+1);1===o&&t.data.unshift({buildingId:e.selectList[o-1].value,name:"全部",typeText:"分区",typeValue:0}),2===o&&t.data.unshift({buildingId:e.selectList[o-1].value,name:"全部",typeText:"楼宇",typeValue:1}),s.option=t.data,e.selectList.splice(o,1,s),"全部"===(null===(i=e.currentSelect)||void 0===i?void 0:i.name)&&0===(null===(n=e.currentSelect)||void 0===n?void 0:n.typeValue)&&(e.selectList[2].option=[]),e.firstTime&&(e.firstTime=!1,e.selectList[0].value=t.data[0].buildingId,e.changeSelect(0))}))}},changeSelect:function(e){var t=this;this.currentSelect=this.selectList[e].option.find((function(o){return o.buildingId===t.selectList[e].value})),s["a"].emit(I.queryRoomList,this.currentSelect);for(var o=0;o<this.selectList.length;o++)if(!(o<=e)){var i=this.selectList.slice(o,o+1);i.option=[],i.value="",this.selectList.splice(o,1,i)}this.queryBuildList(e)},getFirstArea:function(){this.$http.get(this.apiBuildingList.url).done((function(e){var t=e.data[0];s["a"].emit(I.queryRoomList,t)}))}}},H=J,Q=Object(h["a"])(H,M,G,!1,null,null,null);Q.options.__file="pc/dormitory/room/inlineSelectBox.vue";var U=Q.exports,K={name:"resetGroupTopTool",inject:["rightConfigPointer"],props:{personList:{type:Array,default:function(){return[]}}},components:{colorStateList:q,inlineSelectBox:U},data:function(){return{title:"",apiBuildingList:null,btnLoading:{checkOut:!1,cancel:!1,restore:!1,restoreAll:!1,auto:!1}}},computed:Object(b["a"])(Object(b["a"])({rightConfig:function(){return this.rightConfigPointer()},predis:function(){return dsf.url.queryString("predis")}},Object(R["mapState"])("dormitory",["roomStateList","activeTeamId"])),{},{team:function(){for(var e=null,t=0;t<this.personList.length;t++){var o=this.personList[t];if(o.teamId===this.activeTeamId){e=Object.assign({},o),e.sDate=o.sDate.replace(/:\d\d$/,""),e.eDate=o.eDate.replace(/:\d\d$/,"");break}}return e}}),created:function(){c(this,this.rightConfig,["roomStateList"])},methods:{preCheckOut:function(){s["a"].emit(I.chosenRoomCheckOut,this.btnLoading)},preCancel:function(){s["a"].emit(I.reserveRoomCancel,this.btnLoading)},preRestore:function(){s["a"].emit(I.restoreSelectRoom,this.btnLoading)},preRestoreAll:function(){s["a"].emit(I.restoreAllRoom,this.btnLoading)},preAuto:function(){s["a"].emit(I.autoCheckIn,this.btnLoading)}}},z=K,W=Object(h["a"])(z,P,E,!1,null,null,null);W.options.__file="pc/dormitory/room/resetGroupTopTool.vue";var Y=W.exports,X=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-tree",{ref:"tree",attrs:{data:e.treeList,props:e.leftProps,"icon-class":"el-icon-arrow-right","current-node-key":e.currentNodeKey,"node-key":e.mid,"default-expand-all":!1,"default-expanded-keys":e.expandedKeys,accordion:""},on:{"current-change":e.currentChange,"node-collapse":e.nodeCollapse}})},Z=[];X._withStripped=!0;var ee={name:"treeList",inject:["leftConfigPointer"],props:{treeList:{type:Array,default:function(){return[]}}},data:function(){return{apiTree:null,leftProps:null,level:null,defaultChosen:null,currentNodeKey:"",expandedKeys:[]}},computed:{leftConfig:function(){return this.leftConfigPointer()},mid:function(){return this.leftProps.id},mtype:function(){return this.leftProps.type},mchildren:function(){return this.leftProps.children}},watch:{treeList:function(){var e=this;this.$nextTick((function(){var t=dsf.url.queryString("buildingId");e.currentNodeKey=t||e.defaultChosen[e.mid]}))},currentNodeKey:function(e){this.$refs.tree.setCurrentKey(e);var t=this.$refs.tree.getCurrentNode();this.$store.commit("dormitory/currentFloor",{buildingId:t[this.mid],type:t[this.mtype]})}},created:function(){c(this,this.leftConfig),this.queryTree()},mounted:function(){var e=this;s["a"].on(I.treeNextLevel,(function(t){var o,i=_.cloneDeep(e.treeList),n=function i(n){for(var s=0;s<n.length;s++){var r=n[s],a=r[e.mchildren];_.isArray(a)&&a.length>0&&(t.id===r[e.mid]&&(o=a),i(a))}};n(i),t.callback(o)})),s["a"].on(I.treeCurrent,(function(t){var o,i=_.cloneDeep(e.treeList),n=function i(n){for(var s=0;s<n.length;s++){var r=n[s],a=r[e.mchildren];t.id===r[e.mid]&&(o=r),_.isArray(a)&&a.length>0&&i(a)}};n(i),t.callback(o)}))},methods:{queryTree:function(){var e=this,t=function(t){var o,i=0,n=[],s=function t(s){for(var r=0;r<s.length;r++){var a=s[r];_.isArray(a[e.mchildren])&&a[e.mchildren].length>0?(i<e.level&&(i+=1,a.mlevel=i,n.push(a[e.mid])),i===e.level&&!o&&(o=a),t(a[e.mchildren])):(a.mlevel=i+1,a.isLeaf=!0,!o&&(o=a))}};return s(t),{expandArr:n,defaultChosen:o}};this.$http.get(this.apiTree.url).done((function(o){var i=o.data;if(_.isFunction(e.apiTree.callback)&&(i=e.apiTree.callback(i)),_.isNumber(e.level)&&e.level>0){var n=t(i);e.expandedKeys=n.expandArr,e.defaultChosen=n.defaultChosen}e.$emit("update:treeList",i)})).error((function(){dsf.layer.message("查询左侧房间列表异常",!1)}))},currentChange:function(e){this.$store.commit("dormitory/currentFloor",{buildingId:e[this.mid],type:e[this.mtype]})},nodeCollapse:function(e,t){1===t.level&&t.childNodes.forEach((function(e){e.expanded=!1}))}}},te=ee,oe=Object(h["a"])(te,X,Z,!1,null,null,null);oe.options.__file="pc/dormitory/room/treeList.vue";var ie=oe.exports,ne=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"floor-container"},[o("floor-box",{attrs:{"floor-list":e.floorList,"active-room-id":e.activeRoomId},on:{"update:activeRoomId":function(t){e.activeRoomId=t},"update:active-room-id":function(t){e.activeRoomId=t},"click-room":e.clickRoom}}),o("guests-opt-dialog",{attrs:{visible:e.guestsVisible,room:e.currentRoom,info:e.roomStatusInfo,"tree-list":e.treeList},on:{"update:visible":function(t){e.guestsVisible=t},"close-dialog":e.onCloseDialog}})],1)},se=[];ne._withStripped=!0;var re=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("el-dialog",{attrs:{visible:e.visible,width:"40%","before-close":e.beforeClose,modal:!1,"append-to-body":!0,"lock-scroll":!0,"custom-class":"dsf-dormitory-dialog"},on:{"update:visible":function(t){e.visible=t},close:e.guestsClose},scopedSlots:e._u([{key:"title",fn:function(){return[o("div",{staticClass:"plain-title"},[o("span",[e._v("房间："+e._s(e.info.roomName))]),o("span",[e._v("房间床位："+e._s(e.info.emptyBedNum))])])]},proxy:!0},{key:"footer",fn:function(){return[o("div",{staticClass:"dialog-footer"},[o("el-button",{on:{click:e.closeDialog}},[e._v("确 定")])],1)]},proxy:!0}])},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingOccupyInfo,expression:"loadingOccupyInfo"}],staticClass:"list-box"},e._l(e.list,(function(t,i){return o("div",{key:i,staticClass:"item"},[o("i",{staticClass:"ico-point"}),o("p",[e._v(e._s(t.timeStr))]),o("ul",[e._l(t.person,(function(t,i){return o("li",{key:t.relId},[o("p",[e._v(" "+e._s(t.typeStr)+"："+e._s(t.personName)+"[ "+e._s(t.sexText)+" ] ")]),o("p",[e._v(" "+e._s(t.phone)+" ")]),o("p",[1===t.type?[e.isReserveModule?e._e():o("span",{on:{click:function(o){return e.renewal(t)}}},[e._v("续房")]),o("span",{on:{click:function(o){return e.checkOut(t)}}},[e._v("退房")]),t.past?e._e():o("span",{on:{click:function(o){return e.changeRoom(t)}}},[e._v("换房")])]:e._e(),0!==t.type||e.isReserveModule?e._e():[o("span",{on:{click:function(o){return e.checkIn(t)}}},[e._v("入住")]),o("span",{on:{click:function(o){return e.cancelReserve(t)}}},[e._v("取消预定")])],2!==t.type||e.isReserveModule?e._e():[o("span",{on:{click:e.reserve}},[e._v("预定")]),o("span",{on:{click:e.checkIn}},[e._v("入住")])]],2)])})),e._l(t.release,(function(i,n){return o("li",{key:n},[o("p",[e._v("未入住：")]),o("p"),0===e.info.statusValue||e.isReserveModule?o("p",[o("span",{staticClass:"warning"},[e._v("当前房间不可排")])]):o("p",[o("span",{on:{click:function(o){return e.reserve(t)}}},[e._v("预定")]),o("span",{on:{click:function(o){return e.checkIn(t)}}},[e._v("入住")])])])}))],2)])})),0)]),o("action-dialog",{attrs:{visible:e.checkInVisible,title:"入住"},on:{"update:visible":function(t){e.checkInVisible=t},save:e.checkInSave,"dialog-close":function(t){return e.closeFormDialog("checkInForm")}},scopedSlots:e._u([{key:"body",fn:function(){return[o("el-form",{ref:"checkInForm",attrs:{model:e.checkInForm,rules:e.formRules,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"姓名",prop:"personName"}},[o("el-input",{model:{value:e.checkInForm.personName,callback:function(t){e.$set(e.checkInForm,"personName",t)},expression:"checkInForm.personName"}})],1),o("el-form-item",{attrs:{label:"身份证号",prop:"idCard"}},[o("el-input",{model:{value:e.checkInForm.idCard,callback:function(t){e.$set(e.checkInForm,"idCard",t)},expression:"checkInForm.idCard"}})],1),o("el-form-item",{attrs:{label:"联系方式",prop:"phone"}},[o("el-input",{model:{value:e.checkInForm.phone,callback:function(t){e.$set(e.checkInForm,"phone",t)},expression:"checkInForm.phone"}})],1),o("el-form-item",{attrs:{label:"入住时间"}},[o("div",{staticClass:"date-box"},[o("span",[e._v(e._s(e.checkInForm.sDate))]),o("span",{staticClass:"text-divider"},[e._v("至")]),o("span",[e._v(e._s(e.checkInForm.eDate))])])])],1)]},proxy:!0}])}),o("action-dialog",{attrs:{visible:e.reserveVisible,title:"预定"},on:{"update:visible":function(t){e.reserveVisible=t},save:e.reserveSave,"dialog-close":function(t){return e.closeFormDialog("reserveForm")}},scopedSlots:e._u([{key:"body",fn:function(){return[o("el-form",{ref:"reserveForm",attrs:{model:e.reserveForm,rules:e.formRules,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"姓名",prop:"personName"}},[o("el-input",{model:{value:e.reserveForm.personName,callback:function(t){e.$set(e.reserveForm,"personName",t)},expression:"reserveForm.personName"}})],1),o("el-form-item",{attrs:{label:"身份证号",prop:"idCard"}},[o("el-input",{model:{value:e.reserveForm.idCard,callback:function(t){e.$set(e.reserveForm,"idCard",t)},expression:"reserveForm.idCard"}})],1),o("el-form-item",{attrs:{label:"联系方式",prop:"phone"}},[o("el-input",{model:{value:e.reserveForm.phone,callback:function(t){e.$set(e.reserveForm,"phone",t)},expression:"reserveForm.phone"}})],1),o("el-form-item",{attrs:{label:"预定时间"}},[o("div",{staticClass:"date-box"},[o("span",[e._v(e._s(e.reserveForm.sDate))]),o("span",{staticClass:"text-divider"},[e._v("至")]),o("span",[e._v(e._s(e.reserveForm.eDate))])])])],1)]},proxy:!0}])}),o("action-dialog",{attrs:{visible:e.renewalVisible,title:"续房"},on:{"update:visible":function(t){e.renewalVisible=t},save:e.renewalSave,"dialog-close":function(t){return e.closeFormDialog("renewalForm")}},scopedSlots:e._u([{key:"body",fn:function(){return[o("el-form",{ref:"renewalForm",attrs:{model:e.renewalForm,rules:e.formRules,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"姓名",prop:"personName"}},[o("el-input",{attrs:{readonly:!0},model:{value:e.renewalForm.personName,callback:function(t){e.$set(e.renewalForm,"personName",t)},expression:"renewalForm.personName"}})],1),o("el-form-item",{attrs:{label:"身份证号",prop:"idCard"}},[o("el-input",{attrs:{readonly:!0},model:{value:e.renewalForm.idCard,callback:function(t){e.$set(e.renewalForm,"idCard",t)},expression:"renewalForm.idCard"}})],1),o("el-form-item",{staticClass:"justify",attrs:{label:"原入住时间"}},[o("time-range",{attrs:{form:e.renewalForm,"readonly-arr":[!0,!0]}})],1),o("el-form-item",{staticClass:"justify",attrs:{label:"续房入住时间",prop:"eDate"}},[o("time-range",{attrs:{form:e.newTimeForm,"readonly-arr":[!0,!1]}})],1)],1)]},proxy:!0}])}),o("action-dialog",{attrs:{visible:e.changeRoomVisible,title:"换房",width:"80%","show-close":!1,top:"8vh"},on:{"update:visible":function(t){e.changeRoomVisible=t},save:e.changeRoomSave},scopedSlots:e._u([{key:"topTool",fn:function(){return[o("el-form",{attrs:{inline:!0}},[o("el-form-item",{attrs:{label:e.inlineForm[0].label}},[o("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.changeSelect(0)}},model:{value:e.inlineForm[0].value,callback:function(t){e.$set(e.inlineForm[0],"value",t)},expression:"inlineForm[0].value"}},e._l(e.treeList,(function(t,i){return o("el-option",{key:t[e.mid],attrs:{value:t[e.mid],label:t[e.mlabel]}})})),1)],1),o("el-form-item",{attrs:{label:e.inlineForm[1].label}},[o("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.changeSelect(1)}},model:{value:e.inlineForm[1].value,callback:function(t){e.$set(e.inlineForm[1],"value",t)},expression:"inlineForm[1].value"}},e._l(e.selectList1,(function(t,i){return o("el-option",{key:t[e.mid],attrs:{value:t[e.mid],label:t[e.mlabel]}})})),1)],1),o("el-form-item",{attrs:{label:e.inlineForm[2].label}},[o("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.changeSelect(2)}},model:{value:e.inlineForm[2].value,callback:function(t){e.$set(e.inlineForm[2],"value",t)},expression:"inlineForm[2].value"}},e._l(e.selectList2,(function(t,i){return o("el-option",{key:t[e.mid],attrs:{value:t[e.mid],label:t[e.mlabel]}})})),1)],1),o("el-form-item",{attrs:{label:"房间"}},[o("el-input",{model:{value:e.queryRoomName,callback:function(t){e.queryRoomName=t},expression:"queryRoomName"}})],1),o("el-form-item",[o("dsf-button",{on:{click:e.reloadQuery}},[e._v("重 置")]),o("dsf-button",{attrs:{icon:"sousuo"},on:{click:e.queryRoomList}})],1)],1),o("div",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"time-item"},[o("label",[e._v("时间")]),o("time-range",{attrs:{form:e.newTimeForm}})],1)]},proxy:!0},{key:"floorBox",fn:function(){return[o("floor-box",{attrs:{"floor-list":e.floorList,"active-room-id":e.activeRoomId},on:{"update:activeRoomId":function(t){e.activeRoomId=t},"update:active-room-id":function(t){e.activeRoomId=t}}})]},proxy:!0}])})],1)},ae=[];re._withStripped=!0;o(63),o(16),o(267);var le=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{visible:e.visible,width:e.width,"before-close":e.closeDialog,"append-to-body":!0,"lock-scroll":!0,"custom-class":"dsf-dormitory-dialog action-dialog","show-close":e.showClose,top:e.top},on:{"update:visible":function(t){e.visible=t}},scopedSlots:e._u([{key:"title",fn:function(){return[o("div",{staticClass:"bg-title"},[o("span",[e._v(e._s(e.title))]),o("div",{staticClass:"top-tool"},[e._t("topTool")],2)])]},proxy:!0},e.noFooter?null:{key:"footer",fn:function(){return[o("div",{staticClass:"action-footer"},[o("dsf-button",{on:{click:e.closeDialog}},[e._v("关 闭")]),o("dsf-button",{attrs:{loading:e.btnLoading.save},on:{click:e.save}},[e._v("保 存")])],1)]},proxy:!0}],null,!0)},[o("div",{staticClass:"custom-body"},[e._t("body")],2),e._t("inner"),o("div",{staticClass:"floor-container"},[e._t("floorBox")],2)],2)},ce=[];le._withStripped=!0;var ue={name:"actionDialog",props:{title:{type:String,required:!0},visible:{type:Boolean,default:!1,required:!0},width:{type:String,default:"40%"},showClose:{type:Boolean,default:!0},top:{type:String,default:"15vh"},noFooter:{type:Boolean,default:!1}},data:function(){return{btnLoading:{save:!1}}},methods:{closeDialog:function(){this.$emit("dialog-close"),this.$emit("update:visible",!1)},save:function(){this.$emit("save",this.btnLoading)}}},me=ue,de=Object(h["a"])(me,le,ce,!1,null,null,null);de.options.__file="pc/dormitory/dialog/actionDialog.vue";var fe=de.exports,he=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",e._l(e.floorList,(function(t,i){return o("div",{key:i,staticClass:"floor-box"},[o("div",{staticClass:"floor-title"},[e.multipleChoose?o("div",{staticClass:"check-box",on:{click:function(o){return o.stopPropagation(),e.checkAll(t)}}},[o("i",{staticClass:"iconfont",class:e.pCheckCss(t)}),o("span",[e._v("全选")])]):e._e(),o("span",[e._v(e._s(t.buildingText)+" / "+e._s(t.title))]),o("span",[e._v("（")]),o("span",{staticClass:"it"},[e._v("单间："+e._s(t.single))]),o("span",{staticClass:"it"},[e._v("标间："+e._s(t.standard))]),o("span",{staticClass:"it"},[e._v("套房："+e._s(t.suite))]),o("span",{staticClass:"it"},[e._v("多人间："+e._s(t.mul))]),o("span",[e._v("）")])]),o("div",{staticClass:"room-container",on:{click:e.emptyPlace}},[e._l(t[e.mchildren],(function(t,i){return o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.judgeLoading(t[e.mroomId]),expression:"judgeLoading(room[mroomId])"}],key:i,staticClass:"room",class:e.roomCss(t),style:e.roomSty(t),attrs:{"data-id":t[e.mroomId]},on:{click:function(o){return o.stopPropagation(),e.clickRoom(t)}}},[e.roomCheckbox?o("div",{staticClass:"check-box",on:{click:function(o){return o.stopPropagation(),e.checkRoom(t)}}},[o("i",{staticClass:"iconfont",class:e.checkCss(t)})]):e._e(),o("div",{staticClass:"num",style:e.numSty(t)},[e._v(e._s(t[e.mroomNum]))]),o("div",{staticClass:"inner"},[o("p",[e._v(e._s(t.purposeText))]),o("p",[o("i",{directives:[{name:"show",rawName:"v-show",value:e.isAllocatedRoom(t.reserveId),expression:"isAllocatedRoom(room.reserveId)"}],staticClass:"iconfont icon-dui1"}),e._v(e._s(t.roomText))]),t.sexValue?1===parseInt(t.sexValue)?o("p",[e._v("女性")]):0===parseInt(t.sexValue)?o("p",[e._v("男性")]):e._e():o("p",[e._v("不限")])])])})),e._l(e.appendOcc,(function(e){return o("div",{key:i+"_"+e,staticClass:"occ"})}))],2)])})),0)},pe=[];he._withStripped=!0;o(185),o(196),o(20),o(949),o(52);var ve={inject:["rightConfigPointer"],name:"floorBox",props:{floorList:{type:Array,default:function(){return[]}},chosenRoomId:{type:Array,default:function(){return[]}},multipleChoose:{type:Boolean,default:!1},loadingRoomId:{type:Array,default:function(){return[]}},activeRoomId:{type:String,default:""}},data:function(){return{apiRoomStatus:null,roomCheckbox:!0,appendOcc:[]}},computed:{rightConfig:function(){return this.rightConfigPointer()},stateList:function(){for(var e={},t=0;t<this.rightConfig.roomStateList.length;t++){var o=this.rightConfig.roomStateList[t];e[o.val]=o}return e},mchildren:function(){return this.apiRoomStatus.childrenAlias},mroomNum:function(){return this.apiRoomStatus.roomNumAlias},mroomId:function(){return this.apiRoomStatus.roomIdAlias}},watch:{floorList:function(e){var t=this;this.stateRoomObj(e),this.$nextTick((function(){t.resize()}))},loadingRoomId:function(){var e=_.difference(this.chosenRoomId,this.loadingRoomId);this.$emit("update:chosenRoomId",e)},chosenRoomId:function(e){this.$store.commit("dormitory/chosenRoomId",e)}},created:function(){c(this,this.rightConfig)},methods:{isAllocatedRoom:function(e){var t=this.$route.query.opt;return"allocation"===t&&e===this.$route.query.reserveId},judgeLoading:function(e){return this.loadingRoomId.includes(e)},roomCss:function(e){return{chosen:this.chosenRoomId.includes(e[this.mroomId]),active:this.activeRoomId===e[this.mroomId]}},pCheckCss:function(e){for(var t=0,o=0;o<e[this.mchildren].length;o++)for(var i=e[this.mchildren][o],n=i[this.mroomId],s=0;s<this.chosenRoomId.length;s++){var r=this.chosenRoomId[s];if(n===r){t+=1;break}}return e.isAllCheck=t===e[this.mchildren].length,e.isAllCheck?"icon-kongjianyixuan":"icon-kongjianweixuan"},checkCss:function(e){return this.chosenRoomId.includes(e[this.mroomId])?"icon-kongjianyixuan":"icon-kongjianweixuan"},roomSty:function(e){var t,o,i,n,s=(null===(t=this.stateList[e.statusValue])||void 0===t?void 0:t.color)||"#000000",r=this.chosenRoomId.includes(e[this.mroomId])||this.activeRoomId===e[this.mroomId];return n=r?"4px solid "+s:"none",{background:(null===(o=this.stateList[e.statusValue])||void 0===o?void 0:o.bgColor)||"#555555",color:(null===(i=this.stateList[e.statusValue])||void 0===i?void 0:i.color)||"#000000",border:n}},numSty:function(e){var t;return{background:(null===(t=this.stateList[e.statusValue])||void 0===t?void 0:t.color)||"#000000"}},checkAll:function(e){var t=this,o=this.chosenRoomId.slice(0),i={},n=[];if(e.isAllCheck)for(var s in o.forEach((function(e){i[e]=e})),e[this.mchildren].forEach((function(e){i[e[t.mroomId]]&&(i[e[t.mroomId]]=!1)})),i)i[s]&&n.push(s);else{var r=e[this.mchildren].map((function(e){return e[t.mroomId]}));o.concat(r).forEach((function(e){i[e]=e})),n=Object.getOwnPropertyNames(i)}this.$emit("update:chosenRoomId",n)},clickRoom:function(e){this.loadingRoomId.includes(e[this.mroomId])||(this.$emit("update:activeRoomId",e[this.mroomId]),this.$emit("click-room",e))},resize:function(){var e=$(".room-container").width(),t=$(".room").width()+30,o=_.floor(e/t);if(o!==this.appendOcc.length){for(var i=[],n=0;n<o;n++)i.push(n);this.appendOcc=i}},emptyPlace:function(){this.$emit("update:activeRoomId","")},stateRoomObj:function(e){for(var t={},o=this.mroomId,i=this.mchildren,n=0;n<e.length;n++)for(var s=e[n],r=0;r<s[i].length;r++){var a=s[i][r];t[a[o]]=a}this.$store.commit("dormitory/roomObj",t)},checkRoom:function(e){var t=this;if(!this.loadingRoomId.includes(e[this.mroomId]))if(this.multipleChoose){var o=this.chosenRoomId.findIndex((function(o){return o===e[t.mroomId]}));-1===o?this.chosenRoomId.push(e[this.mroomId]):this.chosenRoomId.splice(o,1)}else this.$emit("update:chosenRoomId",[e[this.mroomId]])}},mounted:function(){var e=this;this.$nextTick((function(){window.addEventListener("resize",_.debounce((function(){e.resize()}),100))}))}},ge=ve,ye=Object(h["a"])(ge,he,pe,!1,null,null,null);ye.options.__file="pc/dormitory/room/floorBox.vue";var be=ye.exports,Re={name:"guestsOptDialog",inject:["leftConfigPointer","rightConfigPointer"],props:{info:{type:Object,default:function(){return{roomName:"",emptyBedNum:"",roomId:"",sDate:"",eDate:"",statusValue:null}}},visible:{type:Boolean,default:!1,required:!0},room:{type:Object},treeList:{type:Array,default:function(){return[]}}},components:{actionDialog:fe,floorBox:be,timeRange:x},data:function(){return{apiRoomStatus:null,apiRoomOccupyInfo:null,apiCheckIn:null,apiCheckOut:null,apiRenewal:null,apiReserve:null,apiCancelReserve:null,apiChangeRoom:null,checkInVisible:!1,checkInForm:{},reserveVisible:!1,reserveForm:{},renewalVisible:!1,renewalForm:{},formRules:{personName:[{required:!0,message:"请输入姓名"}],idCard:[{required:!0,validator:function(e,t,o){return t?dsf.validate("isIDCard",t)?void o():o(new Error("身份证号格式不正确")):o(new Error("请输入身份证"))},trigger:["blur"]}],phone:[{required:!0,validator:function(e,t,o){return t?dsf.validate("isMobile",t)?void o():o(new Error("手机号码格式不正确")):o(new Error("请输入手机号码"))},trigger:["blur"]},{}]},newTimeForm:{},changeRoomVisible:!1,queryInfo:{},list:[],isDataChanged:!1,selectList1:[],selectList2:[],inlineForm:[],originInlineForm:[],queryRoomName:"",currentSelectFloor:null,floorList:[],activeRoomId:"",loadingOccupyInfo:!0}},computed:Object(b["a"])(Object(b["a"])({},Object(R["mapGetters"])("dormitory",["roomStateDict"])),{},{leftConfig:function(){return this.leftConfigPointer()},rightConfig:function(){return this.rightConfigPointer()},mid:function(){return this.leftConfig.leftProps.id},mlabel:function(){return this.leftConfig.leftProps.label},mtype:function(){return this.leftConfig.leftProps.type},mroomId:function(){return this.apiRoomStatus.roomIdAlias},isReserveModule:function(){return 1==dsf.config.setting_sgcp_reserve&&this.room.reserveId}}),watch:{visible:function(e){e&&this.queryRoomOccupyInfo()}},created:function(){c(this,this.rightConfig),this.inlineForm=this.leftConfig.inlineForm,this.originInlineForm=_.cloneDeep(this.leftConfig.inlineForm)},methods:{changeSelect:function(e){var t=this,o=e;while(t["selectList"+(o+1)])t["selectList"+(o+1)]=[],t.inlineForm[o+1].value="",o++;var i={id:t.inlineForm[e].value,callback:function(e){t.currentSelectFloor=e,t.queryRoomList()}};s["a"].emit(I.treeCurrent,i);var n={id:t.inlineForm[e].value,callback:function(o){t["selectList"+(e+1)]=o}};s["a"].emit(I.treeNextLevel,n)},closeDialog:function(){this.$emit("update:visible",!1)},beforeClose:function(){this.closeDialog(),this.room.chosen=!1},renewal:function(e){var t=new Date(e.edate).getTime()+1e3,o=new Date(t);this.renewalForm={personName:e.personName,phone:e.phone,idCard:e.idCard,occupyId:e.occupyId,sDate:e.sdate,eDate:e.edate},this.newTimeForm={sDate:o,eDate:""},this.renewalVisible=!0},renewalSave:function(e){var t=this;this.$refs.renewalForm.validate().then((function(){if(t.newTimeForm.eDate){e.save=!0;var o={occupyId:t.renewalForm.occupyId,lastDate:t.renewalForm.eDate,curDate:t.newTimeForm.eDate,roomId:t.info.roomId};t.$http.post(t.apiRenewal.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(t.isDataChanged=!0,t.renewalVisible=!1,dsf.layer.message("续房成功"),t.queryRoomOccupyInfo()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("续房失败",!1)})).always((function(){setTimeout((function(){e.save=!1}),700)}))}else dsf.layer.message("请选择续房入住结束时间",!1)})).catch((function(e){}))},checkIn:function(e){var t,o;Ie(e,"edate")?dsf.layer.message("入住时间不能小于当前时间",!1):(this.checkInForm={personName:null===e||void 0===e?void 0:e.personName,idCard:null===e||void 0===e?void 0:e.idCard,phone:null===e||void 0===e?void 0:e.phone,sDate:null===e||void 0===e||null===(t=e.sdate)||void 0===t?void 0:t.replace(/:\d\d$/,""),eDate:null===e||void 0===e||null===(o=e.edate)||void 0===o?void 0:o.replace(/:\d\d$/,""),reserveId:null===e||void 0===e?void 0:e.relId,roomId:this.info.roomId},this.checkInVisible=!0)},checkInSave:function(e){var t=this;this.$refs.checkInForm.validate().then((function(){e.save=!0,t.$http.post(t.apiCheckIn.url,JSON.stringify(t.checkInForm),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(t.isDataChanged=!0,t.checkInVisible=!1,dsf.layer.message("入住成功"),t.queryRoomOccupyInfo()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("发生未知错误，入住失败",!1)})).always((function(){setTimeout((function(){e.save=!1}),700)}))})).catch((function(e){}))},checkOut:function(e){var t=this;dsf.layer.confirm({message:"您确定要退房吗？",type:"warning",customClass:"el-message-box-center"}).then((function(){var o={roomId:t.info.roomId,occupyId:e.relId};t.$http.post(t.apiCheckOut.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(t.isDataChanged=!0,dsf.layer.message("退房成功"),t.queryRoomOccupyInfo()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("退房失败",!1)}))})).catch((function(e){}))},reserve:function(e){var t,o;Ie(e,"edate")?dsf.layer.message("预定时间不能小于当前时间",!1):(this.reserveForm={personName:"",idCard:"",phone:"",sexValue:e.sexValue,sexText:e.sexText,sDate:null===e||void 0===e||null===(t=e.sdate)||void 0===t?void 0:t.replace(/:\d\d$/,""),eDate:null===e||void 0===e||null===(o=e.edate)||void 0===o?void 0:o.replace(/:\d\d$/,""),reserveId:null===e||void 0===e?void 0:e.relId,roomId:this.info.roomId},this.reserveVisible=!0)},reserveSave:function(e){var t=this;this.$refs.reserveForm.validate().then((function(){e.save=!0,t.$http.post(t.apiReserve.url,JSON.stringify(t.reserveForm),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(t.isDataChanged=!0,t.reserveVisible=!1,dsf.layer.message("预约成功"),t.queryRoomOccupyInfo()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("发生未知错误，预约失败",!1)})).always((function(){setTimeout((function(){e.save=!1}),700)}))})).catch((function(e){}))},cancelReserve:function(e){Ie(e,"sdate")?dsf.layer.message("当前时间已超过可取消预定最晚时间",!1):dsf.layer.message("该功能尚未完成",!1)},reloadQuery:function(){this.inlineForm=_.cloneDeep(this.originInlineForm),this.selectList1=[],this.selectList2=[],this.queryRoomName="",this.inlineForm[0].value=this.treeList[0][this.mid],this.changeSelect(0)},changeRoom:function(e){var t=(new Date).Format("yyyy-MM-dd hh:mm:ss");this.newTimeForm={sDate:t,eDate:e.edate,occupyId:e.occupyId},this.floorList=[],this.activeRoomId="",this.changeRoomVisible=!0,this.inlineForm[0].value=this.treeList[0][this.mid],this.changeSelect(0)},queryRoomOccupyInfo:function(){var e=this;this.loadingOccupyInfo=!0;var t={roomId:this.info.roomId,sDate:this.info.sDate,eDate:this.info.eDate};this.$http.get(this.apiRoomOccupyInfo.url,t).done((function(t){var o=t.data;_.isFunction(e.apiRoomOccupyInfo.callback)&&(o=e.apiRoomOccupyInfo.callback(o)),e.list=o})).always((function(){e.loadingOccupyInfo=!1}))},guestsClose:function(){this.$emit("close-dialog",this.isDataChanged)},queryRoomList:function(){var e=this,t={buildingId:this.currentSelectFloor[this.mid],type:this.currentSelectFloor[this.mtype],sDate:this.newTimeForm.sDate,eDate:this.newTimeForm.eDate,name:this.queryRoomName};this.$http.get(this.apiRoomStatus.url,t).done((function(t){e.activeRoomId="",t.success?e.floorList=t.data.map((function(t){return t.roomDtos=t.roomDtos.filter((function(t){return t.statusValue===e.roomStateDict.normal||t.statusValue===e.roomStateDict.some})),t})):e.floorList=[]}))},changeRoomSave:function(e){var t=this;if(this.activeRoomId){e.save=!0;var o={occupyId:this.newTimeForm.occupyId,roomId:this.activeRoomId};this.$http.post(this.apiChangeRoom.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(t.isDataChanged=!0,t.changeRoomVisible=!1,dsf.layer.message("换房成功"),t.queryRoomOccupyInfo()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("换房失败",!1)})).always((function(){setTimeout((function(){e.save=!1}),700)}))}else dsf.layer.message("请先选择要换房的房间",!1)},closeFormDialog:function(e){this.$refs[e].clearValidate()}},mounted:function(){}};function Ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"edate";if(!e)return!1;var o=(new Date).Format("yyyy-MM-dd hh:mm:00"),i=e[t].replace(/:\d\d$/g,"")+":00",n=new Date(o).getTime(),s=new Date(i).getTime();return n>s}var _e=Re,Ce=Object(h["a"])(_e,re,ae,!1,null,null,null);Ce.options.__file="pc/dormitory/dialog/guestsOptDialog.vue";var ke=Ce.exports,Le={name:"roomBox",inject:["rightConfigPointer"],props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}},treeList:{type:Array}},data:function(){return{apiRoomStatus:null,originFloorList:[],guestsVisible:!1,currentRoom:null,roomStatusInfo:{},activeRoomId:""}},computed:Object(b["a"])({rightConfig:function(){return this.rightConfigPointer()},mchildren:function(){return this.apiRoomStatus.childrenAlias},mroomNum:function(){return this.apiRoomStatus.roomNumAlias},mroomId:function(){return this.apiRoomStatus.roomIdAlias},floorList:function(){return l(this.originFloorList,this.roomStateList)}},Object(R["mapState"])("dormitory",["currentFloor","roomStateList"])),components:{guestsOptDialog:ke,floorBox:be},watch:{currentFloor:function(){this.queryRoomList()}},created:function(){c(this,this.rightConfig,["roomStateList"])},mounted:function(){var e=this;s["a"].on(I.queryRoomList,(function(){e.queryRoomList()}))},methods:{clickRoom:function(e){this.currentRoom=e,this.popGuests()},popGuests:function(){this.roomStatusInfo=Object(b["a"])({roomId:this.currentRoom[this.mroomId],roomName:this.currentRoom[this.mroomNum],emptyBedNum:this.currentRoom.beds,statusValue:this.currentRoom.statusValue},this.queryTime),this.guestsVisible=!0},queryRoomList:function(){var e=this,t=Object(b["a"])({},this.currentFloor);if(_.isFunction(this.apiRoomStatus.query)){var o=this.apiRoomStatus.query();t=a(t,o)}t=Object.assign({},t,this.queryTime),this.$http.get(this.apiRoomStatus.url,t).done((function(t){e.originFloorList=t.success?t.data:[],e.activeRoomId=""}))},onCloseDialog:function(e){this.chosenRoomId="",e&&this.queryRoomList()}}},Se=Le,De=Object(h["a"])(Se,ne,se,!1,null,null,null);De.options.__file="pc/dormitory/room/roomBox.vue";var xe=De.exports,Oe=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"top-tool"},[o("div",{staticClass:"title"},[e._v(e._s(e.title))]),o("div",{staticClass:"sec-box"},[o("dsf-button",{attrs:{loading:e.btnLoading.checkOut},on:{click:e.preCheckOut}},[e._v("已选房间退房")]),"1"===e.predis?o("dsf-button",{attrs:{loading:e.btnLoading.cancel},on:{click:e.preCancel}},[e._v("预约房取消")]):e._e(),o("dsf-button",{attrs:{loading:e.btnLoading.restore},on:{click:e.preRestore}},[e._v("重置已选房间")]),o("dsf-button",{attrs:{loading:e.btnLoading.restoreAll},on:{click:e.preRestoreAll}},[e._v("重置全部")]),o("dsf-button",{attrs:{loading:e.btnLoading.auto},on:{click:e.preAuto}},[e._v("自动排房")])],1)]),o("div",{staticClass:"state-box"},[o("color-state-list",{attrs:{"room-state-list":e.roomStateList}}),o("inline-select-box")],1),e.team?o("div",{staticClass:"msg-box"},[o("div",{staticClass:"msg"},[o("label",[e._v("当前团体：")]),o("span",[e._v(e._s(e.team.teamName))]),o("span",{staticClass:"time"},[e._v(e._s(e.team.sDate))]),e._v("至 "),o("span",{staticClass:"time"},[e._v(e._s(e.team.eDate))])])]):e._e()])},we=[];Oe._withStripped=!0;var Te={name:"groupTopTool",inject:["dormitoryRoot","rightConfigPointer"],props:{personList:{type:Array,default:function(){return[]}}},components:{colorStateList:q,inlineSelectBox:U},data:function(){return{title:"",apiBuildingList:null,btnLoading:{checkOut:!1,cancel:!1,restore:!1,restoreAll:!1,auto:!1}}},computed:Object(b["a"])(Object(b["a"])({rightConfig:function(){return this.rightConfigPointer()},predis:function(){return dsf.url.queryString("predis")}},Object(R["mapState"])("dormitory",["roomStateList","activeTeamId"])),{},{team:function(){for(var e=null,t=0;t<this.personList.length;t++){var o=this.personList[t];if(o.teamId===this.activeTeamId){e=Object.assign({},o),e.sDate=o.sDate.replace(/:\d\d$/,""),e.eDate=o.eDate.replace(/:\d\d$/,"");break}}return e}}),created:function(){c(this,this.rightConfig,["roomStateList"])},methods:{preCheckOut:function(){s["a"].emit(I.chosenRoomCheckOut,this.btnLoading)},preCancel:function(){s["a"].emit(I.reserveRoomCancel,this.btnLoading)},preRestore:function(){s["a"].emit(I.restoreSelectRoom,this.btnLoading)},preRestoreAll:function(){var e,t=null===(e=this.dormitoryRoot.$refs.room)||void 0===e?void 0:e.floorList;1!=dsf.config.setting_sgcp_reserve||null!==t&&void 0!==t&&t.length?s["a"].emit(I.restoreAllRoom,this.btnLoading):dsf.layer.message("该团体未分配房源，无法重置全部",!1)},preAuto:function(){s["a"].emit(I.autoCheckIn,this.btnLoading)}}},Fe=Te,$e=Object(h["a"])(Fe,Oe,we,!1,null,null,null);$e.options.__file="pc/dormitory/room/groupTopTool.vue";var je=$e.exports,qe=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"group-list-warp"},[o("el-collapse",{attrs:{value:e.activeTeamId,accordion:e.accordion},on:{change:e.changeCollapse}},e._l(e.personList,(function(t,i){return o("el-collapse-item",{key:t.teamId,attrs:{title:t.teamName,name:t.teamId}},[o("div",{staticClass:"group-person-box"},[o("ul",[e._l(t.boyList,(function(t,i){return o("li",{key:t.personId,attrs:{"data-id":t.personId,"data-name":t.personName}},[t.headImg?o("img",{attrs:{src:t.headImg,alt:"男性头像"}}):o("i",{staticClass:"icon-boy-head"}),o("span",[e._v(e._s(t.personName))])])})),t.boyList&&0!==t.boyList.length?e._e():o("div",[e._v("（已排完）")])],2),o("ul",[e._l(t.girlList,(function(t,i){return o("li",{key:t.personId,attrs:{"data-id":t.personId,"data-name":t.personName}},[t.headImg?o("img",{attrs:{src:t.headImg,alt:"女性头像"}}):o("i",{staticClass:"icon-girl-head"}),o("span",[e._v(e._s(t.personName))])])})),t.girlList&&0!==t.girlList.length?e._e():o("div",[e._v("（已排完）")])],2)])])})),1)],1)},Ne=[];qe._withStripped=!0;var Ae={inject:["leftConfigPointer"],name:"groupList",props:{personObj:{type:Object,default:function(){return{}}},personList:{type:Array,default:function(){return[]}}},data:function(){return{apiGroupList:null,accordion:null}},computed:Object(b["a"])({leftConfig:function(){return this.leftConfigPointer()},sexRule:function(){return this.apiGroupList.sexRule}},Object(R["mapState"])("dormitory",["activeTeamId"])),watch:{personList:function(e){var t=this,o={};if(!e||0===e.length)return o;for(var i=0;i<e.length;i++){var n=e[i];if(n.person)for(var s=0;s<n.person.length;s++){var r=n.person[s];if(o[r.personId])return void dsf.layer.alert("团体人员列表，人员 personId 有重复的");o[r.personId]=r}}this.$emit("update:personObj",o),this.activeTeamId||this.$store.commit("dormitory/activeTeamId",e[0].teamId),this.$nextTick((function(){t.createInteraction()}))}},created:function(){c(this,this.leftConfig),this.queryList()},mounted:function(){var e=this;s["a"].on(I.refreshGroupList,(function(){e.queryList()}))},methods:{reset:function(){this.queryList()},queryList:function(){var e=this,t={};if(_.isFunction(this.apiGroupList.query)){var o=this.apiGroupList.query();t=a(t,o)}this.$http.get(this.apiGroupList.url,t).done((function(t){var o=t.data;_.isFunction(e.apiGroupList.callback)&&(o=e.apiGroupList.callback(o));for(var i=0;i<o.length;i++){var n=o[i];if(n.boyList=[],n.girlList=[],_.isArray(n.person))for(var s=0;s<n.person.length;s++){var r=n.person[s];1!==r.occupy&&(r.sexValue===e.sexRule.male&&n.boyList.push(r),r.sexValue===e.sexRule.female&&n.girlList.push(r))}}e.$emit("update:personList",o)}))},changeCollapse:function(e){this.$store.commit("dormitory/activeTeamId",e),this.createInteraction()},createInteraction:function(){$(".group-person-box li").draggable({addClasses:!1,start:function(e){},helper:function(){var e=$(this).data("name"),t=$(this).data("id");return $('<div class="drag-item" data-id='.concat(t,">").concat(e,"</div>"))},cursor:"default",cursorAt:{top:-5,left:-5},stop:function(e,t){}})}}},Ve=Ae,Be=Object(h["a"])(Ve,qe,Ne,!1,null,null,null);Be.options.__file="pc/dormitory/room/groupList.vue";var Pe=Be.exports,Ee=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"floor-container group"},[o("floor-box",{attrs:{"multiple-choose":!0,"floor-list":e.floorList,"chosen-room-id":e.chosenRoomId,"active-room-id":e.activeRoomId,"loading-room-id":e.loadingRoomId},on:{"update:chosenRoomId":function(t){e.chosenRoomId=t},"update:chosen-room-id":function(t){e.chosenRoomId=t},"update:activeRoomId":function(t){e.activeRoomId=t},"update:active-room-id":function(t){e.activeRoomId=t},"click-room":e.clickRoom}}),o("action-dialog",{attrs:{title:"自动排房",visible:e.autoDialogVisible,top:"20px",width:"60%"},on:{"update:visible":function(t){e.autoDialogVisible=t},save:e.saveAuto},scopedSlots:e._u([{key:"body",fn:function(){return[o("el-form",{staticClass:"auto-checkin-form",attrs:{model:e.form,"label-width":"100px"}},[o("el-form-item",{attrs:{label:"团体名称"}},[o("el-select",{attrs:{multiple:"",placeholder:"请选择团体"},on:{change:e.changeTeamSelect,"visible-change":e.selectExpand},model:{value:e.form.reserveIds,callback:function(t){e.$set(e.form,"reserveIds",t)},expression:"form.reserveIds"}},e._l(e.personList,(function(e){return o("el-option",{key:e.reserveId,attrs:{label:e.teamName,value:e.reserveId}})})),1)],1),o("el-form-item",{attrs:{label:"楼宇"}},[o("el-checkbox-group",{on:{change:e.changeBuildCheckGroup},model:{value:e.form.buildingIds,callback:function(t){e.$set(e.form,"buildingIds",t)},expression:"form.buildingIds"}},e._l(e.buildList,(function(t,i){return o("div",{key:i,staticClass:"checkbox-warp"},[o("el-checkbox",{attrs:{label:t.buildingId}},[e._v(e._s(t.name))])],1)})),0)],1),o("el-form-item",{attrs:{label:"楼层"}},[e.rowList.length>0?o("div",{staticClass:"floor-checkbox-warp"},e._l(e.rowList,(function(t,i){return o("div",{key:i},[o("label",{staticClass:"floor-name"},[o("span",[e._v(e._s(t.floorName))])]),o("el-checkbox-group",{model:{value:e.form.floorIds,callback:function(t){e.$set(e.form,"floorIds",t)},expression:"form.floorIds"}},e._l(t.floorItems,(function(t,i){return o("div",{key:i,staticClass:"checkbox-warp"},[o("el-checkbox",{attrs:{label:t.buildingId}},[e._v(e._s(t.name))])],1)})),0)],1)})),0):o("div",{staticClass:"no-check-group"},[e._v("请先选择楼宇")])]),o("el-form-item",{attrs:{label:"房间类型"}},[o("el-checkbox-group",{model:{value:e.form.types,callback:function(t){e.$set(e.form,"types",t)},expression:"form.types"}},e._l(e.roomTypesByAuto,(function(t,i){return o("div",{key:i,staticClass:"checkbox-warp"},[o("el-checkbox",{attrs:{label:t.val}},[e._v(e._s(t.name))])],1)})),0)],1),o("el-form-item",{attrs:{label:"入住规则"}},[o("el-checkbox-group",{attrs:{value:e.form.rules}},e._l(e.rulesByAuto,(function(t,i){return o("div",{key:i,staticClass:"checkbox-warp"},[o("el-checkbox",{attrs:{label:t.val,disabled:t.disabled,checked:t.default},on:{change:function(o){return e.changeRuleCheck(o,t)}}},[e._v(" "+e._s(t.name)+" ")])],1)})),0)],1),o("el-form-item",{attrs:{label:"入住时间"}},[e.timeForm.sDate?o("div",{staticClass:"date-box"},[o("span",[e._v(e._s(e.timeForm.sDate))]),o("span",{staticClass:"text-divider"},[e._v("至")]),o("span",[e._v(e._s(e.timeForm.eDate))])]):o("span",[e._v(" -- ")])])],1)]},proxy:!0}])}),o("room-history-dialog",{attrs:{visible:e.roomStatusVisible,info:e.roomStatusInfo},on:{"update:visible":function(t){e.roomStatusVisible=t},"dialog-close":function(t){e.activeRoomId=""}}})],1)},Me=[];Ee._withStripped=!0;o(38),o(260),o(108);var Ge=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-dialog",{attrs:{visible:e.visible,width:"40%","custom-class":"dsf-dormitory-dialog","before-close":e.closeDialog,modal:!1},on:{"update:visible":function(t){e.visible=t},opened:e.queryRoomOccupyInfo},scopedSlots:e._u([{key:"title",fn:function(){return[o("div",{staticClass:"plain-title"},[o("span",[e._v("房间："+e._s(e.info.roomName))]),o("span",[e._v("房间床位："+e._s(e.info.emptyBedNum))])])]},proxy:!0},{key:"footer",fn:function(){return[o("div",{staticClass:"dialog-footer"},[o("el-button",{on:{click:e.closeDialog}},[e._v("确 定")])],1)]},proxy:!0}])},[o("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingOccupyInfo,expression:"loadingOccupyInfo"}],staticClass:"list-box"},e._l(e.list,(function(t,i){return o("div",{key:i,staticClass:"item"},[o("i",{staticClass:"ico-point"}),o("p",[e._v(e._s(t.timeStr))]),o("ul",[e._l(t.person,(function(t,i){return o("li",{key:t.relId},[o("p",[e._v(" "+e._s(t.typeStr)+"："+e._s(t.personName)+"[ "+e._s(t.sexText)+" ] ")]),o("p",[e._v(" "+e._s(t.phone)+" ")]),o("p",{staticStyle:{"text-align":"right","padding-right":"10px"}},["resetGroup"===e.opt?o("span",{on:{click:function(o){return e.resetGroup(t)}}},[e._v("重置")]):e._e(),o("span",{on:{click:function(o){return e.go2Info(t)}}},[e._v("详情")])])])})),e._l(t.release,(function(t,i){return o("li",{key:i},[o("p",[e._v("未入住：")])])}))],2)])})),0)])},Je=[];Ge._withStripped=!0;var He={name:"roomHistoryDialog",inject:["dormitoryRoot","rightConfigPointer"],props:{info:{type:Object,default:function(){return{roomName:"",emptyBedNum:"",roomId:"",sDate:"",eDate:""}}},visible:{type:Boolean,default:!1,required:!0}},computed:{rightConfig:function(){return this.rightConfigPointer()},opt:function(){return this.$route.query.opt}},data:function(){return{apiRoomOccupyInfo:null,roomStatusDetailClick:null,apiResetPerson:null,loadingOccupyInfo:!1,list:[]}},created:function(){c(this,this.rightConfig)},methods:{closeDialog:function(){this.$emit("dialog-close"),this.$emit("update:visible",!1)},queryRoomOccupyInfo:function(){var e=this;this.loadingOccupyInfo=!0;var t={roomId:this.info.roomId,sDate:this.info.sDate,eDate:this.info.eDate};this.$http.get(this.apiRoomOccupyInfo.url,t).done((function(t){var o=t.data;_.isFunction(e.apiRoomOccupyInfo.callback)&&(o=e.apiRoomOccupyInfo.callback(o)),e.list=o})).always((function(){e.loadingOccupyInfo=!1}))},go2Info:function(e){_.isFunction(this.roomStatusDetailClick)&&this.roomStatusDetailClick.call(this,e)},resetGroup:function(e){var t=this,o={personId:e.personId};this.$http.post(this.apiResetPerson.url,o).done((function(e){e.success?(t.queryRoomOccupyInfo(),t.dormitoryRoot.reset(),dsf.layer.message("人员重置成功")):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("人员重置失败",!1)}))}}},Qe=He,Ue=Object(h["a"])(Qe,Ge,Je,!1,null,null,null);Ue.options.__file="pc/dormitory/dialog/roomHistoryDialog.vue";var Ke=Ue.exports,ze={name:"groupRoomBox",inject:["rightConfigPointer"],components:{roomHistoryDialog:Ke,floorBox:be,actionDialog:fe},props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}},personObj:{type:Object,default:function(){return{}}},personList:{type:Array,default:function(){return[]}}},data:function(){return{apiRoomStatus:null,dropAble:null,apiTeamCheckin:null,apiTeamCheckOut:null,apiRestoreSelectRoom:null,apiBuildingList:null,apiAutoCheckIn:null,apiReserveCancel:null,roomTypesByAuto:null,rulesByAuto:null,originFloorList:[],chosenRoomId:[],activeRoomId:"",currentFloor:null,loadingRoomId:[],autoDialogVisible:!1,form:{},buildList:[],rowList:[],timeForm:{},roomStatusVisible:!1,roomStatusInfo:{},firstQueryRoomList:!0}},computed:Object(b["a"])(Object(b["a"])({},Object(R["mapState"])("dormitory",["activeTeamId","roomStateList"])),{},{rightConfig:function(){return this.rightConfigPointer()},mchildren:function(){return this.apiRoomStatus.childrenAlias},roomObj:function(){var e={},t=this.mid,o=this.mchildren;if(!this.floorList||0===this.floorList.length)return e;for(var i=0;i<this.floorList.length;i++)for(var n=this.floorList[i],s=0;s<n[o].length;s++){var r=n[o][s];if(e[r[t]])return void dsf.layer.alert("房间roomId有重复的");e[r[t]]=r}return e},mid:function(){return this.apiRoomStatus.roomIdAlias},mnum:function(){return this.apiRoomStatus.roomNumAlias},floorList:function(){return l(this.originFloorList,this.roomStateList)}}),watch:{floorList:function(){var e=this;this.$nextTick((function(){e.createInteraction()}))},activeTeamId:function(){this.queryRoomList()},autoDialogVisible:function(e){e&&$(".el-select-dropdown__list").children("li.hover").removeClass("hover")},roomStateList:function(){this.chosenRoomId=[]}},created:function(){c(this,this.rightConfig,["roomStateList"]);var e=(new Date).Format("yyyy-MM-dd"),t=dsf.url.queryString("sDate"),o=dsf.url.queryString("eDate"),i=t?decodeURIComponent(t):e+" 00:00:00",n=o?decodeURIComponent(o):e+" 23:59:59";this.startTime=i,this.endTime=n},mounted:function(){var e=this;this.GetAllBuildList(),s["a"].on(I.queryRoomList,(function(t){e.currentFloor=t,e.firstQueryRoomList||e.queryRoomList()})),s["a"].on(I.chosenRoomCheckOut,(function(t){e.chosenRoomCheckOut(t)})),s["a"].on(I.reserveRoomCancel,(function(t){e.reserveRoomCancel(t)})),s["a"].on(I.restoreSelectRoom,(function(t){e.restoreSelectRoom(t)})),s["a"].on(I.restoreAllRoom,(function(t){e.restoreAllRoom(t)})),s["a"].on(I.autoCheckIn,(function(){if(_.isArray(e.floorList)&&0!==e.floorList.length){var t,o;e.rowList=[],_.isArray(e.personList)?(o=e.activeTeamId?We.call(e):e.personList[0],t=[o.reserveId],e.timeForm={sDate:o.sDate.replace(/:\d\d$/,""),eDate:o.eDate.replace(/:\d\d$/,"")}):(t=[],e.timeForm={sDate:"",eDate:""});var i=[];e.rulesByAuto.forEach((function(e){"checked"===e.default&&i.push(e.val)})),e.form={reserveIds:t,buildingIds:[],floorIds:[],types:[],rules:i},e.autoDialogVisible=!0}else dsf.layer.message("该团体未分配房源，无法自动排房",!1)}))},methods:{reserveRoomCancel:function(e){var t=this,o=We.call(this);if(!this.chosenRoomId||0===this.chosenRoomId.length)return dsf.layer.message("您还没有选择房间",!1),!1;if(o){e.cancel=!0,this.loadingRoomId=this.chosenRoomId;var i={roomIds:this.chosenRoomId,reserveId:o.reserveId};this.$http.post(this.apiReserveCancel.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(dsf.layer.message("取消预约房成功"),t.queryRoomList(),s["a"].emit(I.refreshGroupList)):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("取消预约房失败",!1)})).always((function(){e.cancel=!1,t.loadingRoomId=[]}))}else dsf.layer.message("没有选择指定的团体",!1)},selectExpand:function(e){$(".el-select-dropdown__list").children("li.hover").removeClass("hover")},clickRoom:function(e){this.roomStatusInfo=Object(b["a"])({roomId:e[this.mid],roomName:e[this.mnum],emptyBedNum:e.beds},this.queryTime);var t=We.call(this);t&&(this.roomStatusInfo.sDate=t.sDate,this.roomStatusInfo.eDate=t.eDate),this.roomStatusVisible=!0},queryRoomList:function(){var e,t,o=this,i=We.call(this),n={buildingId:null===(e=this.currentFloor)||void 0===e?void 0:e.buildingId,type:null===(t=this.currentFloor)||void 0===t?void 0:t.typeValue,sDate:i?i.sDate:this.startTime,eDate:i?i.eDate:this.endTime};if(_.isFunction(this.apiRoomStatus.query)){var s=this.apiRoomStatus.query();n=a(n,s)}this.$http.get(this.apiRoomStatus.url,n).done((function(e){o.originFloorList=e.success?e.data:[],o.chosenRoomId=[]})).always((function(){o.firstQueryRoomList=!1}))},drop2room:function(e,t){var o=this,i=t[this.mid];this.loadingRoomId.push(i);var n={personId:e.personId,personName:e.personName,sexValue:e.sexValue,sexText:e.sexText,reserveId:e.reserveId,roomId:i};this.$http.post(this.apiTeamCheckin.url,JSON.stringify(n),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(dsf.layer.message("入住成功"),s["a"].emit(I.refreshGroupList),o.queryRoomList()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("入住失败",!1)})).always((function(){var e=o.loadingRoomId.findIndex((function(e){return e===i}));o.loadingRoomId.splice(e,1)}))},createInteraction:function(){var e=this;$(".floor-container .room").droppable({addClasses:!1,tolerance:"pointer",over:function(e,t){var o=$(e.target);o.css({"box-shadow":"0 0 5px inset #409eff"})},drop:function(t,o){var i=$(t.target);i.css("box-shadow","none");var n=i.data("id"),s=o.helper.data("id");if(!e.loadingRoomId.includes(n)){var r=e.roomObj[n],a=e.personObj[s],l=!1;if(_.isFunction(e.dropAble)&&(l=e.dropAble(a,r)),l){var c={type:"warning"};dsf.layer.confirm(Object.assign(l,c))}else e.drop2room(a,r)}},out:function(e,t){var o=$(e.target);o.css("box-shadow","none")}})},chosenRoomCheckOut:function(e){var t=this;if(!this.chosenRoomId||0===this.chosenRoomId.length)return dsf.layer.message("您还没有选择房间",!1),!1;var o=We.call(this);if(o){e.checkOut=!0,this.loadingRoomId=this.chosenRoomId;var i={reserveId:o.reserveId,roomIds:this.chosenRoomId};this.$http.post(this.apiTeamCheckOut.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(dsf.layer.message("退房成功"),t.queryRoomList(),s["a"].emit(I.refreshGroupList)):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("退房失败",!1)})).always((function(){e.checkOut=!1,t.loadingRoomId=[]}))}else dsf.layer.message("没有选择指定的团体",!1)},restoreSelectRoom:function(e){var t=this;if(!this.chosenRoomId||0===this.chosenRoomId.length)return dsf.layer.message("您还没有选择房间",!1),!1;var o=We.call(this);if(o){var i="";this.chosenRoomId.forEach((function(e){var o=t["roomObj"][e][t.mnum];i+="<span>".concat(o,"号房间</span>")}));var n=function(){t.loadingRoomId=t.chosenRoomId,e.restore=!0;var i={reserveId:o.reserveId,roomIds:t.chosenRoomId};t.$http.post(t.apiRestoreSelectRoom.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(dsf.layer.message("重置已选房间成功"),t.queryRoomList(),s["a"].emit(I.refreshGroupList)):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("重置已选房间失败",!1)})).always((function(){e.restore=!1,t.loadingRoomId=[]}))};dsf.layer.confirm({message:"<p>您即将重置<b>".concat(o.teamName,'</b>的：</p><p class="room-msg">').concat(i,"</p><p>是否继续？</p>"),customClass:"dormitory-restore-select-room-confirm"}).then((function(){n()})).catch((function(){}))}else dsf.layer.message("没有选择指定的团体",!1)},restoreAllRoom:function(e){var t=this,o=We.call(this);o?dsf.layer.confirm({message:"<p>当前操作会重置<b>".concat(o.teamName,"</b>的所有房间</p><p>是否继续？</p>")}).then((function(){e.restoreAll=!0;var i={reserveId:o.reserveId};t.$http.post(t.apiRestoreSelectRoom.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(dsf.layer.message("重置全部房间成功"),t.queryRoomList(),s["a"].emit(I.refreshGroupList)):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("重置全部房间失败",!1)})).always((function(){e.restoreAll=!1}))})).catch((function(){})):dsf.layer.message("没有选择指定的团体",!1)},GetAllBuildList:function(){var e=this;this.$http.get(this.apiBuildingList.url,{type:1}).done((function(t){e.buildList=t.data}))},changeBuildCheckGroup:function(e){var t=this,o=function(e,o){t.form.floorIds=t.form.floorIds.filter((function(e){return!!o[e]})),t.rowList=e};Ye.call(this,e,o)},saveAuto:function(e){var t=this;if(this.form.buildingIds&&0!==this.form.buildingIds.length)if(this.form.reserveIds&&0!==this.form.reserveIds.length){if(Xe.call(this))if(Ze.call(this)){e.save=!0;var o=[];this.personList.forEach((function(e){t.form.reserveIds.includes(e.reserveId)&&o.push(e.teamName)}));var i=Object(b["a"])(Object(b["a"])(Object(b["a"])({},this.form),this.timeForm),{},{teamNames:o});this.$http.post(this.apiAutoCheckIn.url,JSON.stringify(i),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(t.autoDialogVisible=!1,dsf.layer.message("自动排房成功"),t.queryRoomList(),s["a"].emit(I.refreshGroupList)):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("自动排房失败",!1)})).always((function(){e.save=!1}))}else dsf.layer.message("选择的团体是空的，没有可以排房的人员",!1)}else dsf.layer.message("自动排房至少需要选择一个团体",!1);else dsf.layer.message("楼宇不能为空",!1)},changeRuleCheck:function(e,t){if(e){if(!t.atomicity)return void this.form.rules.push(t.val);var o=[];this.rulesByAuto.forEach((function(e){e.atomicity===t.atomicity&&o.push(e.val)})),this.form.rules=this.form.rules.filter((function(e){return!o.includes(e)})),this.form.rules.push(t.val)}else this.form.rules=this.form.rules.filter((function(e){return e!==t.val}))},changeTeamSelect:function(e){var t=Xe.call(this);if(t){if(0===e.length&&(this.timeForm={sDate:"",eDate:""}),1===e.length){var o=this.personList.find((function(t){return t.reserveId===e[0]}));this.timeForm={sDate:o.sDate,eDate:o.eDate}}}else this.form.reserveIds.pop()}}};function We(){var e=this;return!!this.activeTeamId&&this.personList.find((function(t){return t.teamId===e.activeTeamId}))}function Ye(e,t){for(var o=this,i=[],n=function(t){var n=new Promise((function(i){o.$http.get(o.apiBuildingList.url,{buildingId:e[t],type:2}).done((function(n){var s=o.buildList.find((function(o){return o.buildingId===e[t]}));i({floorName:s.name,floorItems:n.data})}))}));i.push(n)},s=0;s<e.length;s++)n(s);Promise.all(i).then((function(e){for(var o={},i=0;i<e.length;i++)for(var n=e[i].floorItems,s=0;s<n.length;s++){var r=n[s];if(o[r.buildingId])return dsf.error("楼层buildingId 有重复的"),!1;o[r.buildingId]=r}t(e,o)}))}function Xe(){var e=this;if(!this.form.reserveIds||0===this.form.reserveIds.length)return!0;var t,o=this.personList.filter((function(t){return e.form.reserveIds.includes(t.reserveId)})),i=o[0].sDate.replace(/:\d\d$/,""),n=o[0].eDate.replace(/:\d\d$/,""),s=o.some((function(e){t=e;var o=e.sDate.replace(/:\d\d$/,""),s=e.eDate.replace(/:\d\d$/,"");return o!==i||s!==n}));return!s||(dsf.layer.message("".concat(t.teamName," 与 ").concat(o[0].teamName," 的入住时间不符合"),!1),!1)}function Ze(){var e=this;return this.personList.some((function(t){var o;if(e.form.reserveIds.includes(t.reserveId)&&(null===t||void 0===t||null===(o=t.person)||void 0===o?void 0:o.length)>0)return t.person.some((function(e){return 0===+e.occupy}))}))}var et=ze,tt=Object(h["a"])(et,Ee,Me,!1,null,null,null);tt.options.__file="pc/dormitory/room/groupRoomBox.vue";var ot=tt.exports,it=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"floor-container group"},[o("floor-box",{attrs:{"multiple-choose":!1,"floor-list":e.floorList,"active-room-id":e.activeRoomId,"loading-room-id":e.loadingRoomId},on:{"update:activeRoomId":function(t){e.activeRoomId=t},"update:active-room-id":function(t){e.activeRoomId=t},"click-room":e.clickRoom}}),o("room-history-dialog",{attrs:{visible:e.roomStatusVisible,info:e.roomStatusInfo},on:{"update:visible":function(t){e.roomStatusVisible=t},"dialog-close":e.closeDialog}})],1)},nt=[];it._withStripped=!0;var st={name:"groupRoomBox",inject:["rightConfigPointer"],components:{roomHistoryDialog:Ke,floorBox:be},props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}},personObj:{type:Object,default:function(){return{}}},personList:{type:Array,default:function(){return[]}}},data:function(){return{apiRoomStatus:null,dropAble:null,apiTeamCheckin:null,apiBuildingList:null,originFloorList:[],loadingRoomId:[],activeRoomId:"",roomStatusVisible:!1,roomStatusInfo:{},firstQueryRoomList:!0}},computed:Object(b["a"])(Object(b["a"])({},Object(R["mapState"])("dormitory",["activeTeamId","roomStateList"])),{},{activeTeam:function(){var e=this;return this.personList.find((function(t){return t.teamId===e.activeTeamId}))},rightConfig:function(){return this.rightConfigPointer()},mchildren:function(){return this.apiRoomStatus.childrenAlias},roomObj:function(){var e={},t=this.mid,o=this.mchildren;if(!this.floorList||0===this.floorList.length)return e;for(var i=0;i<this.floorList.length;i++)for(var n=this.floorList[i],s=0;s<n[o].length;s++){var r=n[o][s];if(e[r[t]])return void dsf.layer.alert("房间roomId有重复的");e[r[t]]=r}return e},mid:function(){return this.apiRoomStatus.roomIdAlias},mnum:function(){return this.apiRoomStatus.roomNumAlias},floorList:function(){return l(this.originFloorList,this.roomStateList)}}),watch:{floorList:function(){var e=this;this.$nextTick((function(){e.createInteraction()}))},activeTeamId:function(){this.queryRoomList()}},created:function(){c(this,this.rightConfig,["roomStateList"]);var e=(new Date).Format("yyyy-MM-dd"),t=dsf.url.queryString("sDate"),o=dsf.url.queryString("eDate"),i=t?decodeURIComponent(t):e+" 00:00:00",n=o?decodeURIComponent(o):e+" 23:59:59";this.startTime=i,this.endTime=n},mounted:function(){var e=this;s["a"].on(I.queryRoomList,(function(t){e.currentFloor=t,e.firstQueryRoomList||e.queryRoomList()}))},methods:{clickRoom:function(e){this.roomStatusInfo=Object(b["a"])({roomId:e[this.mid],roomName:e[this.mnum],emptyBedNum:e.beds},this.queryTime);var t=rt.call(this);t&&(this.roomStatusInfo.sDate=t.sDate,this.roomStatusInfo.eDate=t.eDate),this.roomStatusVisible=!0},queryRoomList:function(){var e,t,o,i=this,n=rt.call(this),s={buildingId:null===(e=this.currentFloor)||void 0===e?void 0:e.buildingId,type:null===(t=this.currentFloor)||void 0===t?void 0:t.typeValue,sDate:n?n.sDate:this.startTime,eDate:n?n.eDate:this.endTime};if(_.isFunction(this.apiRoomStatus.query)){var r=this.apiRoomStatus.query();s=a(s,r)}s=dsf.mix(s,{reserveId:null===(o=this.activeTeam)||void 0===o?void 0:o.reserveId}),this.$http.get(this.apiRoomStatus.url,s).done((function(e){i.originFloorList=e.success?e.data:[]})).always((function(){i.firstQueryRoomList=!1}))},drop2room:function(e,t){var o=this,i=t[this.mid];this.loadingRoomId.push(i);var n={personId:e.personId,personName:e.personName,sexValue:e.sexValue,sexText:e.sexText,reserveId:e.reserveId,roomId:i};this.$http.post(this.apiTeamCheckin.url,JSON.stringify(n),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(dsf.layer.message("入住成功"),s["a"].emit(I.refreshGroupList),o.queryRoomList()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("入住失败",!1)})).always((function(){var e=o.loadingRoomId.findIndex((function(e){return e===i}));o.loadingRoomId.splice(e,1)}))},createInteraction:function(){var e=this;$(".floor-container .room").droppable({addClasses:!1,tolerance:"pointer",over:function(e,t){var o=$(e.target);o.css({"box-shadow":"0 0 5px inset #409eff"})},drop:function(t,o){var i=$(t.target);i.css("box-shadow","none");var n=i.data("id"),s=o.helper.data("id");if(!e.loadingRoomId.includes(n)){var r=e.roomObj[n],a=e.personObj[s],l=!1;if(_.isFunction(e.dropAble)&&(l=e.dropAble(a,r)),l){var c={type:"warning"};dsf.layer.confirm(Object.assign(l,c))}else e.drop2room(a,r)}},out:function(e,t){var o=$(e.target);o.css("box-shadow","none")}})},closeDialog:function(){this.activeRoomId="",this.queryRoomList()}}};function rt(){var e=this;return!!this.activeTeamId&&this.personList.find((function(t){return t.teamId===e.activeTeamId}))}var at=st,lt=Object(h["a"])(at,it,nt,!1,null,null,null);lt.options.__file="pc/dormitory/room/resetGroupRoomBox.vue";var ct=lt.exports,ut=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"top-tool"},[o("div",{staticClass:"title"},[e._v(e._s(e.title))]),o("div",{staticClass:"sec-box"},[o("dsf-button",{attrs:{loading:e.btnLoading.occupied},on:{click:function(t){return e.preClick("resetOccupiedRoom")}}},[e._v("重置已配房源")]),o("dsf-button",{attrs:{loading:e.btnLoading.checked},on:{click:function(t){return e.preClick("resetCheckedRoom")}}},[e._v("重置已选房源")]),o("dsf-button",{attrs:{loading:e.btnLoading.sure},on:{click:function(t){return e.preClick("sureRoomResource")}}},[e._v("确定分配")]),o("dsf-button",{attrs:{loading:e.btnLoading.auto},on:{click:function(t){return e.preClick("autoRoomResource")}}},[e._v("自动分配")])],1)]),o("div",{staticClass:"msg-box"},[o("color-state-list",{attrs:{"room-state-list":e.roomStateList}}),o("div",{staticClass:"msg"},[o("label",[e._v("已分配")]),e._l(e.computeAssign,(function(t,i){return o("span",{key:i},[e._v(e._s(t.name)+"："),o("b",[e._v(e._s(t.num))]),e._v("间")])}))],2)],1),o("div",{staticClass:"msg-box"},[o("div",{staticClass:"msg"},[o("label",[e._v("当前团体：")]),o("span",[e._v(e._s(e.team.teamName))]),o("span",{staticClass:"time"},[e._v(e._s(e.team.sDate))]),e._v("至 "),o("span",{staticClass:"time"},[e._v(e._s(e.team.eDate))])]),o("div",{staticClass:"msg"},[o("label",[e._v("该次需要")]),e._l(e.computeReserve,(function(t,i){return o("span",{key:i},[e._v(e._s(t.name)+"："),o("b",[e._v(e._s(t.num))]),e._v("间")])})),o("span",[e._v("共"+e._s(e.allNeedReserve)+"间客房")])],2),o("div",{staticClass:"msg"},[o("label",[e._v("已选取")]),o("span",[e._v("床位："),o("b",{staticClass:"blue"},[e._v(e._s(e.chosenBedNum))]),e._v("个")]),e._l(e.chosenRoomNum,(function(t,i){return o("span",{key:i},[e._v(e._s(t.name)+"："),o("b",{staticClass:"blue"},[e._v(e._s(e.msgChosenNum[t.code]))]),e._v("间")])}))],2)])])},mt=[];ut._withStripped=!0;o(64);var dt={name:"allocationTopTool",inject:["rightConfigPointer"],components:{colorStateList:q,inlineSelectBox:U},computed:Object(b["a"])(Object(b["a"])({rightConfig:function(){return this.rightConfigPointer()},roomTypeObj:function(){for(var e={},t=0;t<this.roomTypes.length;t++){var o=this.roomTypes[t];if(e[o.val])return dsf.error("roomTypes 有重复的val"),{};e[o.val]=o}return e}},Object(R["mapState"])("dormitory",["chosenRoomId","roomObj","roomStateList"])),{},{chosenRoomNum:function(){var e=this;return this.roomTypes.filter((function(t){return e.msgChosenNum[t.code]>0}))},computeReserve:function(){for(var e=[],t=0;t<this.roomTypes.length;t++){var o=this.roomTypes[t],i=this.mReserve[o.code];if(i&&!(i<=0)){var n={name:o.name,num:i};e.push(n)}}return e},computeAssign:function(){for(var e=[],t=0;t<this.roomTypes.length;t++){var o=this.roomTypes[t],i=this.mAssign[o.code];if(i&&!(i<=0)){var n={name:o.name,num:i};e.push(n)}}return e},chosenBedNum:function(){var e=this;if(_.isArray(this.chosenRoomId)&&this.chosenRoomId.length>0){var t=0;return this.chosenRoomId.forEach((function(o){t+=parseInt(e.roomObj[o]["beds"])})),t}return 0},team:function(){var e=this.$route.query;return{teamName:e.name,sDate:decodeURIComponent(e.sDate),eDate:decodeURIComponent(e.eDate)}}}),data:function(){return{title:"",roomTypes:null,apiRoomReserveInfo:null,btnLoading:{occupied:!1,checked:!1,sure:!1,auto:!1},msgChosenNum:{},mReserve:{},mAssign:{},allNeedReserve:null}},watch:{chosenRoomId:function(e){this.computeRoomNum(e)}},created:function(){c(this,this.rightConfig,["roomStateList"]),this.queryReserveInfo()},methods:{preClick:function(e){var t="autoRoomResource"===e?this.mReserve:this.btnLoading;s["a"].emit(I[e],t)},computeRoomNum:function(e){this.msgChosenNum={};for(var t=0;t<e.length;t++){var o=e[t],i=this.roomObj[o],n=this.roomTypeObj[i.roomType].code;this.msgChosenNum[n]=this.msgChosenNum[n]&&this.msgChosenNum[n]>0?this.msgChosenNum[n]+1:1}},queryReserveInfo:function(){var e=this,t={};if(_.isFunction(this.apiRoomReserveInfo.query)){var o=this.apiRoomReserveInfo.query();t=a(t,o)}this.$http.get(this.apiRoomReserveInfo.url,t).done((function(t){e.mReserve=t.data.reserve,e.mAssign=t.data.assign;for(var o=0,i=0;i<e.roomTypes.length;i++){var n=e.roomTypes[i];o+=parseInt(e.mReserve[n.code])}e.allNeedReserve=o}))}}},ft=dt,ht=Object(h["a"])(ft,ut,mt,!1,null,null,null);ht.options.__file="pc/dormitory/room/allocationTopTool.vue";var pt=ht.exports,vt=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"floor-container allocation"},[o("floor-box",{attrs:{"floor-list":e.floorList,"chosen-room-id":e.chosenRoomId,"active-room-id":e.activeRoomId,"loading-room-id":e.loadingRoomId,"multiple-choose":!0},on:{"update:chosenRoomId":function(t){e.chosenRoomId=t},"update:chosen-room-id":function(t){e.chosenRoomId=t},"update:activeRoomId":function(t){e.activeRoomId=t},"update:active-room-id":function(t){e.activeRoomId=t},"click-room":e.clickRoom}}),o("action-dialog",{attrs:{title:"自动分配房间",visible:e.autoDialogVisible,width:"30%"},on:{"update:visible":function(t){e.autoDialogVisible=t},save:e.saveAuto},scopedSlots:e._u([{key:"body",fn:function(){return[o("el-form",{ref:"form",staticClass:"auto-checkin-form",attrs:{model:e.form,"label-width":"80px"}},e._l(e.roomTypes,(function(t,i){return o("el-form-item",{key:i,attrs:{label:t.name}},[o("el-input-number",{attrs:{controls:!1,precision:0},model:{value:e.form[t.code],callback:function(o){e.$set(e.form,t.code,o)},expression:"form[item.code]"}})],1)})),1)]},proxy:!0}])}),o("room-history-dialog",{attrs:{visible:e.roomStatusVisible,info:e.roomStatusInfo},on:{"update:visible":function(t){e.roomStatusVisible=t},"dialog-close":function(t){e.activeRoomId=""}}})],1)},gt=[];vt._withStripped=!0;var yt={name:"allocationRoomBox",inject:["rightConfigPointer"],props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}}},data:function(){return{apiRoomStatus:null,roomTypes:null,apiResetRoomStatus:null,apiAssignRoomStatus:null,apiAutoAssign:null,startTime:"",endTime:"",originFloorList:[],chosenRoomId:[],activeRoomId:"",loadingRoomId:[],autoDialogVisible:!1,form:{},roomStatusVisible:!1,roomStatusInfo:{}}},computed:Object(b["a"])({rightConfig:function(){return this.rightConfigPointer()},mid:function(){return this.apiRoomStatus.roomIdAlias},mnum:function(){return this.apiRoomStatus.roomNumAlias},floorList:function(){return l(this.originFloorList,this.roomStateList)}},Object(R["mapState"])("dormitory",["currentFloor","roomStateList"])),watch:{currentFloor:function(){this.queryRoomList()},roomStateList:function(){this.chosenRoomId=[]}},components:{roomHistoryDialog:Ke,ActionDialog:fe,floorBox:be,actionDialog:fe},created:function(){c(this,this.rightConfig,["roomStateList"]);var e=(new Date).Format("yyyy-MM-dd");this.startTime=e+" 00:00:00",this.endTime=e+" 23:59:59"},mounted:function(){var e=this;s["a"].on(I.resetOccupiedRoom,(function(t){e.preResetOccupiedRoom(t)})),s["a"].on(I.resetCheckedRoom,(function(t){e.chosenRoomId&&0!==e.chosenRoomId.length?e.resetCheckedRoom(t):dsf.layer.message("未选择任何房间",!1)})),s["a"].on(I.sureRoomResource,(function(t){e.preSureRoomResource(t)})),s["a"].on(I.autoRoomResource,(function(t){for(var o={},i=0;i<e.roomTypes.length;i++){var n=e.roomTypes[i],s=t[n.code];o[n.code]=s&&+s>0?+s:void 0}e.form=o,e.autoDialogVisible=!0}))},methods:{clickRoom:function(e){this.roomStatusInfo=Object(b["a"])({roomId:e[this.mid],roomName:e[this.mnum],emptyBedNum:e.beds},this.queryTime),this.roomStatusVisible=!0},queryRoomList:function(){var e=this,t=Object(b["a"])(Object(b["a"])({},this.currentFloor),{},{sDate:this.startTime,eDate:this.endTime});if(_.isFunction(this.apiRoomStatus.query)){var o=this.apiRoomStatus.query();t=a(t,o)}this.$http.get(this.apiRoomStatus.url,t).done((function(t){e.originFloorList=t.success?t.data:[],e.chosenRoomId=[]}))},preResetOccupiedRoom:function(e){var t=this;dsf.layer.confirm({message:"该操作会重置所有已分配的房源，是否继续？"}).then((function(){t.resetOccupiedRoom(e)})).catch((function(){}))},resetOccupiedRoom:function(e){var t=this;e.occupied=!0;var o={};if(_.isFunction(this.apiResetRoomStatus.query)){var i=this.apiResetRoomStatus.query();o=Object.assign({},o,i)}this.$http.post(this.apiResetRoomStatus.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(dsf.layer.message("重置已分配房源成功"),t.queryRoomList()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("重置已分配房源失败",!1)})).always((function(){e.occupied=!1}))},resetCheckedRoom:function(e){var t=this;e.checked=!0,this.loadingRoomId=this.chosenRoomId;var o={roomIds:this.chosenRoomId};if(_.isFunction(this.apiResetRoomStatus.query)){var i=this.apiResetRoomStatus.query();o=Object.assign({},o,i)}this.$http.post(this.apiResetRoomStatus.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(dsf.layer.message("所有选择的房源，重置成功"),t.queryRoomList()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("重置已选择房源失败",!1)})).always((function(){e.checked=!1,t.loadingRoomId=[]}))},preSureRoomResource:function(e){var t=this;if(this.chosenRoomId&&0!==this.chosenRoomId.length){var o=bt(this.floorList,this.mid),i=[],n="",s="";if(this.chosenRoomId.forEach((function(e){var r=o[e];1!==r.statusValue?s+="<span>"+r[t.mnum]+"</span>":(i.push(e),n+="<span>"+r[t.mnum]+"</span>")})),0!==s.length){var r='<p class="room-msg un-pass">'.concat(s,"</p>"),a='<p class="room-msg pass">'.concat(n,"</p>"),l=0===i.length?"没有可以分配的房间":"是否继续分配以下房间？".concat(a);dsf.layer.confirm({message:"以下房间不可以被分配：".concat(r).concat(l),customClass:"dormitory-restore-select-room-confirm"}).then((function(){t.chosenRoomId=i,i.length>0&&t.sureRoomResource(e)})).catch((function(){}))}else this.sureRoomResource(e)}else dsf.layer.message("未选择任何房间",!1)},sureRoomResource:function(e){var t=this;e.sure=!0,this.loadingRoomId=this.chosenRoomId;var o={roomIds:this.chosenRoomId};if(_.isFunction(this.apiAssignRoomStatus.query)){var i=this.apiAssignRoomStatus.query();o=Object.assign({},o,i)}this.$http.post(this.apiAssignRoomStatus.url,JSON.stringify(o),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(dsf.layer.message("所有选择的房源，分配成功"),t.queryRoomList()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("分配已选择房源失败",!1)})).always((function(){e.sure=!1,t.loadingRoomId=[]}))},saveAuto:function(e){var t=this;e.save=!0;for(var o=[],i=0;i<this.roomTypes.length;i++){var n=this.roomTypes[i];if(this.form[n.code]&&!(parseInt(this.form[n.code])<=0)){var s={type:n.val,amount:this.form[n.code]};o.push(s)}}var r={roomTypes:o};if(_.isFunction(this.apiAutoAssign.query)){var a=this.apiAutoAssign.query();r=Object.assign({},r,a)}this.$http.post(this.apiAutoAssign.url,JSON.stringify(r),{headers:{"Content-Type":"application/json; charset=utf-8"}}).done((function(e){e.success?(t.autoDialogVisible=!1,dsf.layer.message("自动分配房源成功"),t.queryRoomList()):dsf.layer.message(e.message,!1)})).error((function(e){dsf.layer.message("自动分配房源失败",!1)})).always((function(){e.save=!1}))}}};function bt(e,t){for(var o={},i=0;i<e.length;i++)for(var n=e[i],s=0;s<n.roomDtos.length;s++){var r=n.roomDtos[s];o[r[t]]=r}return o}var Rt=yt,It=Object(h["a"])(Rt,vt,gt,!1,null,null,null);It.options.__file="pc/dormitory/room/allocationRoomBox.vue";var _t=It.exports,Ct=function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"floor-container"},[o("floor-box",{attrs:{"floor-list":e.floorList,"active-room-id":e.activeRoomId},on:{"update:activeRoomId":function(t){e.activeRoomId=t},"update:active-room-id":function(t){e.activeRoomId=t},"click-room":e.clickRoom}}),o("room-history-dialog",{attrs:{visible:e.roomStatusVisible,info:e.roomStatusInfo},on:{"update:visible":function(t){e.roomStatusVisible=t},"dialog-close":e.onCloseDialog}}),o("action-dialog",{attrs:{title:"房间动态信息",visible:e.roomMonthVisible,"no-footer":!0},on:{"update:visible":function(t){e.roomMonthVisible=t},"dialog-close":e.onCloseDialog},scopedSlots:e._u([{key:"inner",fn:function(){return[o("div",{staticClass:"month-box"},[o("div",{staticClass:"month-title"},[o("span",[e._v(e._s(e.monthRoomInfo.title))]),o("span",[e._v(e._s(e.monthRoomInfo.type))])]),o("div",{staticClass:"month-body"},e._l(e.monthArr,(function(t,i){return o("div",{key:i,style:e.mSty(t)},[e._v(e._s(t.text))])})),0)]),o("div",{staticClass:"month-footer"},[o("color-state-list",{attrs:{"room-state-list":e.monthStateList,"check-able":!1}})],1)]},proxy:!0}])})],1)},kt=[];Ct._withStripped=!0;var Lt={name:"roomBox",inject:["rightConfigPointer"],props:{queryTime:{type:Object,default:function(){return{sDate:"",eDate:""}}},treeList:{type:Array}},data:function(){return{apiRoomStatus:null,apiOneMonthRoomInfo:null,originFloorList:[],roomStatusVisible:!1,roomStatusInfo:{},activeRoomId:"",timeDistance:0,timeTicker:null,roomMonthVisible:!1,monthRoomInfo:{},monthArr:[]}},computed:Object(b["a"])({rightConfig:function(){return this.rightConfigPointer()},mchildren:function(){return this.apiRoomStatus.childrenAlias},mroomNum:function(){return this.apiRoomStatus.roomNumAlias},mroomId:function(){return this.apiRoomStatus.roomIdAlias},monthStateList:function(){return this.roomStateList.slice(0,3)},floorList:function(){return l(this.originFloorList,this.roomStateList)}},Object(R["mapState"])("dormitory",["currentFloor","roomStateList"])),components:{roomHistoryDialog:Ke,floorBox:be,actionDialog:fe,colorStateList:q},watch:{currentFloor:function(){this.queryRoomList()}},created:function(){c(this,this.rightConfig,["roomStateList"])},beforeDestroy:function(){this.timeTicker&&(clearTimeout(this.timeTicker),this.timeTicker=null)},mounted:function(){var e=this;s["a"].on(I.queryRoomList,(function(){e.queryRoomList()}))},methods:{clickRoom:function(e){var t=this;this.timeDistance+=1,this.timeTicker||(this.timeTicker=setTimeout((function(){t.timeDistance>=2?t.dbClickRoom(e):t.singleClickRoom(e),t.timeDistance=0,clearTimeout(t.timeTicker),t.timeTicker=null}),250))},dbClickRoom:function(e){var t=this,o={roomId:e[this.mroomId]};this.$http.get(this.apiOneMonthRoomInfo.url,o).done((function(o){if(o.success){t.monthRoomInfo={title:"".concat(e.buildingText," / ").concat(e.floorText," / ").concat(e.name),type:e.roomText};var i=o.data;_.isFunction(t.apiOneMonthRoomInfo.callback)&&(i=t.apiOneMonthRoomInfo.callback(i)),t.monthArr=i,t.roomMonthVisible=!0}else dsf.layer.message("查询此房间一个月房态失败：\n"+o.message,!1)}))},singleClickRoom:function(e){this.roomStatusInfo=Object(b["a"])({roomId:e[this.mroomId],roomName:e[this.mroomNum],emptyBedNum:e.beds},this.queryTime),this.roomStatusVisible=!0},queryRoomList:function(){var e=this,t=Object(b["a"])({},this.currentFloor);if(_.isFunction(this.apiRoomStatus.query)){var o=this.apiRoomStatus.query();t=a(t,o)}t=Object.assign({},t,this.queryTime),this.$http.get(this.apiRoomStatus.url,t).done((function(t){e.originFloorList=t.success?t.data:[],e.activeRoomId=""}))},onCloseDialog:function(){this.activeRoomId=""},mSty:function(e){return{backgroundColor:e.bgColor}}}},St=Lt,Dt=Object(h["a"])(St,Ct,kt,!1,null,null,null);Dt.options.__file="pc/dormitory/room/stateRoomBox.vue";var xt=Dt.exports,Ot=o(951),wt={name:"DsfDormitory",provide:function(){var e=this;return{dormitoryRoot:this,leftConfigPointer:function(){return e.leftConfig},rightConfigPointer:function(){return e.rightConfig}}},components:{leftMenu:v},data:function(){return{leftMenuTitle:"",commonProps:{queryTime:{},treeList:[],personObj:{},personList:[]},dynamicLeft:null,dynamicTop:null,dynamicRoom:null,leftConfig:null,rightConfig:null}},watch:{"$route.fullPath":function(){getRightLayoutConfig&&(this.rightConfig=new Ot["a"](getRightLayoutConfig(),this.$route.query.opt))},"$route.query.opt":function(){this.createDormitory()}},methods:{reset:function(){Ft(this,"reset")},initGuestLayout:function(){this.dynamicTop=B,this.dynamicLeft=ie,this.dynamicRoom=xe},initGroup:function(){this.dynamicTop=je,this.dynamicLeft=Pe,this.dynamicRoom=ot},initAllocation:function(){this.dynamicTop=pt,this.dynamicLeft=ie,this.dynamicRoom=_t},initStatus:function(){this.dynamicTop=B,this.dynamicLeft=ie,this.dynamicRoom=xt},initResetGroup:function(){this.dynamicTop=Y,this.dynamicLeft=Pe,this.dynamicRoom=ct},renderInner:function(){r(),this.commonProps.queryTime=Tt.call(this);var e=this.$route.query.opt;switch(e){case"guests":this.initGuestLayout();break;case"group":this.initGroup();break;case"allocation":this.initAllocation();break;case"roomStatus":this.initStatus();break;case"resetGroup":this.initResetGroup();break}var t=this.leftConfig.title,o=this.rightConfig.roomStateList;this.leftMenuTitle=t,this.$store.commit("dormitory/changeRoomStateList",o),this.$nextTick((function(){$(window).off("scroll").on("scroll",(function(){var e=$(window).scrollLeft();$(".top-tool-container").css("margin-left",-e)}))}))},createDormitory:function(){s["a"].clear(),this.$store.commit("dormitory/activeTeamId",""),this.leftConfig=new Ot["a"](leftTreeConfig,this.$route.query.opt),this.rightConfig=new Ot["a"](getRightLayoutConfig(),this.$route.query.opt),this.renderInner()}},created:function(){var e=this,t=dsf.url.getWebPath("$/seat_config/dormitory/leftTree.js"),o=dsf.url.getWebPath("$/seat_config/dormitory/rightLayout.js");this.$http.importFiles([t,o]).then((function(t){e.createDormitory()}))}};function Tt(){var e=dsf.config.setting_sgcp_sdate,t=dsf.config.setting_sgcp_edate,o=(new Date).Format("yyyy-MM-dd"),i=new Date((new Date).getTime()+864e5).Format("yyyy-MM-dd"),n=e?o+" "+e:o+" 00:00:00",s=t?i+" "+t:o+" 23:59:59",r={sDate:n,eDate:s},l=this.rightConfig.defaultQueryByUrl,c={sDate:decodeURIComponent(dsf.url.queryString(l["startTime"])),eDate:decodeURIComponent(dsf.url.queryString(l["endTime"]))};return a(r,c)}function Ft(e,t){Object.values(e.$refs).forEach((function(e){var o;null!==e&&void 0!==e&&e.$refs&&(Ft(e,t),null===(o=e[t])||void 0===o||o.call(e))}))}var $t=wt,jt=Object(h["a"])($t,i,n,!1,null,null,null);jt.options.__file="pc/dormitory/dormitory.vue";t["default"]=jt.exports}}]);
//# sourceMappingURL=dsf-platform.Dormitory.js.map