/*!
 * Name: @dsf/cli-platform
 * Version: 0.2.46-alpha.11
 * Description: 平台基础包
 * BuildTime: 2021/7/14 下午4:42:57
 */
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[8],{946:function(t,e,n){"use strict";var i=n(187),o=n(188),a=(n(24),n(25),n(475),function(){function t(){Object(i["a"])(this,t),this.events={}}return Object(o["a"])(t,[{key:"listen",value:function(t,e){if(void 0===this.events[t])this.events[t]=[e];else{var n=this.events[t];if(!_.isArray(n))return void"请使用 on 来监听 ".concat(t," 事件");n.push(e)}}},{key:"dispatch",value:function(t,e){var n=this.events[t];n&&_.isArray(n)&&n.forEach((function(t){t(e)}))}},{key:"on",value:function(t,e){void 0===this.events[t]?this.events[t]=e:_.isArray(this.events[t])&&"请使用 listen 来监听 ".concat(t," 事件")}},{key:"emit",value:function(t,e){var n=this.events[t];n&&(_.isArray(n)||n(e))}},{key:"off",value:function(t){this.events[t]=void 0}},{key:"clear",value:function(){this.events={}}},{key:"$getAllListener",value:function(){return Object.entries(this.events)}}]),t}()),s=new a;window.$simpleEventBus=s,e["a"]=s},947:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return o}));var i="file/upload/",o={CONFIG_FILE_LOADED:"config_file_loaded",KEY_DELETE:"key_delete",KEY_CTRL_D:"key_ctrl_d",BODY_EMPTY_CLICK:"body_empty_click",SEAT_POP:"seat_pop",GET_ACTIVE_SEAT:"get_active_seat",CLEAN_ALL_SEAT_NUM:"clean_all_seat_num",CLEAN_SELECT_SEAT_NUM:"clean_select_seat_num",AFTER_QUICK_ORDER:"after_quick_order",PERSON_REVERT_TREE:"person_revert_tree",LEFT_CLICK_SEAT:"left_click_seat",AUTO_SEAT:"auto_seat",LEVEL_UP:"level_up",LEVEL_DOWN:"level_down"}},948:function(t,e,n){"use strict";n.d(e,"j",(function(){return a})),n.d(e,"i",(function(){return s})),n.d(e,"d",(function(){return r})),n.d(e,"e",(function(){return l})),n.d(e,"c",(function(){return c})),n.d(e,"h",(function(){return u})),n.d(e,"b",(function(){return f})),n.d(e,"a",(function(){return d})),n.d(e,"g",(function(){return h})),n.d(e,"f",(function(){return p}));n(24),n(25),n(15),n(23),n(26),n(185),n(196);var i=n(947),o=n(946);function a(t,e){var n=this,o={headers:{"Content-Type":"multipart/form-data"},transformRequest:[function(t,e){return t}]},a=dsf.layer.loading();n.$http.post(i["b"],t,o).done((function(t){if(!dsf.isDef(t.data)||!t.success)return dsf.layer.message(t.message,!1),e&&e("error"),!1;e&&e(t.data)})).error((function(t){dsf.layer.message("上传图片失败",!1),e&&e("error")})).always((function(){dsf.layer.closeLoading(a)}))}function s(t){var e=t.member[0],n=t.height-e.height*t.rows,i=t.width-e.width*t.cols,o=t.rows>1?n/(t.rows-1):0,a=t.cols>1?i/(t.cols-1):0;t.member.forEach((function(t){t.rowIndex>0&&(t.top=_.floor((t.height+o)*t.rowIndex,2)),t.colIndex>0&&(t.left=_.floor((t.width+a)*t.colIndex,2))}))}function r(t){var e=t.member[0],n=t.width-e.width*t.cols;return 1===t.cols?0:_.floor(n/(t.cols-1),2)}function l(t){var e=t.member[0],n=t.height-e.height*t.rows;return 1===t.rows?0:_.floor(n/(t.rows-1),2)}function c(){var t,e=this,n=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.items.forEach((function(t){t.isFrozenSty=!0,e.selectedItems.forEach((function(e){t.id===e.id&&(t.isFrozenSty=!1)}))})),(null===this||void 0===this||null===(t=this.groups)||void 0===t?void 0:t.length)>0&&this.groups.forEach((function(t){t.isFrozenSty=!0,t.isFrozenMemberSty=!0,e.selectedItems.forEach((function(e){t.id===e.id&&(t.isFrozenSty=!1,!n&&(t.isFrozenMemberSty=!1))}))}))}function u(){this.items.forEach((function(t){t.isFrozenSty=!1})),this.groups.forEach((function(t){t.isFrozenSty=!1,t.isFrozenMemberSty=!1}))}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dsf-seat-upload";$("input[name='".concat(t,"']")).remove();var e=document.createElement("input");return e.type="file",e.accept="image/*",e.style.display="none",e.name=t,document.body.appendChild(e),e}function d(){var t=this;if(!_.isEmpty(t.postData.backgroundImage)){var e=t.postData.backgroundImage.width,n=t.postData.backgroundImage.height,i=t.postData.canvasSet.width||$(".seat-designer-page").width(),o=i/e;t.postData.canvasSet.width=i,t.postData.canvasSet.height=n*o,$("#panel_bg").css("background-image","url("+t.postData.backgroundImage.absolutePath+")")}}function h(t,e){var n,a=function(t){switch(t){case 17:t="ctrl";break;case 68:t="d";break;case 65:t="a";break;case 46:t="delete";break;case 16:t="shift";break;case 83:t="s";break;default:t=null}return t};$("body").on("keydown",(function(s){if(n=a(s.keyCode),n){var r=t.indexOf(n);-1===r&&t.push(n);var l=t.join("-");e.includes(l)&&(s.stopPropagation(),s.preventDefault()),"ctrl-d"===l&&o["a"].emit(i["a"].KEY_CTRL_D),"delete"===l&&o["a"].emit(i["a"].KEY_DELETE)}})),$("body").on("keyup",(function(e){e.stopPropagation(),e.preventDefault(),n=a(e.keyCode),_.pull(t,n)}))}function p(t,e){return{id:t.id,pid:t.parentId,belong:t.belong,currentState:t.stateList[1],person:e,seatNum:t.seatNum}}},949:function(t,e,n){var i=n(17),o=n(21),a=n(950).f,s=o((function(){return!Object.getOwnPropertyNames(1)}));i({target:"Object",stat:!0,forced:s},{getOwnPropertyNames:a})},950:function(t,e,n){var i=n(87),o=n(186).f,a={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],r=function(t){try{return o(t)}catch(e){return s.slice()}};t.exports.f=function(t){return s&&"[object Window]"==a.call(t)?r(t):o(i(t))}},951:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var i=n(187),o=n(188),a=(n(15),n(24),n(25),n(949),function(){function t(e,n){var o=this;Object(i["a"])(this,t),this.config=e,n||this.alert("url里面缺少必要的opt参数"),this.config[n]||this.alert("[".concat(this.config.name,"] url里面的opt参数没有对应的配置项")),Object.getOwnPropertyNames(this.config[n]).forEach((function(t){o[t]=o.config[n][t]}))}return Object(o["a"])(t,[{key:"alert",value:function(t){throw dsf.layer.alert({title:"警告",type:"warning",message:t}),new Error(t)}}]),t}())},956:function(t,e,n){var i=n(969);"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n(40).default;o("003b4b0c",i,!1,{sourceMap:!1,shadowMode:!1})},966:function(t,e,n){"use strict";var i=n(17),o=n(461),a=n(462);i({target:"String",proto:!0,forced:a("italics")},{italics:function(){return o(this,"i","","")}})},967:function(t,e,n){t.exports=n.p+"modules/platform/img/image.png"},968:function(t,e,n){"use strict";n(956)},969:function(t,e,n){"use strict";n.r(e)},984:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ds-designer ds-seat-container ds-seat-design"},[n("div",{staticClass:"designer-head"},[n("top-tools",t._b({on:{"save-layout":t.saveLayout}},"top-tools",t.postData,!1,!0))],1),n("div",{staticClass:"designer-content"},[n("div",{staticClass:"seat-designer-center"},[n("left-tools"),n("print-canvas",{scopedSlots:t._u([{key:"seat",fn:function(){return[n("seat-item",t._b({},"seat-item",t.postData,!1,!0))]},proxy:!0}])}),n("right-tools")],1)])])},o=[];i._withStripped=!0;n(10),n(35),n(24),n(25);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"designer_tools"},[t._l(t.layout.buttons,(function(t,e){return n("DsfButton",{key:e,attrs:{icon:t.icon,text:t.text,"btn-style":"icon-text"},on:{click:function(e){return t.handler(e,t)}}})})),n("div",{staticClass:"switch-warp"},[n("el-switch",{attrs:{value:t.showBorderLine},on:{change:t.changeShowBorder}}),n("span",{class:{active:t.showBorderLine}},[t._v("边线框")])],1),n("width-input",{attrs:{"canvas-set":t.canvasSet,"has-bg":t.hasBg}})],2)},s=[];a._withStripped=!0;var r=n(6),l=n(952),c=n.n(l),u=n(948),f=n(946),d=n(947),h=n(266),p=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"input-box"},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.canvasSet,"label-width":"100px"}},[n("el-form-item",{attrs:{label:"画布宽"}},[n("el-input-number",{attrs:{controls:!1,precision:0,placeholder:"自适应"},model:{value:t.canvasSet.width,callback:function(e){t.$set(t.canvasSet,"width",e)},expression:"canvasSet.width"}})],1),n("el-form-item",{attrs:{label:"画布高"}},[n("el-input-number",{attrs:{controls:!1,disabled:t.hasBg,precision:0,placeholder:"自适应"},model:{value:t.canvasSet.height,callback:function(e){t.$set(t.canvasSet,"height",e)},expression:"canvasSet.height"}})],1)],1)],1)},g=[];p._withStripped=!0;var m={name:"WidthInput",props:{canvasSet:{type:Object,required:!0},hasBg:{type:Boolean}},data:function(){return{}},watch:{canvasSet:{handler:function(t){var e=this,n=t.width,i=t.height,o=$(".seat-designer-page").offset().left,a=$(".seat-designer-page").offset().top,s=$(window).height(),r=$(window).width();n&&n+o>r?$(".seat-designer-center").css({"overflow-x":"scroll"}):$(".seat-designer-center").css({"overflow-x":"auto"}),i&&i+a>s?$(".seat-designer-center").css("overflow-y","scroll"):$(".seat-designer-center").css("overflow-y","auto"),e.$store.commit("printingDesign/changeCompelPanelSize",t)},deep:!0}}},v=m,y=n(0),b=Object(y["a"])(v,p,g,!1,null,null,null);b.options.__file="designer/seat/printingDesign/widthInput.vue";var x=b.exports,w={name:"TopTools",props:{backgroundImage:{type:Object,default:function(){return{url:"",width:0,height:0}}},canvasSet:{type:Object,default:function(){return{width:void 0,height:void 0}}},hasBg:{type:Boolean,default:!1}},components:{widthInput:x},data:function(){return{normalButtons:[{text:"保存",icon:"baocun",handler:this.saveLayout},{text:"底图",icon:"tupiantianjia",handler:this.updateBG},{text:"复位",icon:"shuaxin",handler:this.restoreLayout},{text:"上一层",icon:"zhiding1",handler:this.levelUp},{text:"下一层",icon:"zhidi",handler:this.levelDown},{text:"回退",icon:"shangyibu1",handler:this.backStep},{text:"导出",icon:"yunduanxiazai",handler:this.exportImage}],layout:{buttons:[]}}},computed:Object(r["a"])({},Object(h["mapState"])("printingDesign",["compelPanelSize","showBorderLine"])),watch:{"canvasSet.width":function(t){var e=this;if(this.hasBg)if(t){var n=t/this.backgroundImage.width;this.canvasSet.height=this.backgroundImage.height*n}else this.$nextTick((function(){var t=$(".seat-designer-page").width(),n=t/e.backgroundImage.width;e.canvasSet.height=e.backgroundImage.height*n}))}},created:function(){this.layout.buttons=this.normalButtons},methods:{backStep:function(){},saveLayout:function(){this.$emit("save-layout")},restoreLayout:function(){var t={width:this.compelPanelSize.width,height:this.compelPanelSize.height,scale:1,left:0,top:0};this.$store.commit("printingDesign/changePanelSize",t)},updateBG:function(){var t=this,e=Object(u["b"])("dsf-seat-bg-upload");$(e).on("change",(function(){if(!e.files||0===e.files.length)return!1;var n=new FormData;n.append("file",e.files[0]);var i=function(n){if($(e).val(""),$(e).remove(),e=null,"error"===n)return t.$emit("update:hasBg",!1),!1;S.call(t,n[0])};u["j"].call(t,n,i)})),$(e).click()},levelUp:function(){f["a"].emit(d["a"].LEVEL_UP)},levelDown:function(){f["a"].emit(d["a"].LEVEL_DOWN)},changeShowBorder:function(t){this.$store.commit("printingDesign/changeShowBorderLine",t)},exportImage:function(){var t=dsf.layer.loading();$(".seat-designer-page .seat-box.border-dash").addClass("border-none");var e=document.getElementById("panel_outer");c()(e).then((function(e){var n=e.toDataURL("image/png"),i=document.createElement("a");i.style.display="none",i.download="证书套打.png",i.href=n,document.body.appendChild(i),i.click(),document.body.removeChild(i),$(".seat-designer-page .seat-box.border-dash").removeClass("border-none"),dsf.layer.closeLoading(t)}))}}};function S(t){var e=this,n=new Image;n.src=dsf.url.getWebPath(t.relativePath),n.onload=function(){e.$emit("update:hasBg",!0),e.$emit("update:backgroundImage",{width:n.naturalWidth,height:n.naturalHeight,relativePath:t.relativePath,absolutePath:t.absolutePath})},n.onerror=function(){dsf.layer.message("图片加载失败",!1),e.$emit("update:hasBg",!1)}}var k=w,C=Object(y["a"])(k,a,s,!1,null,null,null);C.options.__file="designer/seat/printingDesign/topTools.vue";var I=C.exports,L=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"designer-left"},[n("div",{staticClass:"designer-left-tools"},t._l(t.leftMenu.group,(function(e,i){return n("el-collapse",{key:i,model:{value:t.leftMenu.activeName,callback:function(e){t.$set(t.leftMenu,"activeName",e)},expression:"leftMenu.activeName"}},[n("el-collapse-item",{attrs:{title:e.title,name:e.title}},[n("div",{staticClass:"ds-tools-group-content",staticStyle:{padding:"10px"}},t._l(e.items,(function(e,i){return n("div",{key:i,staticClass:"ds-tool-item",attrs:{name:e.name,"data-type":e.type}},[t._v(" "+t._s(e.name)+" ")])})),0)])],1)})),1)])},z=[];L._withStripped=!0;var P={name:"LeftTools",data:function(){return{leftMenu:{activeName:["对象","辅助对象","自定义对象"],group:[{title:"对象",items:[{name:"文字",type:"text"},{name:"图片",type:"image"}]}]},originWidth:150,originHeight:150}},computed:Object(r["a"])({},Object(h["mapState"])("printingDesign",{panelSize:"panelSize",compelPanelSize:"compelPanelSize"})),mounted:function(){var t=this;$(".ds-tool-item").draggable({addClasses:!1,helper:function(){var t=$(this).text();return $('<div class="drag-item">'.concat(t,"</div>"))},cursor:"default",cursorAt:{top:-5,left:-5},stop:function(e,n){var i=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:e.pageX,y:e.pageY}),o=t.compelPanelSize.width||$(".seat-designer-page").width(),a=t.compelPanelSize.height||$(".seat-designer-page").height();if(i.x>=0&&i.x<=o&&i.y>=0&&i.y<=a){var s,r=$(e.target).data("type"),l=dsf.math.convertLocalCoordinate("#panel_outer",{x:e.pageX,y:e.pageY},t.panelSize.scale),c={id:dsf.uuid(),type:r,left:l.x,top:l.y,width:t.originWidth,height:t.originHeight,angle:0,isFrozenSty:!1,zIndex:1};"image"===r&&(s={bgImg:""},Object.assign(c,s)),"text"===r&&(s={text:"",fontFamily:"Microsoft YaHei",fontSize:20,letterSpacing:2,lineHeight:15,color:"#000",textAlign:"center",bold:!1,italic:!1,underline:!1,fontStyFrozen:!1},Object.assign(c,s)),t.$store.commit("printingDesign/addSeat2Panel",c)}}})}},E=P,O=Object(y["a"])(E,L,z,!1,null,null,null);O.options.__file="designer/seat/printingDesign/leftTools.vue";var D=O.exports,A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.showTool?n("div",{staticClass:"right-tool-box"},[n("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(0)}}},[n("el-popover",{attrs:{value:t.groupVisible[0],placement:"left-start",width:"360",trigger:"manual","popper-class":"ds-seat-design-popover"}},[n("div",{staticClass:"header"},[t._v(" 度量 "),n("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(0)}}})]),n("div",{staticClass:"inner"},[n("div",{staticClass:"title"},[n("label",{staticClass:"label-box"},[t._v("当前对象：")]),n("span",{domProps:{textContent:t._s(t.getInfoTypeName())}})]),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("X")]),n("el-input-number",{attrs:{value:t.info.left,size:"mini",controls:!1},on:{change:function(e){return t.info.left=e}}}),n("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("Y")]),n("el-input-number",{attrs:{value:t.info.top,size:"mini",controls:!1},on:{change:function(e){return t.info.top=e}}})],1),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("宽")]),n("el-input-number",{attrs:{value:t.info.width,size:"mini",min:0,controls:!1},on:{change:function(e){return t.updateWidth(e)}}}),n("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("高")]),n("el-input-number",{attrs:{value:t.info.height,size:"mini",min:0,controls:!1},on:{change:function(e){return t.updateHeight(e)}}})],1),n("div",{staticClass:"inner-item"},[n("label",{staticClass:"label-box"},[t._v("角度")]),n("el-input-number",{attrs:{value:t.info.angle,size:"mini",min:0,max:360,controls:!1},on:{change:function(e){return t.info.angle=e}}})],1)]),n("i",{staticClass:"iconfont icon-resize-",attrs:{slot:"reference"},slot:"reference"})])],1),"text"===t.info.type?n("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(1)}}},[n("el-popover",{attrs:{value:t.groupVisible[1],placement:"left",width:"360",trigger:"manual","popper-class":"ds-seat-design-popover"}},[n("div",{staticClass:"header"},[t._v(" 属性 "),n("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(1)}}})]),n("div",{staticClass:"inner"},[n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("字体")]),n("el-select",{attrs:{value:t.info.fontFamily},on:{change:function(e){t.info.fontStyFrozen=!1,t.info.fontFamily=e}}},t._l(t.fontFamilyList,(function(t,e){return n("el-option",{key:t.val,attrs:{value:t.val,label:t.text}})})),1)],1),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("颜色")]),n("el-color-picker",{attrs:{value:t.info.color},on:{"active-change":function(e){t.info.fontStyFrozen=!1,t.info.color=e}}})],1),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("大小")]),n("div",{staticClass:"slider-warp"},[n("el-slider",{attrs:{value:t.info.fontSize,"show-input":"","show-input-controls":!1},on:{input:function(e){t.info.fontStyFrozen=!1,t.info.fontSize=e}}})],1)]),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("行间距")]),n("div",{staticClass:"slider-warp"},[n("el-slider",{attrs:{value:t.info.lineHeight,"show-input":"","show-input-controls":!1,min:10,max:50},on:{input:function(e){t.info.fontStyFrozen=!1,t.info.lineHeight=e}}})],1)]),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("字间距")]),n("div",{staticClass:"slider-warp"},[n("el-slider",{attrs:{value:t.info.letterSpacing,"show-input":"","show-input-controls":!1,max:50},on:{input:function(e){t.info.fontStyFrozen=!1,t.info.letterSpacing=e}}})],1)]),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("效果")]),n("el-button-group",[n("el-button",{class:{active:t.info.italic},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.italic=!t.info.italic}}},[n("dsf-icon",{attrs:{name:"zitixieti"}})],1),n("el-button",{class:{active:t.info.bold},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.bold=!t.info.bold}}},[n("dsf-icon",{attrs:{name:"zitijiacu"}})],1),n("el-button",{class:{active:t.info.underline},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.underline=!t.info.underline}}},[n("dsf-icon",{attrs:{name:"zitixiahuaxian"}})],1)],1)],1),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("对齐")]),n("el-button-group",[n("el-button",{class:{active:"left"===t.info.textAlign},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.textAlign="left"}}},[n("dsf-icon",{attrs:{name:"zuoduiqi"}})],1),n("el-button",{class:{active:"center"===t.info.textAlign},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.textAlign="center"}}},[n("dsf-icon",{attrs:{name:"juzhongduiqi"}})],1),n("el-button",{class:{active:"right"===t.info.textAlign},attrs:{size:"mini"},on:{click:function(e){t.info.fontStyFrozen=!1,t.info.textAlign="right"}}},[n("dsf-icon",{attrs:{name:"youduiqi"}})],1)],1)],1),n("div",{staticClass:"inner-item item-fill-row"},[n("label",{staticClass:"label-box"},[t._v("内容")]),n("el-input",{attrs:{type:"textarea",rows:4},model:{value:t.info.text,callback:function(e){t.$set(t.info,"text",e)},expression:"info.text"}})],1)]),n("i",{staticClass:"iconfont icon-xingzhuang-wenzi",attrs:{slot:"reference"},slot:"reference"})])],1):t._e(),"image"===t.info.type?n("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(2)}}},[n("el-popover",{attrs:{value:t.groupVisible[2],placement:"left-start",width:"365",trigger:"manual","popper-class":"ds-seat-design-popover"}},[n("div",{staticClass:"header"},[t._v(" 上传 "),n("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(2)}}})]),n("div",{staticClass:"inner"},[n("div",{staticClass:"single-upload-box",on:{click:t.uploadSingle}},[t.info.bgImg?n("img",{attrs:{src:t.getImagePath(t.info.bgImg),alt:""}}):t._e()])]),n("i",{staticClass:"iconfont icon-tupiantianjia",attrs:{slot:"reference"},slot:"reference"})])],1):t._e()]):t._e()},j=[];A._withStripped=!0;n(463);var T={name:"RightTools",props:{},data:function(){return{showTool:!1,info:{},groupVisible:[!1,!1,!1],visiblePointer:null,oldVisibleStatus:!1,fontFamilyList:[{val:"SimSun",text:"宋体"},{val:"FangSong",text:"仿宋"},{val:"KaiTi",text:"楷书"},{val:"SimHei",text:"黑体"},{val:"Microsoft YaHei",text:"微软雅黑"},{val:"YouYuan",text:"幼圆"},{val:"LiSu",text:"隶书"}]}},computed:Object(r["a"])({},Object(h["mapState"])("printingDesign",{activeId:"activeId"})),watch:{activeId:function(t){var e=this;if(t)f["a"].emit(d["a"].GET_ACTIVE_SEAT,(function(t){e.info=t})),this.showTool=!0,this.$nextTick((function(){e.$set(e.groupVisible,e.visiblePointer,e.oldVisibleStatus)}));else{this.showTool=!1;var n=new Array(3);this.groupVisible=_.fill(n,!1)}},info:{handler:function(t){this.$store.commit("printingDesign/changeSeatInfo",t)},deep:!1}},methods:{uploadSingle:function(){var t=this,e=Object(u["b"])();$(e).on("change",(function(){if(!e.files||0===e.files.length)return!1;var n=new FormData;n.append("file",e.files[0]);var i=function(n){if($(e).val(""),$(e).remove(),e=null,"error"===n)return!1;t.info.bgImg=n[0].relativePath};u["j"].call(t,n,i)})),$(e).click()},closeGroup:function(t){this.visiblePointer=t,this.$set(this.groupVisible,t,!1),this.oldVisibleStatus=!1},showGroup:function(t){this.visiblePointer=t;var e=new Array(3);this.groupVisible=_.fill(e,!1),this.$set(this.groupVisible,t,!0),this.oldVisibleStatus=!0},getImagePath:function(t){return t?dsf.url.getWebPath(t):null},getInfoTypeName:function(){switch(this.info.type){case"text":return"文本";case"image":return"图片"}},updateWidth:function(t){this.info.width=t},updateHeight:function(t){this.info.height=t}}},F=T,M=Object(y["a"])(F,A,j,!1,null,null,null);M.options.__file="designer/seat/printingDesign/rightTools.vue";var R=M.exports,B=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"seat-designer-page",style:t.canvasCss,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.preRegion.apply(null,arguments)}}},[n("region",{attrs:{visible:t.regionVisible,region:t.regionRect}}),n("div",{style:t.panelSty,attrs:{id:"panel_outer"}},[t._t("seat"),n("div",{staticClass:"ds_seat_panel_bg",attrs:{id:"panel_bg"}})],2),t._t("seatPop")],2)},N=[];B._withStripped=!0;var V=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.visible?n("div",{staticClass:"region",style:t.regionSty}):t._e()},Y=[];V._withStripped=!0;var W={name:"Region",props:{visible:{type:Boolean,default:!1},region:{type:Object,default:function(){return{}}}},data:function(){return{test:!1}},computed:{regionSty:function(){return{left:this.region.left+"px",top:this.region.top+"px",width:this.region.width+"px",height:this.region.height+"px"}}},methods:{}},q=W,H=Object(y["a"])(q,V,Y,!1,null,null,null);H.options.__file="designer/seat/printingDesign/region.vue";var G=H.exports,X={name:"Canvas",components:{region:G},data:function(){return{regionVisible:!1,regionRect:{}}},computed:Object(r["a"])(Object(r["a"])({},Object(h["mapState"])("printingDesign",{compelPanelSize:"compelPanelSize",panelSize:"panelSize",canvasCss:function(t){var e=t.compelPanelSize,n=e.width,i=e.height,o=n?"".concat(n,"px"):"100%",a=i?"".concat(i,"px"):"100%";return{width:o,height:a}},panelParentSize:function(t){var e=t.compelPanelSize,n=e.width,i=e.height;return n=n||$(".seat-designer-page").width(),i=i||$(".seat-designer-page").height(),{width:n,height:i}}})),{},{panelSty:function(){return{width:this.panelSize.width?this.panelSize.width+"px":"100%",height:this.panelSize.height?this.panelSize.height+"px":"100%",left:this.panelSize.left+"px",top:this.panelSize.top+"px"}}}),watch:{compelPanelSize:{handler:function(t){var e=t.width,n=t.height,i={width:e,height:n,scale:1,left:0,top:0};this.$store.commit("printingDesign/changePanelSize",i)},deep:!0}},mounted:function(){var t=this;$(".seat-designer-page")[0].addEventListener("mousewheel",t.handleScroll)},methods:{handleScroll:function(t){if(t.ctrlKey){var e=this,n=t.wheelDelta<0?"down":"up",i=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY}),o=e.panelParentSize,a=o.width,s=o.height,r=a*e.panelSize.scale,l=s*e.panelSize.scale,c=i.x/r,u=i.y/l,f=e.panelSize.scale;if("up"===n?f+=.1:"down"===n&&(f-=.1),f>=.1){var d=$("#panel_outer"),h=a*f,p=s*f,g=d.position().left+i.x-h*c,m=d.position().top+i.y-p*u,v={scale:Math.round(10*f)/10,width:Math.floor(h),height:Math.floor(p),left:Math.floor(g),top:Math.floor(m)};e.$store.commit("printingDesign/changePanelSize",v)}t.preventDefault(),t.stopPropagation()}},preRegion:function(t){var e=this;e.$store.commit("printingDesign/changeActiveId","");var n=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});function i(t){e.regionVisible=!0;var i=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});e.$set(e.regionRect,"left",n.x>i.x?i.x:n.x),e.$set(e.regionRect,"top",n.y>i.y?i.y:n.y),e.$set(e.regionRect,"width",Math.abs(i.x-n.x)),e.$set(e.regionRect,"height",Math.abs(i.y-n.y))}function o(){$(document).off("mousemove.region"),e.$store.commit("printingDesign/changeRegionPosition",e.regionRect),e.regionVisible=!1,e.regionRect={}}$(document).off("mousemove.region"),$(document).on("mousemove.region",(function(t){i(t)})),$(document).one("mouseup.region",(function(){o()}))}}},K=X,U=Object(y["a"])(K,B,N,!1,null,null,null);U.options.__file="designer/seat/printingDesign/canvas.vue";var J=U.exports,Q=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"seat-item-container normal"},[t.verLine.visible?n("div",{staticClass:"vertical-line",style:t.verLineSty}):t._e(),t.horLine.visible?n("div",{staticClass:"horizontal-line",style:t.horLineSty}):t._e(),t.selectPosition.visible?n("div",{staticClass:"selected-box",style:t.selectSty,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectMove.apply(null,arguments)}}},[n("div",{staticClass:"select"},[n("div",{staticClass:"anchor circle",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectRotate.apply(null,arguments)}}}),n("div",{staticClass:"anchor line"}),n("div",{staticClass:"anchor lt",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"lt")}}}),n("div",{staticClass:"anchor t",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"t")}}}),n("div",{staticClass:"anchor rt",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"rt")}}}),n("div",{staticClass:"anchor l",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"l")}}}),n("div",{staticClass:"anchor r",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"r")}}}),n("div",{staticClass:"anchor lb",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"lb")}}}),n("div",{staticClass:"anchor b",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"b")}}}),n("div",{staticClass:"anchor rb",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"rb")}}}),n("div",{staticClass:"anchor info"},[t._v(" 宽:"+t._s(t.selectPosition.width)+";高:"+t._s(t.selectPosition.height)+";角度:"+t._s(t.selectPosition.angle)+" ")])])]):t._e(),t._l(t.items,(function(e){return n("div",{key:e.id,staticClass:"seat-box",class:{active:t.activeId===e.id,"border-dash":!t.showBorderLine&&t.activeId!==e.id},style:t.getItemSty(e),on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preMove(n,e)}}},[n("div",{staticClass:"seat",on:{dblclick:function(n){return n.stopPropagation(),t.openEdit(n,e)}}},[n("div",{staticClass:"anchor circle",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preRotate(n,e)}}}),n("div",{staticClass:"anchor line"}),n("div",{staticClass:"anchor lt",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"lt")}}}),n("div",{staticClass:"anchor t",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"t")}}}),n("div",{staticClass:"anchor rt",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"rt")}}}),"text"===e.type?n("p",{style:t.getFontSty(e)},[t._v(t._s(e.text))]):t._e(),n("div",{staticClass:"anchor l",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"l")}}}),n("div",{staticClass:"anchor r",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"r")}}}),n("div",{staticClass:"anchor lb",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"lb")}}}),n("div",{staticClass:"anchor b",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"b")}}}),n("div",{staticClass:"anchor rb",on:{mousedown:function(n){return!n.type.indexOf("key")&&t._k(n.keyCode,"left",37,n.key,["Left","ArrowLeft"])||"button"in n&&0!==n.button?null:t.preScale(n,e,"rb")}}}),n("div",{staticClass:"anchor info"},[t._v("宽:"+t._s(e.width)+";高:"+t._s(e.height)+";角度:"+t._s(e.angle))])])])}))],2)},Z=[];Q._withStripped=!0;n(28),n(52),n(48),n(966),n(510),n(64),n(185),n(196),n(23),n(16);var tt={name:"SeatItem",props:{items:{type:Array,default:function(){return[]}}},data:function(){return{selectedItems:[],rectMinSize:[40,40],selectPosition:{top:0,left:0,width:0,height:0,visible:!1},verLine:{left:0,visible:!1},horLine:{top:0,visible:!1}}},computed:Object(r["a"])(Object(r["a"])({},Object(h["mapState"])("printingDesign",{panelSize:"panelSize",newSeatItem:"newSeatItem",activeId:"activeId",regionPosition:"regionPosition",seatInfo:"seatInfo",showBorderLine:"showBorderLine"})),{},{selectSty:function(){var t=this.panelSize.scale;return{width:this.selectPosition.width*t+"px",height:this.selectPosition.height*t+"px",left:this.selectPosition.left*t+"px",top:this.selectPosition.top*t+"px",transform:"rotate(".concat(this.selectPosition.angle,"deg)")}},verLineSty:function(){return{left:"".concat(this.verLine.left*this.panelSize.scale)+"px"}},horLineSty:function(){return{top:"".concat(this.horLine.top*this.panelSize.scale)+"px"}}}),watch:{newSeatItem:function(t){u["c"].call(this);var e=_.assign({},t);this.items.push(e)},regionPosition:function(t){var e=this;if(_.isEmpty(t)||0===t.width||0===t.height)return u["c"].call(e),e.selectedItems=[],void gt.call(e);e.selectedItems=_.filter(e.items,(function(t){return nt.call(e,t)})),u["c"].call(e),0!==e.selectedItems.length&&(1===e.selectedItems.length?e.$store.commit("printingDesign/changeActiveId",e.selectedItems[0].id):e.selectedItems.length>1&&(e.selectPosition=ht(e.selectedItems)))},seatInfo:{handler:function(t,e){var n=_.findIndex(this.items,(function(e){return e.id===t.id}));this.$set(this.items,n,t)},deep:!1},selectedItems:function(t){t&&t.length>0?this.$store.commit("printingDesign/changeHaveSelectedItems",!0):this.$store.commit("printingDesign/changeHaveSelectedItems",!1)}},beforeDestroy:function(){$(document).off("mouseup.scaleSeatItem"),$(document).off("mousemove.scaleSeatItem")},mounted:function(){var t=this;f["a"].on(d["a"].KEY_CTRL_D,(function(){gt.call(t),t.selectedItems=[],t.$store.commit("printingDesign/changeActiveId","")})),f["a"].on(d["a"].KEY_DELETE,(function(){t.deleteActiveSeatItem()})),f["a"].on(d["a"].GET_ACTIVE_SEAT,(function(e){var n=t.items.find((function(e){return e.id===t.activeId}));e&&e(n)})),f["a"].on(d["a"].LEVEL_UP,(function(){_.isArray(t.selectedItems)&&0!==t.selectedItems.length&&(u["c"].call(t),t.selectedItems.forEach((function(t){return t.zIndex+=1})))})),f["a"].on(d["a"].LEVEL_DOWN,(function(){_.isArray(t.selectedItems)&&0!==t.selectedItems.length&&(u["c"].call(t),t.selectedItems.forEach((function(t){return t.zIndex=t.zIndex>1?t.zIndex-1:1})))}))},methods:{getItemSty:function(t){if(t.isFrozenSty)return t.style;var e=this.panelSize.scale,n={width:t.width*e+"px",height:t.height*e+"px",left:t.left*e+"px",top:t.top*e+"px",zIndex:t.zIndex,transform:"rotate(".concat(t.angle,"deg)")};return"text"!==t.type&&(n.background=bt(t)),t.style=n,n},getFontSty:function(t){var e=this.panelSize.scale;if(t.fontStyFrozen)return t.fontSty;var n={color:t.color,whiteSpace:"pre-wrap",fontSize:t.fontSize*e+"px",letterSpacing:t.letterSpacing*e+"px",lineHeight:t.lineHeight/10*t.fontSize*e+"px",textAlign:t.textAlign,fontStyle:t.italic?"italic":"normal",fontWeight:t.bold?"bold":"normal",fontFamily:t.fontFamily,textDecoration:t.underline?"underline":"none"};return t.fontSty=n,t.fontStyFrozen=!0,n},clearSelectedItems:function(){this.selectedItems=[],gt.call(this),this.$store.commit("printingDesign/changeActiveId","")},preScale:function(t,e,n){t.stopPropagation(),t.preventDefault();var i=this;u["c"].call(i,!1);var o=_.assign({},e),a=_.assign({},e),s=ot(o,n);function r(t){if(n&&s){var r=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},i.panelSize.scale),l=at(s,o,a,r,n,i.rectMinSize);_.assign(e,l)}}function l(){u["c"].call(i),$(document).off("mousemove.scaleSeatItem")}$(document).off("mousemove.scaleSeatItem"),$(document).on("mousemove.scaleSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),r(t)}),5)),$(document).one("mouseup.scaleSeatItem",(function(){l()}))},preMove:function(t,e){t.preventDefault(),t.stopPropagation();var n=this;et.call(n,e),u["c"].call(n),n.verLine.visible=!1,n.horLine.visible=!1;var i=mt.call(n),o=yt(i),a=e.left,s=e.top,r=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale);function l(t){var i=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale),l={x:i.x-r.x,y:i.y-r.y};e.left=parseInt(a+l.x),e.top=parseInt(s+l.y),n.verLine.visible=!1,n.horLine.visible=!1;var c=it(e,["lt"]),u=yt(c),f=vt(u,o,e);f&&(n.horLine.top=f.top,n.horLine.visible=_.isNumber(f.top),n.verLine.left=f.left,n.verLine.visible=_.isNumber(f.left))}function c(){$(document).off("mousemove.moveSeatItem"),u["c"].call(n),n.verLine.visible=!1,n.horLine.visible=!1}$(document).off("mousemove.moveSeatItem"),$(document).on("mousemove.moveSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),l(t)}),5)),$(document).one("mouseup.moveSeatItem",(function(){c()}))},preRotate:function(t,e){t.stopPropagation(),t.preventDefault(),$(".ds-seat-design").addClass("is-rotating");var n=this;u["c"].call(n);var i=ct(e);function o(t){var o=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale);e.angle=st(i,o)}function a(){$(document).off("mousemove.rotateSeatItem"),u["c"].call(n),$(".ds-seat-design").removeClass("is-rotating")}$(document).off("mousemove.rotateSeatItem"),$(document).on("mousemove.rotateSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),o(t)}),5)),$(document).one("mouseup.rotateSeatItem",(function(){a()}))},selectRotate:function(t){t.stopPropagation(),t.preventDefault(),$(".ds-seat-design").addClass("is-rotating");var e=this;u["c"].call(e);var n=_.assign({},e.selectPosition),i=ct(n),o={};function a(t){var a=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale),s=st(i,a),r=s-n.angle;e.selectPosition.angle=s,e.selectedItems.forEach((function(t){var e=o[t.id],n=dsf.math.getRotatedPiont(e.left,e.top,i.x,i.y,s),a=n.x+e.width/2,l=n.y+e.height/2,c=dsf.math.getRotatedPiont(a,l,n.x,n.y,s);n=dsf.math.getRotatedPiont(n.x,n.y,c.x,c.y,-s),t.top=parseInt(n.y),t.left=parseInt(n.x),t.angle=(e.angle+r)%360,e.angle<0&&(t.angle=360+e.angle)}))}function s(){$(".ds-seat-design").removeClass("is-rotating"),e.selectPosition=ht(e.selectedItems),$(document).off("mousemove.rotateSelect"),u["c"].call(e)}e.items.forEach((function(t){o[t.id]=_.assign({},t)})),$(document).off("mousemove.rotateSelect"),$(document).on("mousemove.rotateSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),a(t)}),5)),$(document).one("mouseup.rotateSelect",(function(){s()}))},selectScale:function(t,e){t.stopPropagation(),t.preventDefault();var n=this;u["c"].call(n);var i=_.assign({},n.selectPosition),o=_.assign({},n.selectPosition),a={};n.items.forEach((function(t){a[t.id]=_.assign({},t)}));var s=ot(i,e),r=rt(n.selectedItems,n.selectPosition);function l(t){if(e&&s){var l=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale);n.selectPosition=at(s,i,o,l,e,n.rectMinSize),n.selectedItems.forEach((function(t){var o=lt(a[t.id],i,n.selectPosition,e,r);_.assign(t,o)}))}}function c(){$(document).off("mousemove.scaleSelect"),u["c"].call(n),n.selectPosition=ht(n.selectedItems)}$(document).off("mousemove.scaleSelect"),$(document).on("mousemove.scaleSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),l(t)}),5)),$(document).one("mouseup.scaleSelect",(function(){c()}))},selectMove:function(t){t.preventDefault(),t.stopPropagation();var e=this;u["c"].call(e);var n=e.selectPosition.left,i=e.selectPosition.top,o={};e.items.forEach((function(t){o[t.id]=_.assign({},t)}));var a=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale);function s(t){var s=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale),r={x:s.x-a.x,y:s.y-a.y},l=n+r.x,c=i+r.y;e.selectPosition.left=parseInt(l),e.selectPosition.top=parseInt(c),e.selectedItems.forEach((function(t){t.left=parseInt(o[t.id].left+r.x),t.top=parseInt(o[t.id].top+r.y)}))}function r(){$(document).off("mousemove.moveSelect"),u["c"].call(e)}$(document).off("mousemove.moveSelect"),$(document).on("mousemove.moveSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),s(t)}),5)),$(document).one("mouseup.moveSelect",(function(){r()}))},deleteActiveSeatItem:function(){if(0!==this.selectedItems.length){var t=_.differenceWith(this.items,this.selectedItems,(function(t,e){return t.id===e.id}));this.$emit("update:items",t),this.clearSelectedItems()}},openEdit:function(t,e){if("image"!==e.type&&!$(t.target).hasClass("anchor")){var n=document.createElement("textarea"),i=function(t){e.text=t,$(n).remove(),n=null};$(t.target).append(n),$(n).val(e.text),$(n).on("blur",(function(){i($(this).val())})),$(n).bind("keypress",(function(t){13===t.keyCode&&i($(this).val())})),$(n).focus()}}}};function et(t){this.activeId!==t.id&&(gt.call(this),this.selectedItems=[t],this.$store.commit("printingDesign/changeActiveId",t.id))}function nt(t){var e=it(t),n=ut(e),i=this.panelSize,o=(i.left,i.top,i.scale),a=this.regionPosition,s=a.left,r=a.top,l=a.width,c=a.height,u=$(".seat-designer-page").offset(),f={x:s+u.left,y:r+u.top},d={x:s+u.left+l,y:r+u.top+c};f=dsf.math.convertLocalCoordinate("#panel_outer",f,o),d=dsf.math.convertLocalCoordinate("#panel_outer",d,o);var h=n.min_x>=f.x,p=n.max_x<=d.x,g=n.min_y>=f.y,m=n.max_y<=d.y;return h&&p&&g&&m}function it(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["lt","rt","rb","lb"],n=t.angle,i=t.left,o=t.top,a=t.left+t.width,s=t.top+t.height,r={lt:0,lb:0,rt:0,rb:0},l=.5*(a-i)+i,c=.5*(s-o)+o;return e.includes("lt")&&(r.lt=dsf.math.getRotatedPiont(i,o,l,c,n)),e.includes("rt")&&(r.rt=dsf.math.getRotatedPiont(a,o,l,c,n)),e.includes("rb")&&(r.rb=dsf.math.getRotatedPiont(a,s,l,c,n)),e.includes("lb")&&(r.lb=dsf.math.getRotatedPiont(i,s,l,c,n)),r}function ot(t,e){var n={};e.length>1?(e.indexOf("l")>=0?n.x=t.left+t.width:n.x=t.left,e.indexOf("t")>=0?n.y=t.top+t.height:n.y=t.top):"r"===e||"b"===e?(n.x=t.left,n.y=t.top):"l"!==e&&"t"!==e||(n.x=t.left+t.width,n.y=t.top+t.height);var i={x:t.left+t.width/2,y:t.top+t.height/2};return n=dsf.math.getRotatedPiont(n.x,n.y,i.x,i.y,t.angle),n}function at(t,e,n,i,o,a){var s,r,l=dsf.math.getDistance(t,i),c=dsf.math.getRadina(t,i,-dsf.math.a2r(e.angle)),u={x:Math.cos(c)*l+e.left,y:Math.sin(c)*l+e.top};if(o.indexOf("r")>=0?s=u.x-e.left:o.indexOf("l")>=0&&(s=e.left-u.x),o.indexOf("b")>=0?r=u.y-e.top:o.indexOf("t")>=0&&(r=e.top-u.y),o.length>1){var f=s/e.width;n.width=e.width*f,n.height=e.height*f}else dsf.isDef(s)?n.width=s:n.width=e.width,dsf.isDef(r)?n.height=r:n.height=e.height;n.width<a[0]&&(n.width=a[0]),n.height<a[1]&&(n.height=a[1]);var d={};o.length>1?(o.indexOf("r")>=0?d.x=t.x+n.width:o.indexOf("l")>=0?d.x=t.x-n.width:d.x=t.x,o.indexOf("b")>=0?d.y=t.y+n.height:o.indexOf("t")>=0?d.y=t.y-n.height:d.y=t.y):"r"===o||"b"===o?(d.x=t.x+n.width,d.y=t.y+n.height):"l"!==o&&"t"!==o||(d.x=t.x-n.width,d.y=t.y-n.height);var h=dsf.math.getRotatedPiont(d.x,d.y,t.x,t.y,e.angle),p={x:.5*(t.x+h.x),y:.5*(t.y+h.y)},g=dsf.math.getRotatedPiont(t.x,t.y,p.x,p.y,-e.angle);return o.length>1?(o.indexOf("r")>=0?n.left=g.x:o.indexOf("l")>=0?n.left=g.x-n.width:n.left=g.x-n.width/2,o.indexOf("b")>=0?n.top=g.y:o.indexOf("t")>=0?n.top=g.y-n.height:n.top=g.y-n.height/2):"r"===o||"b"===o?(n.left=g.x,n.top=g.y):"l"!==o&&"t"!==o||(n.left=g.x-n.width,n.top=g.y-n.height),ft(n),n}function st(t,e){var n=dsf.math.getRadina(t,e),i=90+dsf.math.r2a(n);return i=Math.ceil(i)%360,i}function rt(t,e){var n={};return _.forEach(t,(function(t){var i=_.assign({},t);n[t.id]={left:(i.left-e.left)/e.width,top:(i.top-e.top)/e.height,width:i.width/e.width,height:i.height/e.height}})),n}function lt(t,e,n,i,o){var a=_.assign({},t),s=o[a.id];if(a.left=n.left+n.width*s.left,a.top=n.top+n.height*s.top,2===i.length){var r=n.width/e.width,l=n.height/e.height;r=.5*(r+l),a.width=r*t.width,a.height=r*t.height}else 1===i.length&&(a.width=n.width*s.width,a.height=n.height*s.height);return dt(a),a}function ct(t){return{x:t.left+t.width/2,y:t.top+t.height/2}}function ut(t){var e,n,i,o;return _.forIn(t,(function(t){e=e||t.x,n=n||t.x,i=i||t.y,o=o||t.y,e=e<=t.x?e:t.x,n=n>=t.x?n:t.x,i=i<=t.y?i:t.y,o=o>=t.y?o:t.y})),{min_x:e,min_y:i,max_x:n,max_y:o}}function ft(t){t.top=parseInt(t.top),t.left=parseInt(t.left),t.width=parseInt(t.width),t.height=parseInt(t.height)}function dt(t){t.top=Math.round(t.top),t.left=Math.round(t.left),t.width=Math.round(t.width),t.height=Math.round(t.height)}function ht(t){var e,n,i,o,a;return _.forEach(t,(function(t){a=it(t),_.forIn(a,(function(t){e=e||t.x,n=n||t.x,i=i||t.y,o=o||t.y,e=e<=t.x?e:t.x,n=n>=t.x?n:t.x,i=i<=t.y?i:t.y,o=o>=t.y?o:t.y}))})),{left:pt(e),top:pt(i),width:pt(n-e),height:pt(o-i),angle:0,visible:!0}}function pt(t){return t<0?Math.floor(t):Math.ceil(t)}function gt(){this.selectPosition={top:0,left:0,width:0,height:0,angle:0,visible:!1}}function mt(){var t=this,e=_.filter(this.items,(function(e){return e.id!==t.activeId}));return e.map((function(t){return it(t,["lt"])}))}function vt(t,e,n){for(var i={},o=0,a=0;a<e.length;a++)if(t.left>=e[a].left-3&&t.left<=e[a].left+3&&(i.left=e[a].left,o+=1,0===n.angle&&(n.left=i.left)),t.top>=e[a].top-3&&t.top<=e[a].top+3&&(i.top=e[a].top,o+=1,0===n.angle&&(n.top=i.top)),2===o)break;return i.left||i.top?i:null}function yt(t){var e=[],n={};return _.isArray(t)?(_.forEach(t,(function(t){n={left:Math.round(t.lt.x),top:Math.round(t.lt.y)},e.push(n)})),_.uniqWith(e,_.isEqual)):_.isObject(t)?{left:Math.round(t.lt.x),top:Math.round(t.lt.y)}:void 0}function bt(t){var e=dsf.url.getAbsolutePath(t.bgImg),i=n(967),o=t.bgImg?e:i;return"center / contain no-repeat url(".concat(o,")")}var xt=tt,_t=Object(y["a"])(xt,Q,Z,!1,null,null,null);_t.options.__file="designer/seat/printingDesign/seatItem.vue";var wt=_t.exports,St=n(951),kt={name:"DsfSeatDesign",components:{topTools:I,leftTools:D,rightTools:R,PrintCanvas:J,seatItem:wt},data:function(){return{keyStack:[],postData:{_id:"",backgroundImage:{},canvasSet:{width:void 0,height:void 0},hasBg:!1,items:[]}}},computed:{},watch:{"postData.backgroundImage":function(){u["a"].call(this)}},created:function(){var t=this,e=dsf.url.getWebPath("$/seat_config/seat/printingDesign.js");this.$http.importFiles(e).then((function(e){t.layoutConfig=new St["a"](printingDesignConfig,t.$route.query.opt),t.bindShortKey(),t.getSeatInfo()}))},beforeDestroy:function(){$(document).off("keydown"),$(document).off("keyup")},methods:{saveLayout:function(){this.saveByPub()},bindShortKey:function(){var t=["ctrl","ctrl-d","ctrl-s"];Object(u["g"])(this.keyStack,t)},saveByDev:function(){var t=Ct.call(this),e=this.$route.query.id||dsf.uuid();t._id=e,localStorage.setItem("printing_"+e,JSON.stringify(t));var n=this.$route.query,i=Object.assign({},n,{id:e});this.$router.replace({path:this.$route.path,query:i})},saveByPub:function(){var t=this,e=Ct.call(this),n={pageName:"edit",namespace:"dsfa.printing.designcontent",data:JSON.stringify(e)},i=dsf.layer.loading();this.$http.post(this.layoutConfig.saveLayoutUrl,n).done((function(e){e.success?(t.postData._id=e.data._id,t.$router.replace({path:t.$route.path,query:{id:e.data._id}}),dsf.layer.message("保存成功")):dsf.layer.message("证书套打保存失败",!1)})).error((function(t){dsf.layer.message("证书套打保存失败",!1)})).always((function(){dsf.layer.closeLoading(i)}))},getSeatInfo:function(){this.getInfoPub()},getInfoDev:function(){var t=this.$route.query.id;if(t){var e=JSON.parse(localStorage.getItem("printing_"+t));e&&(_.isEmpty(e.canvasSet)&&(e.canvasSet={width:void 0,height:void 0}),this.postData=e)}},getInfoPub:function(){this.$route.query.id}}};function Ct(){var t=_.cloneDeep(this.postData);return t.items.forEach((function(t){t.isFrozenSty=!1})),t}var It=kt,$t=(n(968),Object(y["a"])(It,i,o,!1,null,null,null));$t.options.__file="designer/seat/printingDesign.vue";e["default"]=$t.exports}}]);
//# sourceMappingURL=dsf-platform.printingDesign.js.map