/*!
 * Name: @dsf/cli-platform
 * Version: 0.2.46-alpha.11
 * Description: 平台基础包
 * BuildTime: 2021/7/14 下午4:42:57
 */
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[9],{946:function(t,e,i){"use strict";var n=i(187),o=i(188),s=(i(24),i(25),i(475),function(){function t(){Object(n["a"])(this,t),this.events={}}return Object(o["a"])(t,[{key:"listen",value:function(t,e){if(void 0===this.events[t])this.events[t]=[e];else{var i=this.events[t];if(!_.isArray(i))return void"请使用 on 来监听 ".concat(t," 事件");i.push(e)}}},{key:"dispatch",value:function(t,e){var i=this.events[t];i&&_.isArray(i)&&i.forEach((function(t){t(e)}))}},{key:"on",value:function(t,e){void 0===this.events[t]?this.events[t]=e:_.isArray(this.events[t])&&"请使用 listen 来监听 ".concat(t," 事件")}},{key:"emit",value:function(t,e){var i=this.events[t];i&&(_.isArray(i)||i(e))}},{key:"off",value:function(t){this.events[t]=void 0}},{key:"clear",value:function(){this.events={}}},{key:"$getAllListener",value:function(){return Object.entries(this.events)}}]),t}()),a=new s;window.$simpleEventBus=a,e["a"]=a},947:function(t,e,i){"use strict";i.d(e,"b",(function(){return n})),i.d(e,"a",(function(){return o}));var n="file/upload/",o={CONFIG_FILE_LOADED:"config_file_loaded",KEY_DELETE:"key_delete",KEY_CTRL_D:"key_ctrl_d",BODY_EMPTY_CLICK:"body_empty_click",SEAT_POP:"seat_pop",GET_ACTIVE_SEAT:"get_active_seat",CLEAN_ALL_SEAT_NUM:"clean_all_seat_num",CLEAN_SELECT_SEAT_NUM:"clean_select_seat_num",AFTER_QUICK_ORDER:"after_quick_order",PERSON_REVERT_TREE:"person_revert_tree",LEFT_CLICK_SEAT:"left_click_seat",AUTO_SEAT:"auto_seat",LEVEL_UP:"level_up",LEVEL_DOWN:"level_down"}},948:function(t,e,i){"use strict";i.d(e,"j",(function(){return s})),i.d(e,"i",(function(){return a})),i.d(e,"d",(function(){return r})),i.d(e,"e",(function(){return l})),i.d(e,"c",(function(){return c})),i.d(e,"h",(function(){return u})),i.d(e,"b",(function(){return f})),i.d(e,"a",(function(){return h})),i.d(e,"g",(function(){return d})),i.d(e,"f",(function(){return p}));i(24),i(25),i(15),i(23),i(26),i(185),i(196);var n=i(947),o=i(946);function s(t,e){var i=this,o={headers:{"Content-Type":"multipart/form-data"},transformRequest:[function(t,e){return t}]},s=dsf.layer.loading();i.$http.post(n["b"],t,o).done((function(t){if(!dsf.isDef(t.data)||!t.success)return dsf.layer.message(t.message,!1),e&&e("error"),!1;e&&e(t.data)})).error((function(t){dsf.layer.message("上传图片失败",!1),e&&e("error")})).always((function(){dsf.layer.closeLoading(s)}))}function a(t){var e=t.member[0],i=t.height-e.height*t.rows,n=t.width-e.width*t.cols,o=t.rows>1?i/(t.rows-1):0,s=t.cols>1?n/(t.cols-1):0;t.member.forEach((function(t){t.rowIndex>0&&(t.top=_.floor((t.height+o)*t.rowIndex,2)),t.colIndex>0&&(t.left=_.floor((t.width+s)*t.colIndex,2))}))}function r(t){var e=t.member[0],i=t.width-e.width*t.cols;return 1===t.cols?0:_.floor(i/(t.cols-1),2)}function l(t){var e=t.member[0],i=t.height-e.height*t.rows;return 1===t.rows?0:_.floor(i/(t.rows-1),2)}function c(){var t,e=this,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.items.forEach((function(t){t.isFrozenSty=!0,e.selectedItems.forEach((function(e){t.id===e.id&&(t.isFrozenSty=!1)}))})),(null===this||void 0===this||null===(t=this.groups)||void 0===t?void 0:t.length)>0&&this.groups.forEach((function(t){t.isFrozenSty=!0,t.isFrozenMemberSty=!0,e.selectedItems.forEach((function(e){t.id===e.id&&(t.isFrozenSty=!1,!i&&(t.isFrozenMemberSty=!1))}))}))}function u(){this.items.forEach((function(t){t.isFrozenSty=!1})),this.groups.forEach((function(t){t.isFrozenSty=!1,t.isFrozenMemberSty=!1}))}function f(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dsf-seat-upload";$("input[name='".concat(t,"']")).remove();var e=document.createElement("input");return e.type="file",e.accept="image/*",e.style.display="none",e.name=t,document.body.appendChild(e),e}function h(){var t=this;if(!_.isEmpty(t.postData.backgroundImage)){var e=t.postData.backgroundImage.width,i=t.postData.backgroundImage.height,n=t.postData.canvasSet.width||$(".seat-designer-page").width(),o=n/e;t.postData.canvasSet.width=n,t.postData.canvasSet.height=i*o,$("#panel_bg").css("background-image","url("+t.postData.backgroundImage.absolutePath+")")}}function d(t,e){var i,s=function(t){switch(t){case 17:t="ctrl";break;case 68:t="d";break;case 65:t="a";break;case 46:t="delete";break;case 16:t="shift";break;case 83:t="s";break;default:t=null}return t};$("body").on("keydown",(function(a){if(i=s(a.keyCode),i){var r=t.indexOf(i);-1===r&&t.push(i);var l=t.join("-");e.includes(l)&&(a.stopPropagation(),a.preventDefault()),"ctrl-d"===l&&o["a"].emit(n["a"].KEY_CTRL_D),"delete"===l&&o["a"].emit(n["a"].KEY_DELETE)}})),$("body").on("keyup",(function(e){e.stopPropagation(),e.preventDefault(),i=s(e.keyCode),_.pull(t,i)}))}function p(t,e){return{id:t.id,pid:t.parentId,belong:t.belong,currentState:t.stateList[1],person:e,seatNum:t.seatNum}}},949:function(t,e,i){var n=i(17),o=i(21),s=i(950).f,a=o((function(){return!Object.getOwnPropertyNames(1)}));n({target:"Object",stat:!0,forced:a},{getOwnPropertyNames:s})},950:function(t,e,i){var n=i(87),o=i(186).f,s={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],r=function(t){try{return o(t)}catch(e){return a.slice()}};t.exports.f=function(t){return a&&"[object Window]"==s.call(t)?r(t):o(n(t))}},951:function(t,e,i){"use strict";i.d(e,"a",(function(){return s}));var n=i(187),o=i(188),s=(i(15),i(24),i(25),i(949),function(){function t(e,i){var o=this;Object(n["a"])(this,t),this.config=e,i||this.alert("url里面缺少必要的opt参数"),this.config[i]||this.alert("[".concat(this.config.name,"] url里面的opt参数没有对应的配置项")),Object.getOwnPropertyNames(this.config[i]).forEach((function(t){o[t]=o.config[i][t]}))}return Object(o["a"])(t,[{key:"alert",value:function(t){throw dsf.layer.alert({title:"警告",type:"warning",message:t}),new Error(t)}}]),t}())},953:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"input-box"},[i("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.canvasSet,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"画布宽"}},[i("el-input-number",{attrs:{controls:!1,precision:0,placeholder:"自适应"},model:{value:t.canvasSet.width,callback:function(e){t.$set(t.canvasSet,"width",e)},expression:"canvasSet.width"}})],1),i("el-form-item",{attrs:{label:"画布高"}},[i("el-input-number",{attrs:{controls:!1,disabled:t.hasBg,precision:0,placeholder:"自适应"},model:{value:t.canvasSet.height,callback:function(e){t.$set(t.canvasSet,"height",e)},expression:"canvasSet.height"}})],1)],1)],1)},o=[];n._withStripped=!0;var s={name:"WidthInput",props:{canvasSet:{type:Object,required:!0},hasBg:{type:Boolean}},data:function(){return{}},watch:{canvasSet:{handler:function(t){var e=this,i=t.width,n=t.height,o=$(".seat-designer-page").offset().left,s=$(".seat-designer-page").offset().top,a=$(window).height(),r=$(window).width();i&&i+o>r?$(".seat-designer-center").css({"overflow-x":"scroll"}):$(".seat-designer-center").css({"overflow-x":"auto"}),n&&n+s>a?$(".seat-designer-center").css("overflow-y","scroll"):$(".seat-designer-center").css("overflow-y","auto"),e.$store.commit("seatDesign/changeCompelPanelSize",t)},deep:!0}}},a=s,r=i(0),l=Object(r["a"])(a,n,o,!1,null,null,null);l.options.__file="designer/seat/seatDesign/widthInput.vue";e["a"]=l.exports},954:function(t,e,i){var n=i(963);"string"===typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);var o=i(40).default;o("4a9d2128",n,!1,{sourceMap:!1,shadowMode:!1})},962:function(t,e,i){"use strict";i(954)},963:function(t,e,i){"use strict";i.r(e)},983:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"ds-designer ds-seat-container ds-seat-design"},[i("div",{staticClass:"designer-head"},[i("top-tools",t._b({on:{"save-layout":t.saveLayout}},"top-tools",t.postData,!1,!0))],1),i("div",{staticClass:"designer-content"},[i("div",{staticClass:"seat-designer-center"},[i("left-tools"),i("seat-canvas",{scopedSlots:t._u([{key:"seat",fn:function(){return[i("seat-item",t._b({},"seat-item",t.postData,!1,!0))]},proxy:!0},{key:"seatPop",fn:function(){return[i("seat-pop")]},proxy:!0}])}),i("right-tools")],1)])])},o=[];n._withStripped=!0;i(10),i(35),i(24),i(25);var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"designer_tools"},[t._l(t.layout.buttons,(function(t,e){return i("DsfButton",{key:e,attrs:{icon:t.icon,text:t.text,"btn-style":"icon-text"},on:{click:function(e){return t.handler(e,t)}}})})),i("width-input",{attrs:{"canvas-set":t.canvasSet,"has-bg":t.hasBg}})],2)},a=[];s._withStripped=!0;var r=i(472),l=i(6),c=(i(20),i(948)),u=i(946),f=i(947),h=i(266),d=i(953),p={name:"TopTools",props:{items:{type:Array,default:function(){return[]}},groups:{type:Array,default:function(){return[]}},backgroundImage:{type:Object,default:function(){return{url:"",width:0,height:0}}},canvasSet:{type:Object,default:function(){return{width:void 0,height:void 0}}},hasBg:{type:Boolean,default:!1}},components:{widthInput:d["a"]},data:function(){return{normalButtons:[{text:"保存",icon:"baocun",handler:this.saveLayout},{text:"序号设置",icon:"shuzishurukuang",handler:this.setNum},{text:"底图",icon:"tupiantianjia",handler:this.updateBG},{text:"复位",icon:"shuaxin",handler:this.restoreLayout},{text:"回退",icon:"shangyibu1",handler:this.backStep}],numButtons:[{text:"确定",icon:"dui1",handler:this.numSave},{text:"取消",icon:"icon2",handler:this.numCancel},{text:"回退",icon:"shangyibu1",handler:this.backStep},{text:"全部清空",icon:"shanchu",handler:this.numClean}],layout:{buttons:[]}}},computed:Object(l["a"])({},Object(h["mapState"])("seatDesign",["compelPanelSize","switchNumSet","haveSelectedItems"])),watch:{"canvasSet.width":function(t){var e=this;if(this.hasBg)if(t){var i=t/this.backgroundImage.width;this.canvasSet.height=this.backgroundImage.height*i}else this.$nextTick((function(){var t=$(".seat-designer-page").width(),i=t/e.backgroundImage.width;e.canvasSet.height=e.backgroundImage.height*i}))},switchNumSet:function(t){this.layout.buttons=t?this.numButtons:this.normalButtons},haveSelectedItems:function(t){var e,i=[{text:"确定",icon:"dui1",handler:this.numSave},{text:"取消",icon:"icon2",handler:this.numCancel},{text:"回退",icon:"shangyibu1",handler:this.backStep}];e=t?[{text:"当前清空",icon:"kongjianweixuan",handler:this.numClear}]:[{text:"全部清空",icon:"shanchu",handler:this.numClean}],this.numButtons=i.concat(e),this.switchNumSet&&(this.layout.buttons=i.concat(e))}},created:function(){this.layout.buttons=this.normalButtons},methods:{backStep:function(){},setNum:function(){this.$store.commit("seatDesign/changeSwitchNumSet",!0)},numSave:function(){this.$store.commit("seatDesign/changeSwitchNumSet",!1)},numCancel:function(){this.$store.commit("seatDesign/changeSwitchNumSet",!1)},numClean:function(){u["a"].emit(f["a"].CLEAN_ALL_SEAT_NUM)},numClear:function(){u["a"].emit(f["a"].CLEAN_SELECT_SEAT_NUM)},saveLayout:function(){var t,e={},i=function(t){return t.seatNum?e[t.seatNum]?(dsf.layer.message("座位序号必须是唯一的，不能相同",!1),!1):(e[t.seatNum]=t.seatNum,!0):(dsf.layer.message("座位序号不能为空",!1),!1)},n=Object(r["a"])(this.items);try{for(n.s();!(t=n.n()).done;){var o=t.value;if(!/^sec/.test(o.type)&&!i(o))return}}catch(h){n.e(h)}finally{n.f()}var s,a=Object(r["a"])(this.groups);try{for(a.s();!(s=a.n()).done;){var l,c=s.value,u=Object(r["a"])(c.member);try{for(u.s();!(l=u.n()).done;){var f=l.value;if(!i(f))return}}catch(h){u.e(h)}finally{u.f()}}}catch(h){a.e(h)}finally{a.f()}this.$emit("save-layout")},restoreLayout:function(){var t={width:this.compelPanelSize.width,height:this.compelPanelSize.height,scale:1,left:0,top:0};this.$store.commit("seatDesign/changePanelSize",t)},updateBG:function(){var t=this,e=Object(c["b"])("dsf-seat-bg-upload");$(e).on("change",(function(){if(!e.files||0===e.files.length)return!1;var i=new FormData;i.append("file",e.files[0]);var n=function(i){if($(e).val(""),$(e).remove(),e=null,"error"===i)return t.$emit("update:hasBg",!1),!1;m.call(t,i[0])};c["j"].call(t,i,n)})),$(e).click()}}};function m(t){var e=this,i=new Image;i.src=dsf.url.getWebPath(t.relativePath),i.onload=function(){e.$emit("update:hasBg",!0),e.$emit("update:backgroundImage",{width:i.naturalWidth,height:i.naturalHeight,relativePath:t.relativePath,absolutePath:t.absolutePath})},i.onerror=function(){dsf.layer.message("图片加载失败",!1),e.$emit("update:hasBg",!1)}}var g=p,v=i(0),b=Object(v["a"])(g,s,a,!1,null,null,null);b.options.__file="designer/seat/seatDesign/topTools.vue";var y=b.exports,S=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"designer-left"},[i("div",{staticClass:"designer-left-tools"},t._l(t.leftMenu.group,(function(e,n){return i("el-collapse",{key:n,model:{value:t.leftMenu.activeName,callback:function(e){t.$set(t.leftMenu,"activeName",e)},expression:"leftMenu.activeName"}},[i("el-collapse-item",{attrs:{title:e.title,name:e.title}},[i("div",{staticClass:"ds-tools-group-content",staticStyle:{padding:"10px"}},t._l(e.items,(function(e,n){return i("div",{key:n,staticClass:"ds-tool-item",attrs:{name:e.name,"data-type":e.type}},[t._v(" "+t._s(e.name)+" ")])})),0)])],1)})),1)])},w=[];S._withStripped=!0;var x={name:"LeftTools",data:function(){return{leftMenu:{activeName:["对象","辅助对象","自定义对象"],group:[{title:"对象",items:[{name:"座席",type:"seat"},{name:"床位",type:"bed"}]},{title:"辅助对象",items:[{name:"矩形",type:"sec_rect"}]},{title:"自定义对象",items:[{name:"床位"}]}]},originWidth:80,originHeight:80}},computed:Object(l["a"])({},Object(h["mapState"])("seatDesign",{panelSize:"panelSize",compelPanelSize:"compelPanelSize"})),mounted:function(){var t=this;$(".ds-tool-item").draggable({addClasses:!1,helper:function(){var t=$(this).text();return $('<div class="drag-item">'.concat(t,"</div>"))},cursor:"default",cursorAt:{top:-5,left:-5},stop:function(e,i){var n=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:e.pageX,y:e.pageY}),o=t.compelPanelSize.width||$(".seat-designer-page").width(),s=t.compelPanelSize.height||$(".seat-designer-page").height();if(n.x>=0&&n.x<=o&&n.y>=0&&n.y<=s){var a,r=$(e.target).data("type"),l=dsf.math.convertLocalCoordinate("#panel_outer",{x:e.pageX,y:e.pageY},t.panelSize.scale),c={id:dsf.uuid(),type:r,left:l.x,top:l.y,width:t.originWidth,height:t.originHeight,angle:0,isFrozenSty:!1,showText:1,seatTxt:"",seatNum:""};/^sec_/.test(r)?(a={bgImg:""},Object.assign(c,a)):(a={statusKv:"",stateList:[]},Object.assign(c,a)),t.$store.commit("seatDesign/addSeat2Panel",c)}}})}},k=x,C=Object(v["a"])(k,S,w,!1,null,null,null);C.options.__file="designer/seat/seatDesign/leftTools.vue";var L=C.exports,N=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.showTool?i("div",{staticClass:"right-tool-box"},[i("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(0)}}},[i("el-popover",{attrs:{value:t.groupVisible[0],placement:"left-start",width:"360",trigger:"manual","popper-class":"ds-seat-design-popover"}},[i("div",{staticClass:"header"},[t._v(" 度量 "),i("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(0)}}})]),i("div",{staticClass:"inner"},[i("div",{staticClass:"title"},[i("label",{staticClass:"label-box"},[t._v("当前对象：")]),i("span",{domProps:{textContent:t._s(t.getInfoTypeName())}})]),i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box"},[t._v("X")]),i("el-input-number",{attrs:{value:t.info.left,size:"mini",controls:!1},on:{change:function(e){return t.info.left=e}}}),i("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("Y")]),i("el-input-number",{attrs:{value:t.info.top,size:"mini",controls:!1},on:{change:function(e){return t.info.top=e}}})],1),i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box"},[t._v("宽")]),i("el-input-number",{attrs:{value:t.info.width,size:"mini",min:0,controls:!1},on:{change:function(e){return t.updateWidth(e)}}}),i("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("高")]),i("el-input-number",{attrs:{value:t.info.height,size:"mini",min:0,controls:!1},on:{change:function(e){return t.updateHeight(e)}}})],1),i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box"},[t._v("角度")]),i("el-input-number",{attrs:{value:t.info.angle,size:"mini",min:0,max:360,controls:!1},on:{change:function(e){return t.info.angle=e}}})],1),"group"===t.info.type?[i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box"},[t._v("成员宽")]),i("el-input-number",{attrs:{value:t.memberWidth,size:"mini",controls:!1},on:{change:function(e){return t.upGroupMemberPos("width",e)}}}),i("label",{staticClass:"label-box"},[t._v("成员高")]),i("el-input-number",{attrs:{value:t.memberHeight,size:"mini",controls:!1},on:{change:function(e){return t.upGroupMemberPos("height",e)}}})],1),i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box"},[t._v("行间距")]),i("el-input-number",{attrs:{value:t.memberSpaceTop,size:"mini",controls:!1},on:{change:function(e){return t.upGroupSize("row",e)}}}),i("label",{staticClass:"label-box"},[t._v("列间距")]),i("el-input-number",{attrs:{value:t.memberSpaceLeft,size:"mini",controls:!1},on:{change:function(e){return t.upGroupSize("col",e)}}})],1)]:t._e()],2),i("i",{staticClass:"iconfont icon-resize-",attrs:{slot:"reference"},slot:"reference"})])],1),i("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(1)}}},[i("el-popover",{attrs:{value:t.groupVisible[1],placement:"left",width:"360",trigger:"manual","popper-class":"ds-seat-design-popover"}},[i("div",{staticClass:"header"},[t._v(" 属性 "),i("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(1)}}})]),i("div",{staticClass:"inner"},[t.infoIsSec?[i("div",{staticClass:"inner-item"},[i("p",[t._v("文本")]),i("el-input",{model:{value:t.info.seatTxt,callback:function(e){t.$set(t.info,"seatTxt",e)},expression:"info.seatTxt"}})],1)]:["bed"===t.info.type||"bed"===t.info.memberType?i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box"},[t._v("宿舍")]),i("el-input",{attrs:{size:"mini"},model:{value:t.info.dormName,callback:function(e){t.$set(t.info,"dormName",e)},expression:"info.dormName"}}),i("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("楼层")]),i("el-input",{attrs:{size:"mini"},model:{value:t.info.floorName,callback:function(e){t.$set(t.info,"floorName",e)},expression:"info.floorName"}})],1):t._e(),"bed"===t.info.type||"bed"===t.info.memberType?i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box"},[t._v("类型")]),i("el-select",{attrs:{size:"mini"},model:{value:t.info.dormType,callback:function(e){t.$set(t.info,"dormType",e)},expression:"info.dormType"}},t._l(t.sexList,(function(t,e){return i("el-option",{key:e,attrs:{label:t.txt,value:t.val}})})),1),i("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("备注")]),i("el-input",{attrs:{size:"mini"},model:{value:t.info.remark,callback:function(e){t.$set(t.info,"remark",e)},expression:"info.remark"}})],1):t._e(),"seat"===t.info.type||"seat"===t.info.memberType?i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box"},[t._v("房间号")]),i("el-input",{attrs:{size:"mini"},model:{value:t.info.roomNum,callback:function(e){t.$set(t.info,"roomNum",e)},expression:"info.roomNum"}}),i("label",{staticClass:"label-box",staticStyle:{"margin-left":"5px"}},[t._v("备注")]),i("el-input",{attrs:{size:"mini"},model:{value:t.info.remark,callback:function(e){t.$set(t.info,"remark",e)},expression:"info.remark"}})],1):t._e(),i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box",staticStyle:{width:"80px","margin-right":"10px"}},[t._v("显示文本")]),i("el-radio-group",{model:{value:t.info.showText,callback:function(e){t.$set(t.info,"showText",e)},expression:"info.showText"}},[i("el-radio",{attrs:{label:1}},[t._v("是")]),i("el-radio",{attrs:{label:2}},[t._v("否")])],1)],1),t.info.member&&t.info.member.length>0?i("div",{staticClass:"inner-item",class:t.info.member.length>4?"scroll-container":""},t._l(t.info.member,(function(e,n){return i("div",{key:n},[i("div",{staticClass:"title"},[t._v(t._s(e.rowIndex+1)+"行"+t._s(e.colIndex+1)+"列:")]),i("label",{staticClass:"label-box"},[t._v("序号")]),i("input",{staticClass:"input-mini",attrs:{type:"text"},domProps:{value:e.seatNum},on:{change:function(i){return t.setNumber(i,e)}}}),i("label",{staticClass:"label-box"},[t._v("文本")]),i("input",{staticClass:"input-mini",attrs:{type:"text"},domProps:{value:e.seatTxt},on:{change:function(t){return e.seatTxt=t.target.value}}})])})),0):i("div",{staticClass:"inner-item"},[i("label",{staticClass:"label-box"},[t._v("序号")]),i("input",{staticClass:"input-mini",attrs:{type:"text"},domProps:{value:t.info.seatNum},on:{change:function(e){return t.setNumber(e,t.info)}}}),i("label",{staticClass:"label-box"},[t._v("文本")]),i("input",{staticClass:"input-mini",attrs:{type:"text"},domProps:{value:t.info.seatTxt},on:{change:function(e){return t.info.seatTxt=e.target.value}}})])]],2),i("i",{staticClass:"iconfont icon-xingzhuang-wenzi",attrs:{slot:"reference"},slot:"reference"})])],1),i("div",{staticClass:"box-item",on:{click:function(e){return t.showGroup(2)}}},[i("el-popover",{attrs:{value:t.groupVisible[2],placement:"left-start",width:"365",trigger:"manual","popper-class":"ds-seat-design-popover"}},[i("div",{staticClass:"header"},[t._v(" 上传 "),t.infoIsSec?t._e():i("i",{staticClass:"el-icon el-icon-s-tools",on:{click:function(e){t.dialogVisible=!0}}}),i("i",{staticClass:"el-icon-arrow-right",on:{click:function(e){return t.closeGroup(2)}}})]),t.infoIsSec?i("div",[i("div",{staticClass:"inner"},[i("div",{staticClass:"single-upload-box",on:{click:t.uploadSingle}},[t.info.bgImg?i("img",{attrs:{src:t.getImagePath(t.info.bgImg),alt:""}}):t._e()])])]):i("div",{staticClass:"inner inner-flex"},t._l(t.info.stateList,(function(e,n){return i("div",{key:e.statusValue,staticClass:"upload-box"},[i("div",{staticClass:"img-box",on:{click:function(i){return t.uploadMultiple(e)}}},[e.img?i("img",{attrs:{src:t.getImagePath(e.img)}}):t._e()]),i("p",[t._v(t._s(e.statusText))])])})),0),i("i",{staticClass:"iconfont icon-tupiantianjia",attrs:{slot:"reference"},slot:"reference"})])],1),i("el-dialog",{attrs:{title:"座位状态管理",visible:t.dialogVisible,modal:!1,width:"35%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("div",{staticClass:"dialog-box"},[i("p",{staticClass:"title"},[t._v("说明")]),i("p",[t._v("statusText - 座位状态")]),i("p",[t._v("statusValue - 座位状态对应的值")]),i("p",[t._v("couldSeat - 此状态下人员能否入座（1能、2否）")]),i("p",{staticClass:"title"},[t._v("默认状态")]),i("p",[i("span",[t._v("正常|1|1")]),i("span",[t._v("已排|2|1")])]),i("p",[i("span",[t._v("锁定|3|2")]),i("span",[t._v("禁用|4|2")])]),i("p",{staticClass:"title"},[t._v("自定义座位状态")]),i("el-input",{attrs:{type:"textarea",rows:5,placeholder:"statusText | statusValue | couldSeat 以|分隔，一行定义一种状态"},model:{value:t.info.statusKv,callback:function(e){t.$set(t.info,"statusKv",e)},expression:"info.statusKv"}})],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.saveStatus}},[t._v("确 定")])],1)])],1):t._e()},I=[];N._withStripped=!0;i(463),i(36),i(267),i(16),i(52),i(23),i(128),i(64);var O={name:"RightTools",props:{},data:function(){return{showTool:!1,sexList:[{val:null,txt:"请选择"},{val:1,txt:"男宿舍"},{val:2,txt:"女宿舍"}],defaultStateList:[{img:"",statusText:"正常",statusValue:1,couldSeat:1},{img:"",statusText:"已排",statusValue:2,couldSeat:1},{img:"",statusText:"锁定",statusValue:3,couldSeat:2},{img:"",statusText:"禁用",statusValue:4,couldSeat:2}],info:{stateList:[]},groupVisible:[!1,!1,!1],visiblePointer:null,oldVisibleStatus:!1,dialogVisible:!1}},computed:Object(l["a"])(Object(l["a"])({},Object(h["mapState"])("seatDesign",{activeId:"activeId"})),{},{memberWidth:function(){return _.isArray(this.info.member)?this.info.member[0].width:void 0},memberHeight:function(){return _.isArray(this.info.member)?this.info.member[0].height:void 0},memberSpaceTop:function(){return _.isArray(this.info.member)?Object(c["e"])(this.info):void 0},memberSpaceLeft:function(){return _.isArray(this.info.member)?Object(c["d"])(this.info):void 0},infoIsSec:function(){return/^sec_/.test(this.info.type)}}),watch:{activeId:function(t){var e=this;if(t)u["a"].emit(f["a"].GET_ACTIVE_SEAT,(function(t){_.isArray(t.stateList)&&0!==t.stateList.length||(t.stateList=_.cloneDeep(e.defaultStateList)),e.info=t})),this.showTool=!0,this.$nextTick((function(){e.$set(e.groupVisible,e.visiblePointer,e.oldVisibleStatus)}));else{this.showTool=!1;var i=new Array(3);this.groupVisible=_.fill(i,!1)}},info:{handler:function(t){this.$store.commit("seatDesign/changeSeatInfo",t)},deep:!1}},methods:{uploadSingle:function(){var t=this,e=Object(c["b"])();$(e).on("change",(function(){if(!e.files||0===e.files.length)return!1;var i=new FormData;i.append("file",e.files[0]);var n=function(i){if($(e).val(""),$(e).remove(),e=null,"error"===i)return!1;t.info.bgImg=i[0].relativePath};c["j"].call(t,i,n)})),$(e).click()},uploadMultiple:function(t){var e=this,i=Object(c["b"])();i.multiple=!0,$(i).on("change",(function(){if(!i.files||0===i.files.length)return!1;for(var n=new FormData,o=0;o<i.files.length;o++){var s=i.files[o];n.append("file_"+o,s)}c["j"].call(e,n,(function(n){if($(i).val(""),$(i).remove(),i=null,"error"===n)return!1;1===n.length?t.img=n[0].relativePath:e.info.stateList.forEach((function(t,e){n[e]&&(t.img=n[e].relativePath)})),"group"===e.info.type&&(e.info.isFrozenMemberSty=!1,e.info.member.forEach((function(t){t.stateList=e.info.stateList})))}))})),$(i).click()},closeGroup:function(t){this.visiblePointer=t,this.$set(this.groupVisible,t,!1),this.oldVisibleStatus=!1},showGroup:function(t){this.visiblePointer=t;var e=new Array(3);this.groupVisible=_.fill(e,!1),this.$set(this.groupVisible,t,!0),this.oldVisibleStatus=!0},saveStatus:function(){var t=this;if(this.info.statusKv){var e,i,n=this.info.statusKv.split("\n"),o=_.cloneDeep(this.defaultStateList),s=[],a=[],r=!0,l="";if(n.some((function(t){if(e=t.split("|").map((function(t){return t.replace(/(^\s*)|(\s*$)/g,"")})),1!==+e[2]&&2!==+e[2])return r=!1,l="statusText|statusValue|couldSeat  当中的couldSeat只能为1或2",!0;var n=o.findIndex((function(t){return t.statusValue===+e[1]}));if(-1!==n)return r=!1,l="你的 statusValue 与系统默认的冲突了",!0;var c=a.indexOf(e[1]);if(-1!==c)return r=!1,l="你设置了重复的 statusValue",!0;a.push(e[1]),i={img:"",statusText:e[0],statusValue:+e[1],couldSeat:+e[2]},s.push(i)})),r){var c=_.differenceBy(s,o,"statusValue");this.info.stateList=_.concat(o,c).sort((function(t,e){return t.statusValue-e.statusValue})),"group"===this.info.type&&(this.info.isFrozenMemberSty=!1,this.info.member.forEach((function(e){e.stateList=t.info.stateList}))),this.dialogVisible=!1}else this.saveStatusError(l)}else this.dialogVisible=!1},saveStatusError:function(t){this.info.statusKv="",dsf.layer.alert(t)},getImagePath:function(t){return t?dsf.url.getWebPath(t):null},getInfoTypeName:function(){switch(this.info.type){case"seat":return"座位";case"bed":return"床位";case"group":if("seat"===this.info.memberType)return"座位组";if("bed"===this.info.memberType)return"床位组";break;case"sec_rect":return"矩形"}},updateWidth:function(t){this.info.width=t,this.info.isFrozenSty=!1,"group"===this.info.type&&(this.info.isFrozenMemberSty=!1,Object(c["i"])(this.info))},updateHeight:function(t){this.info.height=t,this.info.isFrozenSty=!1,"group"===this.info.type&&(this.info.isFrozenMemberSty=!1,Object(c["i"])(this.info))},upGroupMemberPos:function(t,e){var i=_.cloneDeep(this.info);i.member.forEach((function(i){"width"===t?i.width=e:i.height=e})),Object(c["i"])(i),this.info=i,this.info.isFrozenMemberSty=!1},upGroupSize:function(t,e){var i=_.cloneDeep(this.info),n=i.member[0];"row"===t?(i.height=(i.rows-1)*e+i.rows*n.height,Object(c["i"])(i)):"col"===t&&(i.width=(i.cols-1)*e+i.cols*n.width,Object(c["i"])(i)),this.info=i,this.info.isFrozenMemberSty=!1},setNumber:function(t,e){var i=t.target.value,n=i.replace(/[^0-9]/gi,"");n&&n.length>0?(t.target.value=parseInt(n),e.seatNum=parseInt(n)):(t.target.value="",e.seatNum="")}}},P=O,E=Object(v["a"])(P,N,I,!1,null,null,null);E.options.__file="designer/seat/seatDesign/rightTools.vue";var z=E.exports,T=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"seat-designer-page",style:t.canvasCss,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.preRegion.apply(null,arguments)}}},[i("region",{attrs:{visible:t.regionVisible,region:t.regionRect}}),i("div",{style:t.panelSty,attrs:{id:"panel_outer"}},[t._t("seat"),i("div",{staticClass:"ds_seat_panel_bg",attrs:{id:"panel_bg"}})],2),t._t("seatPop")],2)},D=[];T._withStripped=!0;var A=function(){var t=this,e=t.$createElement,i=t._self._c||e;return t.visible?i("div",{staticClass:"region",style:t.regionSty}):t._e()},j=[];A._withStripped=!0;var M={name:"Region",props:{visible:{type:Boolean,default:!1},region:{type:Object,default:function(){return{}}}},data:function(){return{test:!1}},computed:{regionSty:function(){return{left:this.region.left+"px",top:this.region.top+"px",width:this.region.width+"px",height:this.region.height+"px"}}},methods:{}},V=M,R=Object(v["a"])(V,A,j,!1,null,null,null);R.options.__file="designer/seat/seatDesign/region.vue";var F=R.exports,B={name:"Canvas",components:{region:F},data:function(){return{regionVisible:!1,regionRect:{}}},computed:Object(l["a"])(Object(l["a"])({},Object(h["mapState"])("seatDesign",{compelPanelSize:"compelPanelSize",panelSize:"panelSize",canvasCss:function(t){var e=t.compelPanelSize,i=e.width,n=e.height,o=i?"".concat(i,"px"):"100%",s=n?"".concat(n,"px"):"100%";return{width:o,height:s}},panelParentSize:function(t){var e=t.compelPanelSize,i=e.width,n=e.height;return i=i||$(".seat-designer-page").width(),n=n||$(".seat-designer-page").height(),{width:i,height:n}}})),{},{panelSty:function(){return{width:this.panelSize.width?this.panelSize.width+"px":"100%",height:this.panelSize.height?this.panelSize.height+"px":"100%",left:this.panelSize.left+"px",top:this.panelSize.top+"px"}}}),watch:{compelPanelSize:{handler:function(t){var e=t.width,i=t.height,n={width:e,height:i,scale:1,left:0,top:0};this.$store.commit("seatDesign/changePanelSize",n)},deep:!0}},mounted:function(){var t=this;$(".seat-designer-page")[0].addEventListener("mousewheel",t.handleScroll)},methods:{handleScroll:function(t){if(t.ctrlKey){var e=this,i=t.wheelDelta<0?"down":"up",n=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY}),o=e.panelParentSize,s=o.width,a=o.height,r=s*e.panelSize.scale,l=a*e.panelSize.scale,c=n.x/r,u=n.y/l,f=e.panelSize.scale;if("up"===i?f+=.1:"down"===i&&(f-=.1),f>=.1){var h=$("#panel_outer"),d=s*f,p=a*f,m=h.position().left+n.x-d*c,g=h.position().top+n.y-p*u,v={scale:Math.round(10*f)/10,width:Math.floor(d),height:Math.floor(p),left:Math.floor(m),top:Math.floor(g)};e.$store.commit("seatDesign/changePanelSize",v)}t.preventDefault(),t.stopPropagation()}},preRegion:function(t){var e=this;e.$store.commit("seatDesign/changeActiveId","");var i=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});function n(t){e.regionVisible=!0;var n=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});e.$set(e.regionRect,"left",i.x>n.x?n.x:i.x),e.$set(e.regionRect,"top",i.y>n.y?n.y:i.y),e.$set(e.regionRect,"width",Math.abs(n.x-i.x)),e.$set(e.regionRect,"height",Math.abs(n.y-i.y))}function o(){$(document).off("mousemove.region"),e.$store.commit("seatDesign/changeRegionPosition",e.regionRect),e.regionVisible=!1,e.regionRect={}}$(document).off("mousemove.region"),$(document).on("mousemove.region",(function(t){n(t)})),$(document).one("mouseup.region",(function(){o()}))}}},G=B,Y=Object(v["a"])(G,T,D,!1,null,null,null);Y.options.__file="designer/seat/seatDesign/canvas.vue";var K=Y.exports,W=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"seat-item-container",class:t.switchNumSet?"set-num":"normal"},[t.verLine.visible?i("div",{staticClass:"vertical-line",style:t.verLineSty}):t._e(),t.horLine.visible?i("div",{staticClass:"horizontal-line",style:t.horLineSty}):t._e(),t.selectPosition.visible?i("div",{staticClass:"selected-box",style:t.selectSty,on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectMove.apply(null,arguments)}}},[i("div",{staticClass:"select"},[t.switchNumSet?t._e():i("div",{staticClass:"anchor circle",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectRotate.apply(null,arguments)}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor line"}),t.switchNumSet?t._e():i("div",{staticClass:"anchor lt",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"lt")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor t",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"t")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor rt",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"rt")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor l",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"l")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor r",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"r")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor lb",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"lb")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor b",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"b")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor rb",on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.selectScale(e,"rb")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor info"},[t._v(" 宽:"+t._s(t.selectPosition.width)+";高:"+t._s(t.selectPosition.height)+";角度:"+t._s(t.selectPosition.angle)+" ")])])]):t._e(),t._l(t.mitems,(function(e,n){return i("div",{key:e.id,staticClass:"seat-box",class:{active:t.activeId===e.id,hideText:2===e.showText},style:t.getItemSty(e),on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preMove(i,e)},contextmenu:function(i){return t.popMenu(i,e)}}},[i("div",{staticClass:"seat",on:{dblclick:function(i){return i.stopPropagation(),t.openEdit(i,e)}}},[t.switchNumSet?t._e():i("div",{staticClass:"anchor circle",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preRotate(i,e)}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor line"}),t.switchNumSet?t._e():i("div",{staticClass:"anchor lt",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"lt")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor t",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"t")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor rt",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"rt")}}}),t.switchNumSet?i("p",{staticClass:"num",on:{dblclick:function(i){return i.stopPropagation(),t.openSetNum(i,e)}}},[t._v(t._s(e.seatNum))]):i("p",[t._v(t._s(e.seatTxt))]),t.switchNumSet?t._e():i("div",{staticClass:"anchor l",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"l")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor r",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"r")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor lb",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"lb")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor b",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"b")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor rb",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"rb")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor info"},[t._v("宽:"+t._s(e.width)+";高:"+t._s(e.height)+";角度:"+t._s(e.angle))])])])})),t._l(t.groups,(function(e,n){return i("div",{key:e.id,staticClass:"group-box",class:{active:t.activeId===e.id,hideText:2===e.showText},style:t.getItemSty(e),on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preMove(i,e)},contextmenu:function(i){return t.popMenu(i,e)}}},[i("div",{staticClass:"group"},[t.switchNumSet?t._e():i("div",{staticClass:"anchor circle",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preRotate(i,e)}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor line"}),t.switchNumSet?t._e():i("div",{staticClass:"anchor lt",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"lt")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor t",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"t")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor rt",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"rt")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor l",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"l")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor r",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"r")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor lb",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"lb")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor b",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"b")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor rb",on:{mousedown:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"left",37,i.key,["Left","ArrowLeft"])||"button"in i&&0!==i.button?null:t.preScale(i,e,"rb")}}}),t.switchNumSet?t._e():i("div",{staticClass:"anchor info"},[t._v("宽:"+t._s(e.width)+";高:"+t._s(e.height)+";角度:"+t._s(e.angle)+" ")]),t._l(e.member,(function(n,o){return i("div",{key:n.id,staticClass:"member",style:t.getMemberSty(n,e),on:{click:function(e){return e.stopPropagation(),t.setOrderNum(n)},dblclick:function(e){return e.stopPropagation(),t.openEdit(e,n)}}},[t.switchNumSet?i("p",{staticClass:"num",on:{dblclick:function(e){return e.stopPropagation(),t.openSetNum(e,n)}}},[t._v(t._s(n.seatNum))]):i("p",[t._v(t._s(n.seatTxt))])])}))],2)])}))],2)},X=[];W._withStripped=!0;i(28),i(48),i(185),i(196);var q={name:"SeatItem",props:{items:{type:Array,default:function(){return[]}},groups:{type:Array,default:function(){return[]}}},data:function(){return{selectedItems:[],rectMinSize:[40,40],selectPosition:{top:0,left:0,width:0,height:0,visible:!1},verLine:{left:0,visible:!1},horLine:{top:0,visible:!1},maxOrderNum:null}},computed:Object(l["a"])(Object(l["a"])({},Object(h["mapState"])("seatDesign",{panelSize:"panelSize",newSeatItem:"newSeatItem",newGroupItem:"newGroupItem",activeId:"activeId",regionPosition:"regionPosition",seatInfo:"seatInfo",switchNumSet:"switchNumSet"})),{},{mitems:function(){var t=this;return this.items.filter((function(e){return!(t.switchNumSet&&/^sec_/.test(e.type))}))},selectSty:function(){var t=this.panelSize.scale;return{width:this.selectPosition.width*t+"px",height:this.selectPosition.height*t+"px",left:this.selectPosition.left*t+"px",top:this.selectPosition.top*t+"px",transform:"rotate(".concat(this.selectPosition.angle,"deg)")}},verLineSty:function(){return{left:"".concat(this.verLine.left*this.panelSize.scale)+"px"}},horLineSty:function(){return{top:"".concat(this.horLine.top*this.panelSize.scale)+"px"}}}),watch:{newSeatItem:function(t){c["c"].call(this);var e=_.assign({},t);this.items.push(e)},newGroupItem:function(t){c["c"].call(this);var e=_.assign({},t);this.groups.push(e)},regionPosition:function(t){var e=this;if(_.isEmpty(t)||0===t.width||0===t.height)return c["c"].call(e),e.selectedItems=[],void ut.call(e);var i=_.concat(e.items,e.groups);e.selectedItems=_.filter(i,(function(t){return J.call(e,t)})),c["c"].call(e),0!==e.selectedItems.length&&(1===e.selectedItems.length?e.$store.commit("seatDesign/changeActiveId",e.selectedItems[0].id):e.selectedItems.length>1&&(e.selectPosition=lt(e.selectedItems)))},seatInfo:{handler:function(t,e){if(c["c"].call(this),"group"===t.type){var i=_.findIndex(this.groups,(function(e){return e.id===t.id}));this.$set(this.groups,i,t)}else{var n=_.findIndex(this.items,(function(e){return e.id===t.id}));this.$set(this.items,n,t)}},deep:!1},"panelSize.scale":function(){this.items.forEach((function(t){t.isFrozenSty=!1})),this.groups.forEach((function(t){t.isFrozenSty=!1,t.isFrozenMemberSty=!1}))},selectedItems:function(t){t&&t.length>0?this.$store.commit("seatDesign/changeHaveSelectedItems",!0):this.$store.commit("seatDesign/changeHaveSelectedItems",!1)},switchNumSet:function(t){c["h"].call(this),t&&U.call(this)}},beforeDestroy:function(){$(document).off("mouseup.scaleSeatItem"),$(document).off("mousemove.scaleSeatItem")},mounted:function(){var t=this;u["a"].on(f["a"].KEY_CTRL_D,(function(){ut.call(t),t.selectedItems=[],t.$store.commit("seatDesign/changeActiveId","")})),u["a"].on(f["a"].KEY_DELETE,(function(){t.deleteActiveSeatItem()})),u["a"].on(f["a"].GET_ACTIVE_SEAT,(function(e){var i=_.concat(t.items,t.groups),n=i.find((function(e){return e.id===t.activeId}));e&&e(n)})),u["a"].on(f["a"].CLEAN_ALL_SEAT_NUM,(function(){t.items.forEach((function(t){t.seatNum==t.seatTxt&&(t.seatTxt=null),t.seatNum=null})),t.groups.forEach((function(t){t.member.forEach((function(t){t.seatNum==t.seatTxt&&(t.seatTxt=null),t.seatNum=null}))})),t.maxOrderNum=null})),u["a"].on(f["a"].CLEAN_SELECT_SEAT_NUM,(function(){t.selectedItems.forEach((function(t){"group"!==t.type?(t.seatNum==t.seatTxt&&(t.seatTxt=null),t.seatNum=null):t.member.forEach((function(t){t.seatNum==t.seatTxt&&(t.seatTxt=null),t.seatNum=null}))})),U.call(t),t.clearSelectedItems()})),u["a"].on(f["a"].AFTER_QUICK_ORDER,(function(){U.call(t),t.clearSelectedItems()}))},methods:{getItemSty:function(t){if(t.isFrozenSty)return t.style;var e={width:t.width*this.panelSize.scale+"px",height:t.height*this.panelSize.scale+"px",left:t.left*this.panelSize.scale+"px",top:t.top*this.panelSize.scale+"px",transform:"rotate(".concat(t.angle,"deg)")};return this.switchNumSet||"group"===t.type||(e.background=mt(t)),t.style=e,e},getMemberSty:function(t,e){if(e.isFrozenMemberSty)return t.style;var i={width:t.width*this.panelSize.scale+"px",height:t.height*this.panelSize.scale+"px",left:t.left*this.panelSize.scale+"px",top:t.top*this.panelSize.scale+"px"};return this.switchNumSet||(i.background=mt(e)),t.style=i,i},clearSelectedItems:function(){this.selectedItems=[],ut.call(this),this.$store.commit("seatDesign/changeActiveId","")},preScale:function(t,e,i){t.stopPropagation(),t.preventDefault();var n=this;c["c"].call(n,!1),"group"===e.type&&(e.isFrozenMemberSty=!1);var o=_.assign({},e),s=_.assign({},e),a=Z(o,i);function r(t){if(i&&a){var r=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},n.panelSize.scale),l=tt(a,o,s,r,i,"group"!==e.type?n.rectMinSize:pt(o));_.assign(e,l),"group"===e.type&&Object(c["i"])(l)}}function l(){if($(document).off("mousemove.scaleSeatItem"),c["c"].call(n),"group"===e.type){var t=e.member[0];1===e.rows&&(e.height=t.height),1===e.cols&&(e.width=t.width)}}$(document).off("mousemove.scaleSeatItem"),$(document).on("mousemove.scaleSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),r(t)}),5)),$(document).one("mouseup.scaleSeatItem",(function(){l()}))},preMove:function(t,e){t.preventDefault(),t.stopPropagation();var i=this;if(this.switchNumSet)return c["c"].call(i),H.call(i,e),void this.setOrderNum(e);H.call(i,e),c["c"].call(i),i.verLine.visible=!1,i.horLine.visible=!1;var n=ft.call(i),o=dt(n),s=e.left,a=e.top,r=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},i.panelSize.scale);function l(t){var n=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},i.panelSize.scale),l={x:n.x-r.x,y:n.y-r.y};e.left=parseInt(s+l.x),e.top=parseInt(a+l.y),i.verLine.visible=!1,i.horLine.visible=!1;var c=Q(e,["lt"]),u=dt(c),f=ht(u,o,e);f&&(i.horLine.top=f.top,i.horLine.visible=_.isNumber(f.top),i.verLine.left=f.left,i.verLine.visible=_.isNumber(f.left))}function u(){$(document).off("mousemove.moveSeatItem"),c["c"].call(i),i.verLine.visible=!1,i.horLine.visible=!1}$(document).off("mousemove.moveSeatItem"),$(document).on("mousemove.moveSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),l(t)}),5)),$(document).one("mouseup.moveSeatItem",(function(){u()}))},preRotate:function(t,e){t.stopPropagation(),t.preventDefault(),$(".ds-seat-design").addClass("is-rotating");var i=this;c["c"].call(i);var n=ot(e);function o(t){var o=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},i.panelSize.scale);e.angle=et(n,o)}function s(){$(document).off("mousemove.rotateSeatItem"),c["c"].call(i),$(".ds-seat-design").removeClass("is-rotating")}$(document).off("mousemove.rotateSeatItem"),$(document).on("mousemove.rotateSeatItem",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),o(t)}),5)),$(document).one("mouseup.rotateSeatItem",(function(){s()}))},selectRotate:function(t){t.stopPropagation(),t.preventDefault(),$(".ds-seat-design").addClass("is-rotating");var e=this;c["c"].call(e);var i=_.assign({},e.selectPosition),n=ot(i),o={},s=_.concat(e.items,e.groups);function a(t){var s=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale),a=et(n,s),r=a-i.angle;e.selectPosition.angle=a,e.selectedItems.forEach((function(t){var e=o[t.id],i=dsf.math.getRotatedPiont(e.left,e.top,n.x,n.y,a),s=i.x+e.width/2,l=i.y+e.height/2,c=dsf.math.getRotatedPiont(s,l,i.x,i.y,a);i=dsf.math.getRotatedPiont(i.x,i.y,c.x,c.y,-a),t.top=parseInt(i.y),t.left=parseInt(i.x),t.angle=(e.angle+r)%360,e.angle<0&&(t.angle=360+e.angle)}))}function r(){$(".ds-seat-design").removeClass("is-rotating"),e.selectPosition=lt(e.selectedItems),$(document).off("mousemove.rotateSelect"),c["c"].call(e)}s.forEach((function(t){o[t.id]=_.assign({},t)})),$(document).off("mousemove.rotateSelect"),$(document).on("mousemove.rotateSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),a(t)}),5)),$(document).one("mouseup.rotateSelect",(function(){r()}))},selectScale:function(t,e){t.stopPropagation(),t.preventDefault();var i=this;c["c"].call(i,!1);var n=_.assign({},i.selectPosition),o=_.assign({},i.selectPosition),s={},a=_.concat(i.items,i.groups);a.forEach((function(t){s[t.id]=_.assign({},t)}));var r=Z(n,e),l=it(i.selectedItems,i.selectPosition);function u(t){if(e&&r){var a=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},i.panelSize.scale);i.selectPosition=tt(r,n,o,a,e,i.rectMinSize),i.selectedItems.forEach((function(t){var o=nt(s[t.id],n,i.selectPosition,e,l);"group"===o.type&&Object(c["i"])(o),_.assign(t,o)}))}}function f(){$(document).off("mousemove.scaleSelect"),c["c"].call(i),i.selectedItems.forEach((function(t){"group"===t.type&&(1===t.rows&&(t.height=s[t.id].height),1===t.cols&&(t.width=s[t.id].width))})),i.selectPosition=lt(i.selectedItems)}$(document).off("mousemove.scaleSelect"),$(document).on("mousemove.scaleSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),u(t)}),5)),$(document).one("mouseup.scaleSelect",(function(){f()}))},selectMove:function(t){if(t.preventDefault(),t.stopPropagation(),!this.switchNumSet){var e=this;c["c"].call(e);var i=e.selectPosition.left,n=e.selectPosition.top,o={},s=_.concat(e.items,e.groups);s.forEach((function(t){o[t.id]=_.assign({},t)}));var a=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale);$(document).off("mousemove.moveSelect"),$(document).on("mousemove.moveSelect",_.debounce((function(t){t.preventDefault(),t.stopPropagation(),r(t)}),5)),$(document).one("mouseup.moveSelect",(function(){l()}))}function r(t){var s=dsf.math.convertLocalCoordinate("#panel_outer",{x:t.pageX,y:t.pageY},e.panelSize.scale),r={x:s.x-a.x,y:s.y-a.y},l=i+r.x,c=n+r.y;e.selectPosition.left=parseInt(l),e.selectPosition.top=parseInt(c),e.selectedItems.forEach((function(t){t.left=parseInt(o[t.id].left+r.x),t.top=parseInt(o[t.id].top+r.y)}))}function l(){$(document).off("mousemove.moveSelect"),c["c"].call(e)}},popMenu:function(t,e){if(!/^sec_/.test(e.type)&&3===t.which){t.preventDefault(),t.stopPropagation();var i=dsf.math.convertLocalCoordinate(".seat-designer-page",{x:t.pageX,y:t.pageY});c["c"].call(this),H.call(this,e),u["a"].emit(f["a"].SEAT_POP,{position:Object(l["a"])({},i),seat:e,maxOrderNum:this.maxOrderNum})}},deleteActiveSeatItem:function(){if(0!==this.selectedItems.length){var t=_.differenceWith(this.items,this.selectedItems,(function(t,e){return t.id===e.id&&"group"!==e.type})),e=_.differenceWith(this.groups,this.selectedItems,(function(t,e){return t.id===e.id&&"group"===e.type}));this.$emit("update:items",t),this.$emit("update:groups",e),this.clearSelectedItems()}},setOrderNum:function(t,e){this.switchNumSet&&"group"!==t.type&&!t.seatNum&&(this.maxOrderNum?this.maxOrderNum+=1:this.maxOrderNum=1,t.seatNum=this.maxOrderNum,t.seatTxt=t.seatTxt||t.seatNum)},openEdit:function(t,e){if(!this.switchNumSet&&!$(t.target).hasClass("anchor")){var i=document.createElement("textarea"),n=function(t){e.seatTxt=t,$(i).remove(),i=null};$(t.target).append(i),$(i).val(e.seatTxt),$(i).on("blur",(function(){n($(this).val())})),$(i).bind("keypress",(function(t){13===t.keyCode&&n($(this).val())})),$(i).focus()}},openSetNum:function(t,e){var i=this,n=document.createElement("input"),o=function(t){t?(t=parseInt(t.replace(/[^0-9]/gi,"")),e.seatTxt==e.seatNum&&(e.seatTxt=t),e.seatNum=t,t>i.maxOrderNum?i.maxOrderNum=t:U.call(i)):(e.seatTxt==e.seatNum&&(e.seatTxt=null),e.seatNum=null,U.call(i)),$(n).remove(),n=null};$(t.target).append(n),$(n).val(e.seatNum),$(n).on("blur",(function(){o($(this).val())})),$(n).bind("keypress",(function(t){13===t.keyCode&&o($(this).val())})),$(n).focus()}}};function U(){var t=[];_.concat(this.items,this.groups).forEach((function(e){"group"!==e.type?e.seatNum&&t.push(e.seatNum):e.member.forEach((function(e){e.seatNum&&t.push(e.seatNum)}))}));var e=t.sort((function(t,e){return t-e}));this.maxOrderNum=_.last(e)||null}function H(t){this.activeId!==t.id&&(ut.call(this),this.selectedItems=[t],this.$store.commit("seatDesign/changeActiveId",t.id))}function J(t){var e=Q(t),i=st(e),n=this.panelSize,o=(n.left,n.top,n.scale),s=this.regionPosition,a=s.left,r=s.top,l=s.width,c=s.height,u=$(".seat-designer-page").offset(),f={x:a+u.left,y:r+u.top},h={x:a+u.left+l,y:r+u.top+c};f=dsf.math.convertLocalCoordinate("#panel_outer",f,o),h=dsf.math.convertLocalCoordinate("#panel_outer",h,o);var d=i.min_x>=f.x,p=i.max_x<=h.x,m=i.min_y>=f.y,g=i.max_y<=h.y;return d&&p&&m&&g}function Q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["lt","rt","rb","lb"],i=t.angle,n=t.left,o=t.top,s=t.left+t.width,a=t.top+t.height,r={lt:0,lb:0,rt:0,rb:0},l=.5*(s-n)+n,c=.5*(a-o)+o;return e.includes("lt")&&(r.lt=dsf.math.getRotatedPiont(n,o,l,c,i)),e.includes("rt")&&(r.rt=dsf.math.getRotatedPiont(s,o,l,c,i)),e.includes("rb")&&(r.rb=dsf.math.getRotatedPiont(s,a,l,c,i)),e.includes("lb")&&(r.lb=dsf.math.getRotatedPiont(n,a,l,c,i)),r}function Z(t,e){var i={};e.length>1?(e.indexOf("l")>=0?i.x=t.left+t.width:i.x=t.left,e.indexOf("t")>=0?i.y=t.top+t.height:i.y=t.top):"r"===e||"b"===e?(i.x=t.left,i.y=t.top):"l"!==e&&"t"!==e||(i.x=t.left+t.width,i.y=t.top+t.height);var n={x:t.left+t.width/2,y:t.top+t.height/2};return i=dsf.math.getRotatedPiont(i.x,i.y,n.x,n.y,t.angle),i}function tt(t,e,i,n,o,s){var a,r,l=dsf.math.getDistance(t,n),c=dsf.math.getRadina(t,n,-dsf.math.a2r(e.angle)),u={x:Math.cos(c)*l+e.left,y:Math.sin(c)*l+e.top};if(o.indexOf("r")>=0?a=u.x-e.left:o.indexOf("l")>=0&&(a=e.left-u.x),o.indexOf("b")>=0?r=u.y-e.top:o.indexOf("t")>=0&&(r=e.top-u.y),o.length>1){var f=a/e.width;i.width=e.width*f,i.height=e.height*f}else dsf.isDef(a)?i.width=a:i.width=e.width,dsf.isDef(r)?i.height=r:i.height=e.height;i.width<s[0]&&(i.width=s[0]),i.height<s[1]&&(i.height=s[1]);var h={};o.length>1?(o.indexOf("r")>=0?h.x=t.x+i.width:o.indexOf("l")>=0?h.x=t.x-i.width:h.x=t.x,o.indexOf("b")>=0?h.y=t.y+i.height:o.indexOf("t")>=0?h.y=t.y-i.height:h.y=t.y):"r"===o||"b"===o?(h.x=t.x+i.width,h.y=t.y+i.height):"l"!==o&&"t"!==o||(h.x=t.x-i.width,h.y=t.y-i.height);var d=dsf.math.getRotatedPiont(h.x,h.y,t.x,t.y,e.angle),p={x:.5*(t.x+d.x),y:.5*(t.y+d.y)},m=dsf.math.getRotatedPiont(t.x,t.y,p.x,p.y,-e.angle);return o.length>1?(o.indexOf("r")>=0?i.left=m.x:o.indexOf("l")>=0?i.left=m.x-i.width:i.left=m.x-i.width/2,o.indexOf("b")>=0?i.top=m.y:o.indexOf("t")>=0?i.top=m.y-i.height:i.top=m.y-i.height/2):"r"===o||"b"===o?(i.left=m.x,i.top=m.y):"l"!==o&&"t"!==o||(i.left=m.x-i.width,i.top=m.y-i.height),at(i),i}function et(t,e){var i=dsf.math.getRadina(t,e),n=90+dsf.math.r2a(i);return n=Math.ceil(n)%360,n}function it(t,e){var i={};return _.forEach(t,(function(t){var n=_.assign({},t);i[t.id]={left:(n.left-e.left)/e.width,top:(n.top-e.top)/e.height,width:n.width/e.width,height:n.height/e.height}})),i}function nt(t,e,i,n,o){var s=_.assign({},t),a=o[s.id];if(s.left=i.left+i.width*a.left,s.top=i.top+i.height*a.top,2===n.length){var r=i.width/e.width,l=i.height/e.height;r=.5*(r+l),s.width=r*t.width,s.height=r*t.height}else 1===n.length&&(s.width=i.width*a.width,s.height=i.height*a.height);return rt(s),s}function ot(t){return{x:t.left+t.width/2,y:t.top+t.height/2}}function st(t){var e,i,n,o;return _.forIn(t,(function(t){e=e||t.x,i=i||t.x,n=n||t.y,o=o||t.y,e=e<=t.x?e:t.x,i=i>=t.x?i:t.x,n=n<=t.y?n:t.y,o=o>=t.y?o:t.y})),{min_x:e,min_y:n,max_x:i,max_y:o}}function at(t){t.top=parseInt(t.top),t.left=parseInt(t.left),t.width=parseInt(t.width),t.height=parseInt(t.height)}function rt(t){t.top=Math.round(t.top),t.left=Math.round(t.left),t.width=Math.round(t.width),t.height=Math.round(t.height)}function lt(t){var e,i,n,o,s;return _.forEach(t,(function(t){s=Q(t),_.forIn(s,(function(t){e=e||t.x,i=i||t.x,n=n||t.y,o=o||t.y,e=e<=t.x?e:t.x,i=i>=t.x?i:t.x,n=n<=t.y?n:t.y,o=o>=t.y?o:t.y}))})),{left:ct(e),top:ct(n),width:ct(i-e),height:ct(o-n),angle:0,visible:!0}}function ct(t){return t<0?Math.floor(t):Math.ceil(t)}function ut(){this.selectPosition={top:0,left:0,width:0,height:0,angle:0,visible:!1}}function ft(){var t=this,e=_.filter(_.concat(this.items,this.groups),(function(e){return e.id!==t.activeId}));return e.map((function(t){return Q(t,["lt"])}))}function ht(t,e,i){for(var n={},o=0,s=0;s<e.length;s++)if(t.left>=e[s].left-3&&t.left<=e[s].left+3&&(n.left=e[s].left,o+=1,0===i.angle&&(i.left=n.left)),t.top>=e[s].top-3&&t.top<=e[s].top+3&&(n.top=e[s].top,o+=1,0===i.angle&&(i.top=n.top)),2===o)break;return n.left||n.top?n:null}function dt(t){var e=[],i={};return _.isArray(t)?(_.forEach(t,(function(t){i={left:Math.round(t.lt.x),top:Math.round(t.lt.y)},e.push(i)})),_.uniqWith(e,_.isEqual)):_.isObject(t)?{left:Math.round(t.lt.x),top:Math.round(t.lt.y)}:void 0}function pt(t){var e=t.member[0];return[t.cols*e.width,t.rows*e.height]}function mt(t){var e;if(/^sec_/.test(t.type))e=dsf.url.getAbsolutePath(t.bgImg);else{var i=_.isArray(t.stateList)&&t.stateList[0]&&t.stateList[0].img;if(!i)return"none";e=dsf.url.getAbsolutePath(t.stateList[0].img)}return"center / contain no-repeat url(".concat(e,")")}var gt=q,vt=Object(v["a"])(gt,W,X,!1,null,null,null);vt.options.__file="designer/seat/seatDesign/seatItem.vue";var bt=vt.exports,yt=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.popShow,expression:"popShow"}],staticClass:"seat-pop-box",style:t.sty},[i("ul",[t.switchNumSet?i("li",{on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.popDialog.apply(null,arguments)}}},[t._v("快速填充序号")]):i("li",{on:{mousedown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"left",37,e.key,["Left","ArrowLeft"])||"button"in e&&0!==e.button?null:t.popDialog.apply(null,arguments)}}},[t._v("方阵组")])]),i("el-dialog",{attrs:{visible:t.dialogVisible,title:"信息",width:"300px",modal:!1,"append-to-body":!0},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{attrs:{model:t.form,size:"small"}},[t.switchNumSet?[i("el-form-item",{attrs:{label:"排序开始位置"}},[i("el-radio-group",{model:{value:t.form.orderPosition,callback:function(e){t.$set(t.form,"orderPosition",e)},expression:"form.orderPosition"}},[i("el-radio",{attrs:{label:"lt"}},[t._v("左上角")]),i("el-radio",{attrs:{label:"rt"}},[t._v("右上角")]),i("el-radio",{attrs:{label:"rb"}},[t._v("右下角")]),i("el-radio",{attrs:{label:"lb"}},[t._v("左下角")])],1)],1),i("el-form-item",{attrs:{label:"开始序号"}},[i("el-input-number",{attrs:{precision:0,controls:!1,min:1},model:{value:t.form.orderBegin,callback:function(e){t.$set(t.form,"orderBegin",e)},expression:"form.orderBegin"}})],1)]:[i("el-form-item",{attrs:{label:"列数"}},[i("el-input-number",{attrs:{precision:0,controls:!1,min:1},model:{value:t.form.colNum,callback:function(e){t.$set(t.form,"colNum",e)},expression:"form.colNum"}})],1),i("el-form-item",{attrs:{label:"个数"}},[i("el-input-number",{attrs:{precision:0,controls:!1,min:1},model:{value:t.form.total,callback:function(e){t.$set(t.form,"total",e)},expression:"form.total"}})],1)],i("el-form-item",{staticStyle:{"text-align":"right"}},[t.switchNumSet?i("el-button",{on:{click:t.quickOrder}},[t._v("确定")]):i("el-button",{on:{click:t.setGroup}},[t._v("创建")])],1)],2)],1)],1)},_t=[];yt._withStripped=!0;var St={name:"SeatPop",data:function(){return{dialogVisible:!1,form:{colNum:void 0,total:void 0,orderPosition:"lt",orderBegin:1},seat:{},position:{},popShow:!1}},computed:Object(l["a"])(Object(l["a"])({},Object(h["mapState"])("seatDesign",["switchNumSet"])),{},{sty:function(){return{left:this.position.x+"px",top:this.position.y+"px"}}}),mounted:function(){var t=this;u["a"].on(f["a"].SEAT_POP,(function(e){"group"!==e.seat.type&&t.switchNumSet?t.popShow=!1:(Object.assign(t,e),t.form.orderBegin=e.maxOrderNum+1,t.popShow=!0,"group"===e.seat.type?(t.form.colNum=e.seat.cols,t.form.total=e.seat.member.length):(t.form.colNum=void 0,t.form.total=void 0))})),u["a"].listen(f["a"].BODY_EMPTY_CLICK,(function(){t.popShow=!1}))},methods:{popDialog:function(t){t.stopPropagation(),t.preventDefault(),this.popShow=!0,this.dialogVisible=!0},setGroup:function(){"group"!==this.seat.type?this.setGroupBySeat():this.setGroupByGroup()},setGroupBySeat:function(){var t=this.form,e=t.total,i=t.colNum;if(!e||!i||1===e)return this.dialogVisible=!1,this.popShow=!1,!1;var n=Math.ceil(e/i),o=dsf.uuid();this.seat.parentId=o,this.seat.belong="group";var s=wt.call(this,i,e,this.seat),a=this.seat.width*i,r=this.seat.height*n,c=Object(l["a"])(Object(l["a"])({},this.seat),{},{id:o,type:"group",cols:i,rows:n,width:a,height:r,memberType:this.seat.type,member:s,isFrozenSty:!1,isFrozenMemberSty:!1});this.$store.commit("seatDesign/addGroup2Panel",c),u["a"].emit(f["a"].KEY_DELETE),this.dialogVisible=!1,this.popShow=!1},setGroupByGroup:function(){var t=this.form,e=t.total,i=t.colNum,n=Math.ceil(e/i),o=this.seat.member[0];if(o.parentId=null,o.belong=null,1===e){var s=Object(l["a"])(Object(l["a"])({},o),{},{left:this.seat.left,top:this.seat.top,angle:this.seat.angle,stateList:this.seat.stateList,isFrozenSty:!1});this.$store.commit("seatDesign/addSeat2Panel",s)}else if(e>1){var a=dsf.uuid();o.parentId=a,o.belong="group";var r=wt.call(this,i,e,o),c=o.width*i,h=o.height*n,d=Object(l["a"])(Object(l["a"])({},this.seat),{},{id:a,cols:i,rows:n,width:c,height:h,member:r,isFrozenSty:!1,isFrozenMemberSty:!1});this.$store.commit("seatDesign/addGroup2Panel",d)}u["a"].emit(f["a"].KEY_DELETE),this.dialogVisible=!1,this.popShow=!1},quickOrder:function(){var t=this;"lt"===this.form.orderPosition&&this.seat.member.forEach((function(e){e.seatNum==e.seatTxt&&(e.seatTxt=t.form.orderBegin),e.seatNum=t.form.orderBegin,t.form.orderBegin+=1})),u["a"].emit(f["a"].AFTER_QUICK_ORDER),this.dialogVisible=!1,this.popShow=!1}}};function wt(t,e,i){for(var n=[],o=0;o<e;o++){var s=Math.floor(o/t),a=o%t,r=a*i.width,c=s*i.height,u=Object(l["a"])(Object(l["a"])({},i),{},{id:dsf.uuid(),left:r,top:c,colIndex:a,rowIndex:s,angle:0});n.push(u)}return n}var xt=St,kt=Object(v["a"])(xt,yt,_t,!1,null,null,null);kt.options.__file="designer/seat/seatDesign/seatPop.vue";var Ct=kt.exports,Lt=i(951),$t={name:"DsfSeatDesign",components:{topTools:y,leftTools:L,rightTools:z,SeatCanvas:K,seatItem:bt,seatPop:Ct},data:function(){return{keyStack:[],postData:{_id:"",backgroundImage:{},canvasSet:{width:void 0,height:void 0},hasBg:!1,items:[],groups:[]}}},computed:{},watch:{"postData.backgroundImage":function(){c["a"].call(this)}},created:function(){var t=this,e=dsf.url.getWebPath("$/seat_config/seat/designSeatLayout.js");this.$http.importFiles(e).then((function(e){t.layoutConfig=new Lt["a"](designSeatLayoutConfig,t.$route.query.opt),t.bindShortKey(),t.getSeatInfo()}))},beforeDestroy:function(){$(document).off("keydown"),$(document).off("keyup")},methods:{saveLayout:function(){this.saveByPub()},bindShortKey:function(){var t=["ctrl","ctrl-d","ctrl-s"];Object(c["g"])(this.keyStack,t),$("body").on("click",(function(){u["a"].dispatch(f["a"].BODY_EMPTY_CLICK)}))},saveByDev:function(){var t=Nt.call(this),e=this.$route.query.id||dsf.uuid();t._id=e,localStorage.setItem("seat_"+e,JSON.stringify(t));var i=this.$route.query,n=Object.assign({},i,{id:e});this.$router.replace({path:this.$route.path,query:n})},saveByPub:function(){var t=this,e=Nt.call(this),i={pageName:"edit",namespace:"dsfa.seat.designcontent",data:JSON.stringify(e)},n=dsf.layer.loading();this.$http.post(this.layoutConfig.saveLayoutUrl,i).done((function(e){e.success?(t.postData._id=e.data._id,t.$router.replace({path:t.$route.path,query:{id:e.data._id}}),dsf.layer.message("保存成功")):dsf.layer.message("排座设计器保存失败",!1)})).error((function(t){dsf.layer.message("排座设计器保存失败",!1)})).always((function(){dsf.layer.closeLoading(n)}))},getSeatInfo:function(){this.getInfoPub()},getInfoDev:function(){var t=this.$route.query.id;if(t){var e=JSON.parse(localStorage.getItem("seat_"+t));e&&(_.isEmpty(e.canvasSet)&&(e.canvasSet={width:void 0,height:void 0}),this.postData=e)}},getInfoPub:function(){this.$route.query.id}}};function Nt(){var t=_.cloneDeep(this.postData);return t.items.forEach((function(t){t.isFrozenSty=!1})),t.groups.forEach((function(t){t.isFrozenSty=!1,t.isFrozenMemberSty=!1})),t}var It=$t,Ot=(i(962),Object(v["a"])(It,n,o,!1,null,null,null));Ot.options.__file="designer/seat/seatDesign.vue";e["default"]=Ot.exports}}]);
//# sourceMappingURL=dsf-platform.seatDesign.js.map