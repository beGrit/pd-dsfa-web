/*!
 * Name: @dsf/cli-platform
 * Version: 0.2.46-alpha.11
 * Description: 平台基础包
 * BuildTime: 2021/7/14 下午4:42:57
 */
(("undefined"!==typeof self?self:this)["webpackJsonpplatform"]=("undefined"!==typeof self?self:this)["webpackJsonpplatform"]||[]).push([[2],{959:function(e,t,n){var i=n(977);"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n(40).default;o("3dfbe9ee",i,!1,{sourceMap:!1,shadowMode:!1})},960:function(e,t,n){var i=n(979);"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n(40).default;o("17d789f2",i,!1,{sourceMap:!1,shadowMode:!1})},961:function(e,t,n){var i=n(981);"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var o=n(40).default;o("6b5cf479",i,!1,{sourceMap:!1,shadowMode:!1})},976:function(e,t,n){"use strict";n(959)},977:function(e,t,n){"use strict";n.r(t)},978:function(e,t,n){"use strict";n(960)},979:function(e,t,n){"use strict";n.r(t)},980:function(e,t,n){"use strict";n(961)},981:function(e,t,n){"use strict";n.r(t)},986:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ds_workflow ds-designer",class:e.flowModel,attrs:{id:"desginer"}},[n("div",{staticClass:"designer-head"},[n("div",{staticClass:"desginer_tools"},[n("a",{staticClass:"ds-button--icon-text",on:{click:e.doSave}},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[e._v("保存")])]),n("a",{staticClass:"ds-button--icon-text",on:{click:function(t){return e.printImage()}}},[n("i",{staticClass:"iconfont icon-baocun"}),n("span",[e._v("导出图片")])]),n("a",{staticClass:"ds-button--icon-text",class:{selected:e.isDrawLine},on:{click:e.drawLine}},[n("i",{staticClass:"iconfont icon-liujisuan"}),n("span",[e._v("连线")])]),n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-iframetianjia"}),e._m(0),n("dl",{staticClass:"layui-nav-child"},[n("dd",{on:{click:function(t){return e.addLane("vertical")}}},[n("span",[e._v("泳道(垂直)")])]),n("dd",{on:{click:function(t){return e.addLane("horizontal")}}},[n("span",[e._v("泳道(水平)")])])])]),n("a",{staticClass:"ds-button--icon-text scale"},[n("div",{staticClass:"scale-com"},[n("i",{staticClass:"el-icon-minus",class:{disabled:e.scale<=.4},on:{click:function(t){return e.rootScale("down")}}}),n("span",{staticClass:"percent"},[e._v(e._s(Math.round(100*e.scale))+"%")]),n("i",{staticClass:"el-icon-plus",class:{disabled:e.scale>=2},on:{click:function(t){return e.rootScale("up")}}})]),n("span",[e._v("缩放")])]),n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-lianjieliu"}),e._m(1),n("dl",{staticClass:"layui-nav-child"},[e._m(2),n("p",{staticClass:"label child",on:{click:function(t){return e.exportFlowJson()}}},[e._v("JSON")]),e._m(3),n("p",{staticClass:"label child"},[n("el-upload",{attrs:{action:"",accept:".json","show-file-list":!1,"on-change":e.uploadJson,"auto-upload":!1}},[n("span",{attrs:{slot:"trigger"},slot:"trigger"},[e._v("JSON")])])],1)])]),e.selectedList&&e.selectedList.length>1?n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-lianjieliu"}),e._m(4),n("dl",{staticClass:"layui-nav-child"},[n("dd",{on:{click:function(t){return e.alignment("left")}}},[n("span",[e._v("左对齐(L)")])]),n("dd",{on:{click:function(t){return e.alignment("center")}}},[n("span",[e._v("水平居中(C)")])]),n("dd",{on:{click:function(t){return e.alignment("right")}}},[n("span",[e._v("右对齐(R)")])]),n("dd",{on:{click:function(t){return e.alignment("top")}}},[n("span",[e._v("顶端对齐(T)")])]),n("dd",{on:{click:function(t){return e.alignment("middle")}}},[n("span",[e._v("垂直居中(M)")])]),n("dd",{on:{click:function(t){return e.alignment("bottom")}}},[n("span",[e._v("底端对齐(B)")])]),n("dd",{on:{click:function(t){return e.alignment("horizontal")}}},[n("span",[e._v("横向分布(H)")])]),n("dd",{on:{click:function(t){return e.alignment("vertical")}}},[n("span",[e._v("纵向分布(V)")])])])]):e._e(),n("a",{staticClass:"ds-button--icon-text"},[n("i",{staticClass:"iconfont icon-iframetianjia"}),n("span",[e._v(" "+e._s("normal"===e.flowModel?"标准模式":"体系化模式")+" "),n("i",{staticClass:"iconfont icon-xia1"})]),n("dl",{staticClass:"layui-nav-child"},[n("dd",{on:{click:function(t){return e.setFlowModel("normal")}}},[n("span",[e._v("标准模式")])]),n("dd",{on:{click:function(t){return e.setFlowModel("systematic")}}},[n("span",[e._v("体系化模式")])])])])])]),n("div",{staticClass:"designer-content"},[n("div",{staticClass:"designer-center"},[n("div",{ref:"ds_page",staticClass:"ds_page design",on:{scroll:function(t){return e.onScroll(t)}}},[n("div",{ref:"container",staticClass:"flow",class:{"is-print-image":e.isPrintImage},style:{width:e.toPx(e.scale>1?e.width*e.scale:e.width/e.scale),height:e.toPx(e.scale>1?e.height*e.scale:e.height/e.scale),transform:"scale("+e.scale+") translateZ(0)",transformOrigin:"left top"}},[n("div",{ref:"root",staticClass:"root",class:{has_v_head:e.lanes&&e.lanes.vertical.length>0,has_h_head:e.lanes&&e.lanes.horizontal.length>0},style:{width:e.toPx(e.scale>1?e.width*e.scale:e.width/e.scale),height:e.toPx(e.scale>1?e.height*e.scale:e.height/e.scale)}},[e.baseLine.showV?n("span",{staticClass:"baseLine_v",style:{transform:"translate3d("+e.baseLine.left+"px, 0, 0)"}}):e._e(),e.baseLine.showH?n("span",{staticClass:"baseLine_h",style:{transform:"translate3d(0, "+e.baseLine.top+"px, 0)"}}):e._e(),n("flow-content",{ref:"flowContent",attrs:{"is-draw-line":e.isDrawLine,lines:e.lines,nodes:e.nodes,events:e.events,checked:e.checked}}),n("div",{ref:"backLayout",staticClass:"backgroundLayout"},[n("div",{ref:"v_lane",staticClass:"v_lane"},[n("lanes",{attrs:{lanes:e.lanes&&e.lanes.vertical,checked:e.checked},on:{addLane:e.addLane}})],1),n("div",{ref:"h_lane",staticClass:"h_lane"},[n("lanes",{attrs:{lanes:e.lanes&&e.lanes.horizontal,checked:e.checked},on:{addLane:e.addLane}})],1)])],1)])])]),n("div",{staticClass:"designer-left",staticStyle:{"margin-top":"60px"}},[n("div",{staticClass:"designer-left-tools"},[n("dsf-virtual-scroll",[n("el-collapse",{attrs:{accordion:""},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[e._l(e.flowTools,(function(t,i){return n("el-collapse-item",{key:i,attrs:{title:t.title,name:i}},[n("div",{staticClass:"layui-colla-content layui-show"},[e._l(t.data,(function(t){return n("div",{key:t.type,staticClass:"ds_tool_item nodeButton",attrs:{title:t.name,sort:t.sort,nodetype:t.type,draggable:"true"},on:{dragstart:function(n){return e.dragTool(n,t)}}},[n("img",{attrs:{src:t.img,draggable:"false"}}),e._v(" "+e._s(t.name)+" ")])})),n("div",{staticStyle:{clear:"both"}})],2)])})),n("el-collapse-item",{attrs:{title:"边界事件",name:"5"}},[n("div",{staticClass:"layui-colla-content layui-show"},e._l(e.boundaryEvents,(function(t){return n("div",{key:t.type,staticClass:"nodeButton ds_tool_event",attrs:{title:t.name,nodetype:t.type}},[n("div",{staticClass:"tool_event_drag",attrs:{draggable:"true"},on:{dragstart:function(n){return e.dragBoundaryEvent(n,t)}}},[n("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:t.url,draggable:"false"}})]),n("span",{staticClass:"event-name"},[e._v(e._s(t.name))])])})),0)]),n("el-collapse-item",{attrs:{title:"附属属性",name:"6"}},[n("div",{staticClass:"layui-colla-content layui-show"},e._l(e.attached,(function(t){return n("div",{key:t.type,staticClass:"nodeButton ds_tool_event",attrs:{title:t.name,nodetype:t.type}},[n("div",{staticClass:"tool_event_drag",attrs:{draggable:"true"},on:{dragstart:function(n){return e.dragAttached(n,t)}}},[n("img",{staticStyle:{width:"32px",height:"32px"},attrs:{src:t.url,draggable:"false"}})]),n("span",{staticClass:"event-name"},[e._v(e._s(t.name))])])})),0)])],2)],1)],1)]),n("div",{staticClass:"designer-right"},[n("dsf-virtual-scroll",[n("flow-info",{attrs:{checked:e.checked,nodes:e.nodes,lines:e.lines,"flow-info":e.flowInfo}})],1)],1)])])},o=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 泳道 "),n("i",{staticClass:"iconfont icon-xia1"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 更多 "),n("i",{staticClass:"iconfont icon-xia1"})])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",{staticClass:"title"},[n("span",[e._v("导出")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("p",{staticClass:"title"},[n("span",[e._v("导入")])])},function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",[e._v(" 对齐方式 "),n("i",{staticClass:"iconfont icon-xia1"})])}];i._withStripped=!0;var s=n(5),a=n(3),l=n.n(a),r=n(9),c=n(6),d=(n(140),n(24),n(25),n(15),n(63),n(16),n(33),n(64),n(23),n(20),n(38),n(970),n(260),n(108),n(642),n(974),n(128),n(48),n(52),n(8),n(141),n(266));n(544),n(10),n(35),n(198),n(644);function u(){var e,t,n,i=this.getXMLStr(),o=new Blob([i],{type:"text/xml;charset=UTF-8",encoding:"UTF-8"}),s=document.createElement("a"),a=window.URL.createObjectURL(o);s.href=a,s.download=null!==(e=null===(t=this.flowInfo)||void 0===t||null===(n=t.BaseInfo)||void 0===n?void 0:n.Name)&&void 0!==e?e:"流程",s.click()}function h(e,t){var n=this,i=new FileReader;dsf.layer.confirm({title:"",message:"导入后模式会切换为导入文件的模式，确认导入吗？"}).then((function(){i.onload=function(e){var t,i=JSON.parse(e.target.result);if(null!==i&&void 0!==i&&i.WorkFlow){n.$store.commit("flow/clearLanes");for(var o=0;o<n.events.length;o++)n.deleteEvent(n.events[o].id,n.events),o--;for(var s=0;s<n.lines.length;s++)n.deleteLine(n.lines[s]),s--;for(var a=0;a<n.nodes.length;a++)n.deleteNode(n.nodes[a]),a--;n.flowInfo=i.WorkFlow,n.flowInfo.BaseInfo.ID=n.$route.query.id,n.$route.query.sName&&(n.flowInfo.BaseInfo.Name=n.$route.query.sName),n.setFlowModel(i.flowModel||(null===(t=i.WorkFlow)||void 0===t?void 0:t.flowModel)||"normal"),n.loadElement()}else dsf.layer.message("导入数据不满足要求",!1)},i.readAsText(e.raw)})).catch((function(){}))}function f(){var e,t,n,i,o,s,a,l,r=this.getSaveData();r=_.cloneDeep(r);var c={201:0,101:1,299:2,302:3,102:4};r.WorkFlow.BaseInfo.Vendor.APP={ID:"",Name:null!==(e=this.$route.query.sAPPName)&&void 0!==e?e:"",Desc:"",ModuleID:null!==(t=this.$route.query.sModuleID)&&void 0!==t?t:""},null===(n=r)||void 0===n||null===(i=n.WorkFlow)||void 0===i||null===(o=i.NodeList)||void 0===o||o.forEach((function(e){var t,n,i;e.BaseInfo.Type=null!==(t=c[e.BaseInfo.Type])&&void 0!==t?t:e.BaseInfo.Type,Object.assign(e,e.BaseInfo),e.InLine&&Object.assign(e.InLine,{Require:"",IsSpecialSend:"",Multiplayer:{IsEnabled:"",SendMode:"",Poior:""},ExAction:"",SendBackAction:"",BanSendBack:""}),null!==e&&void 0!==e&&null!==(n=e.InLine)&&void 0!==n&&null!==(i=n.RangeRule)&&void 0!==i&&i.Rule&&(e.InLine.RangeRule.RuleList=e.InLine.RangeRule.Rule,e.InLine.RangeRule.RuleList.forEach((function(e){var t,n,i,o;(e.RangeType=e.Type,e.Range=e.name,21==e.Type)&&(e.IsDeep=null!==(t=e.IsDeep)&&void 0!==t?t:"",e.IsShowDeptUser="");22==e.Type&&(e.NodeRowIndex="",e.desc="",e.IsDeep=null!==(n=e.IsDeep)&&void 0!==n?n:"",e.IsShowDeptUser="");(23==e.Type&&(e.Script="1",e.Sql=e.exp,e.SuperType="6"),31==e.Type&&(e.IsShowDeptUser=""),32==e.Type)&&(e.NodeRowIndex="",e.desc="",e.IsDeep=null!==(i=e.IsDeep)&&void 0!==i?i:"",e.IsShowDeptUser="",e.Level=1,e.level=1);33==e.Type&&(e.IsDeep=null!==(o=e.IsDeep)&&void 0!==o?o:"",e.IsShowDeptUser="",e.Script="1",e.Sql=e.exp,e.SuperType="6");41==e.Type&&(e.desc="",e.level="1"),42==e.Type&&(e.Script="1",e.Sql=e.exp,e.SuperType="6"),delete e.id,delete e.IsUser,delete e.name,delete e.Type})),delete e.InLine.RangeRule.Rule),e.OutLine&&Object.assign(e.OutLine,{SendConditions:"",PreAction:""}),delete e.BaseInfo})),null===(s=r)||void 0===s||null===(a=s.WorkFlow)||void 0===a||null===(l=a.LineList)||void 0===l||l.forEach((function(e){Object.assign(e,{Alias:"",Desc:"",SendParameter:{IsAutoSend:"",ShowOrder:"",IsInheritDept:"",IsBackTrack:"",Multiplayer:{SendMode:""},ExAction:"",SendBackAction:"",IsRemind:"",RemindContent:""}},e.BaseInfo),delete e.BaseInfo})),r.WorkFlow.Corridor={CorridorList:r.WorkFlow.LaneList.horizontal,StageList:r.WorkFlow.LaneList.vertical},delete r.WorkFlow.LaneList;var d=this.dataToXML(r);return d}function p(e,t){var n=this,i="";if(_.isArray(e)){var o=(null===t||void 0===t?void 0:t.indexOf("List"))>-1,s=t.replace("List","");e.forEach((function(t,a){o?i+="<".concat(s,">").concat(n.dataToXML(t),"</").concat(s,">"):(i+="".concat(n.dataToXML(t)),a<e.length-1&&(i+="</".concat(s,">")),a<e.length-1&&(i+="<".concat(s,">")))}))}else{if(!_.isObject(e))return e;Object.keys(e).forEach((function(t){"sImgData"!==t&&(i+="<".concat(t,">").concat(n.dataToXML(e[t],t),"</").concat(t,">"))}))}return i}function v(){var e=this.sID,t=this.flowInfo.BaseInfo.Name,n=dsf.url.getWebPath("wfk/exportJsonWF");$("<form action="+n+' method="get"><input type="text" name="sID" value="'+e+'"/><input type="text" name="zipName" value="'+t+'"/></form>').appendTo("body").submit().remove()}function g(e,t){var n=this;e.forEach((function(e){e.point.x=t,n.$bus.$emit("nodeMove",e)}))}function b(e,t){var n=this;e.forEach((function(e){e.point.x=t-e.width,n.$bus.$emit("nodeMove",e)}))}function m(e,t){var n=this;e.forEach((function(e){e.point.y=t,n.$bus.$emit("nodeMove",e)}))}function y(e,t){var n=this;e.forEach((function(e){e.point.y=t-e.height,n.$bus.$emit("nodeMove",e)}))}function x(e,t){var n=this;e.forEach((function(e){e.point.y=t-e.height/2,n.$bus.$emit("nodeMove",e)}))}function w(e,t){var n=this;e.forEach((function(e){e.point.x=t-e.width/2,n.$bus.$emit("nodeMove",e)}))}function N(e){var t=this,n=e.sort((function(e,t){return e.point.x-t.point.x})),i=[];n.reduce((function(e,t){var n=t.point.x-(e.point.x+e.width);return i.push(n),t}));var o=i.reduce((function(e,t){return e+t}))/i.length;n.forEach((function(e,i){0!==i&&i!==n.length-1&&(e.point.x=n[i-1].point.x+n[i-1].width+o,t.$bus.$emit("nodeMove",e))}))}function O(e){var t=this,n=e.sort((function(e,t){return e.point.y-t.point.y})),i=[];n.reduce((function(e,t){var n=t.point.y-(e.point.y+e.height);return i.push(n),t}));var o=i.reduce((function(e,t){return e+t}))/i.length;n.forEach((function(e,i){0!==i&&i!==n.length-1&&(e.point.y=n[i-1].point.y+n[i-1].height+o,t.$bus.$emit("nodeMove",e))}))}function I(e){var t=this.$store.state.flow.selectedList,n=0,i=0,o=0,s=0,a=0,l=0;switch(t.forEach((function(e,t){var a=e.width,l=e.height,r=e.point,c=r.x,d=r.y;0===t&&(n=d,s=c,i=c+a,o=d+l),s>c&&(s=c),n>d&&(n=d),i<c+a&&(i=c+a),o<d+l&&(o=d+l)})),a=(n+o)/2,l=(s+i)/2,e){case"left":this.alignLeft(t,s);break;case"top":this.alignTop(t,n);break;case"right":this.alignRight(t,i);break;case"bottom":this.alignBottom(t,o);break;case"middle":this.alignMiddle(t,a);break;case"center":this.alignCenter(t,l);break;case"horizontal":this.alignHorizontal(t);break;case"vertical":this.alignVertical(t);break}}var k={exportXML:u,uploadJson:h,getXMLStr:f,dataToXML:p,exportFlowJson:v,alignment:I,alignLeft:g,alignRight:b,alignTop:m,alignBottom:y,alignMiddle:x,alignCenter:w,alignHorizontal:N,alignVertical:O},L=n(492),j=n(2),S=n(31),E=function(e){var t=Object.assign({size:260,direction:j["a"].vertical},e);this.id=t.id||null,this.name=t.name||"",this.index=t.index,this.direction=t.direction,this.isRender=!1,this.size=t.size,this.setAttributes=Object(r["a"])(l.a.mark((function e(){var n;return l.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.attributes){e.next=9;break}return e.next=3,Object(S["h"])("lane");case 3:n=e.sent,this.attributes=Object(S["b"])(n),this.attributes.Name=this.name,this.attributes.ID=this.id,e.next=10;break;case 9:this.attributes=Object(c["a"])({},t.attributes);case 10:case"end":return e.stop()}}),e,this)}))),this.setAttributes()},C=E,M=n(473),D=n(502),P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"ds_attr_root"},[n("div",{directives:[{name:"show",rawName:"v-show",value:"base"===e.status,expression:"status === 'base'"}],staticClass:"base"},[n("p",{staticClass:"title"},[n("span",[e._v("常用")]),n("el-button",{staticClass:"el-button-all",attrs:{size:"mini",round:""},on:{click:function(t){e.status="advanced"}}},[n("span",[e._v("全部")]),n("i",{staticClass:"el-icon-arrow-right"})])],1),n("div",{staticClass:"el-collapse-item__content"},e._l(e.data,(function(t,i){return n("el-form",{key:i,staticClass:"colla-content",attrs:{"label-position":"top","label-width":"80px"}},e._l(t.attributes,(function(t,i){return n("div",{key:i,staticClass:"property-item"},[!t.hide&&t.isBase?n("el-form-item",[n("span",{staticClass:"property-item-name",attrs:{slot:"label"},slot:"label"},[e._v(" "+e._s(t.name)+" "),t.desc?n("DsfIcon",{staticStyle:{"margin-left":"5px",cursor:"pointer"},attrs:{name:"bangzhuzhongxin"},on:{click:function(n){return e.showHelp(t)}}}):e._e(),n("el-dialog",{attrs:{visible:t.showHeplerMark,title:t.name,"append-to-body":!0,width:"500px"},on:{"update:visible":function(n){return e.$set(t,"showHeplerMark",n)}}},[n("div",{staticStyle:{"max-height":"500px","min-height":"300px",overflow:"auto"}},[n("span",{staticStyle:{display:"inline-block","line-height":"1.5em"},domProps:{innerHTML:e._s(t.desc)}})])])],1),"flow"===t.nodeType&&"Version"===t.nodeName2?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:e.minValue(t,0)},on:{input:function(n){return e.changeVesion(t,0)}},model:{value:t.value0,callback:function(n){e.$set(t,"value0",n)},expression:"attr.value0"}}),n("span",[e._v(".")]),n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:e.minValue(t,1)},on:{input:function(n){return e.changeVesion(t,1)}},model:{value:t.value1,callback:function(n){e.$set(t,"value1",n)},expression:"attr.value1"}}),n("span",[e._v(".")]),n("el-input",{attrs:{disabled:"disabled"},model:{value:t.value2,callback:function(n){e.$set(t,"value2",n)},expression:"attr.value2"}})],1):e._e(),t.unit?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:1,max:t.max},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}),n("span",{staticClass:"unit"},[e._v(e._s(t.unit))])],1):e._e(),e.show(t)?n("el-input",{attrs:{disabled:e.subIsDisabled||!t.editor},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),"numberbox"===t.editor?n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:0},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),"textarea"===t.editor?n("el-input",{attrs:{disabled:e.subIsDisabled,type:"textarea",placeholder:"请输入内容"},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),t.editor&&"combobox"===t.editor.type?n("el-select",{attrs:{name:t.nodeName1+"_"+t.nodeName2,disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(e,t){return n("el-option",{key:t,attrs:{label:e.text,value:e.value}})})),1):e._e(),t.editor&&"radio"===t.editor.type?n("el-radio-group",{attrs:{disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,i){return n("el-radio",{key:i,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),t.editor&&"checkbox"===t.editor.type?n("el-checkbox-group",{attrs:{disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,i){return n("el-checkbox",{key:i,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),"dialog"===t.type?n("DsfButton",{class:[t.class],attrs:{type:"plain",icon:"shezhi"},on:{click:function(n){return e.doOpenDialog(t)}}},[e._v(" "+e._s(e.subIsDisabled?"查看":"设置")+" ")]):e._e()],1):e._e()],1)})),0)})),1)]),n("div",{directives:[{name:"show",rawName:"v-show",value:"advanced"===e.status,expression:"status === 'advanced'"}],staticClass:"advanced"},[n("p",{staticClass:"title"},[n("span",[e._v("全部")]),n("el-button",{staticClass:"el-button-base",attrs:{size:"mini",round:""},on:{click:function(t){e.status="base"}}},[n("i",{staticClass:"el-icon-arrow-left"}),n("span",[e._v("常用")])])],1),n("el-collapse",{attrs:{accordion:""},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.data,(function(t){return n("el-collapse-item",{key:t.name,attrs:{title:t.name,name:t.name}},[n("el-form",{staticClass:"colla-content",attrs:{"label-position":"top","label-width":"80px"}},e._l(t.attributes,(function(t,i){return n("div",{key:i,staticClass:"property-item"},[t.hide?e._e():n("el-form-item",[n("span",{staticClass:"property-item-name",attrs:{slot:"label"},slot:"label"},[e._v(" "+e._s(t.name)+" "),t.desc?n("DsfIcon",{staticStyle:{"margin-left":"5px",cursor:"pointer"},attrs:{name:"bangzhuzhongxin"},on:{click:function(n){return e.showHelp(t)}}}):e._e(),n("el-dialog",{attrs:{visible:t.showHeplerMark,title:t.name,"append-to-body":!0,width:"500px"},on:{"update:visible":function(n){return e.$set(t,"showHeplerMark",n)}}},[n("div",{staticStyle:{"max-height":"500px","min-height":"300px",overflow:"auto"}},[n("span",{staticStyle:{display:"inline-block","line-height":"1.5em"},domProps:{innerHTML:e._s(t.desc)}})])])],1),"flow"===t.nodeType&&"Version"===t.nodeName2?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:e.minValue(t,0)},on:{input:function(n){return e.changeVesion(t,0)}},model:{value:t.value0,callback:function(n){e.$set(t,"value0",n)},expression:"attr.value0"}}),n("span",[e._v(".")]),n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:e.minValue(t,1)},on:{input:function(n){return e.changeVesion(t,1)}},model:{value:t.value1,callback:function(n){e.$set(t,"value1",n)},expression:"attr.value1"}}),n("span",[e._v(".")]),n("el-input",{attrs:{disabled:"disabled"},model:{value:t.value2,callback:function(n){e.$set(t,"value2",n)},expression:"attr.value2"}})],1):e._e(),t.unit?n("div",{staticClass:"inline"},[n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:0,max:t.max},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}),n("span",{staticClass:"unit"},[e._v(e._s(t.unit))])],1):e._e(),e.show(t)?n("el-input",{attrs:{disabled:e.subIsDisabled||!t.editor},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),"numberbox"===t.editor?n("el-input-number",{attrs:{"controls-position":"right",disabled:e.subIsDisabled,min:0},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),"textarea"===t.editor?n("el-input",{attrs:{disabled:e.subIsDisabled,type:"textarea",placeholder:"请输入内容"},on:{input:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}}):e._e(),t.editor&&"combobox"===t.editor.type?n("el-select",{attrs:{name:t.nodeName1+"_"+t.nodeName2,disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(e,t){return n("el-option",{key:t,attrs:{label:e.text,value:e.value}})})),1):e._e(),t.editor&&"radio"===t.editor.type?n("el-radio-group",{attrs:{disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,i){return n("el-radio",{key:i,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),t.editor&&"checkbox"===t.editor.type?n("el-checkbox-group",{attrs:{disabled:e.subIsDisabled},on:{change:function(n){return e.changeProperty(t)}},model:{value:t.value,callback:function(n){e.$set(t,"value",n)},expression:"attr.value"}},e._l(t.editor.options.data,(function(t,i){return n("el-checkbox",{key:i,attrs:{label:t.value}},[e._v(" "+e._s(t.text)+" ")])})),1):e._e(),"dialog"===t.type?n("DsfButton",{class:t.class,attrs:{type:"plain",icon:"shezhi"},on:{click:function(n){return e.doOpenDialog(t)}}},[e._v(" "+e._s(e.subIsDisabled?"查看":"设置")+" ")]):e._e()],1)],1)})),0)],1)})),1)],1)])},T=[];P._withStripped=!0;n(36),n(975),n(26);var z=n(545),R=n(624),B={name:"FlowInfo",components:{DsfDesignerDialog:R["a"]},props:{checked:{type:Object,default:function(){return{}}},flowInfo:{type:Object,default:function(){return{}}},nodes:{type:Array,default:function(){return[]}},lines:{type:Array,default:function(){return[]}}},data:function(){return{activeNames:["1"],curSelectObj:null,curNodeAttr:null,curElement:null,AppInfo:null,data:[],status:"base",showHeplerMark:!1,subIsDisabled:!1}},computed:{minValue:function(){return function(e,t){return 0===t?Number(e.oldValue.split(".")[0]):e.value0>Number(e.oldValue.split(".")[0])&&1===t?0:Number(e.oldValue.split(".")[1])}}},watch:{checked:function(e){},"checked.attributes":function(e){this.curNodeAttr=e,e&&(this.loadPropertyWindow(this.checked),this.subIsDisabled=this.disabledSub())}},mounted:function(){var e=this;this.$bus.$on("updateNodeName",(function(t,n){n||e.loadPropertyWindow(t)}))},methods:{disabledSub:function(){if(this.curSelectObj&&this.curSelectObj.parentNodeId){var e=Object(S["d"])(this.nodes,this.curSelectObj.parentNodeId);return Object(S["j"])(e)}return!1},show:function(e){return!e.nodeType&&"Version"!==e.nodeName2&&!e.editor&&"dialog"!==e.type||!e.unit&&"text"===e.editor},loadPropertyWindow:function(e){var t=this;return Object(r["a"])(l.a.mark((function n(){var i;return l.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(0!==Object.keys(e).length){n.next=2;break}return n.abrupt("return");case 2:if(!e){n.next=8;break}return n.next=5,t.setPropertyData(e);case 5:n.t0=n.sent,n.next=9;break;case 8:n.t0=[];case 9:i=n.t0,t.curSelectObj=e||null,t.loadPropertyDom(i);case 12:case"end":return n.stop()}}),n)})))()},showHelp:function(e){this.$set(e,"showHeplerMark",!0)},setPropertyData:function(e){return Object(r["a"])(l.a.mark((function t(){var n,i,o,s,a,r,c;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=null,i=e instanceof L["a"]?"node"+e.type:e instanceof M["a"]?"line":e instanceof C?"lane":e instanceof D["a"]?"boundaryevent":"flow",t.next=4,Object(S["h"])(i);case 4:for(n=t.sent,o=e.attributes,s=null,a=-1,r=[],c=0;c<n.length;c++)1==n[c].nodeLevel?n[c].value=o[n[c].nodeName]:2==n[c].nodeLevel?o[n[c].nodeName1]?n[c].value=o[n[c].nodeName1][n[c].nodeName2]:n[c].value="":3==n[c].nodeLevel&&(o[n[c].nodeName1]&&o[n[c].nodeName1][n[c].nodeName2]?n[c].value=o[n[c].nodeName1][n[c].nodeName2][n[c].nodeName3]:n[c].value=""),n[c].group!=s&&(a++,s=n[c].group,r[a]={name:s,attributes:[]}),r[a]["attributes"].push(n[c]);return t.abrupt("return",r);case 11:case"end":return t.stop()}}),t)})))()},loadPropertyDom:function(e){var t=this,n=[];e.forEach((function(e){e.attributes.forEach((function(e){if(e.editor&&"checkbox"===e.editor.type)e.value=e.value||[];else if(e.editor&&"checkbox"!==e.editor.type){var t,i=Number(e.value);i=Number.isNaN(i)?e.value:i,e.value=null!==(t=e.editor)&&void 0!==t&&t.options&&null!==e&&void 0!==e&&e.value?i:e.value}else"flow"===e.nodeType&&"Version"===e.nodeName2?(e.oldValue=e.value,e.value0=e.value.split(".")[0],e.value1=e.value.split(".")[1],e.value2=e.value.split(".")[2]):e.value=e.value;e.showRob&&n.push(e)}))})),this.data=e,n&&n.length>0&&n.forEach((function(e){t.showRob(e)})),this.activeNames=[this.data[0].name]},changeVesion:function(e,t){e&&(0===t&&(e.value1=0,e.value2="0001"),e.value=e.value0+"."+e.value1+"."+e.value2,this.changeProperty(e))},changeProperty:function(e){if(1==e.nodeLevel&&"Name"===e.nodeName)this.curSelectObj.name=e.value;else if(e.nodeName2&&"Name"==e.nodeName2){var t,n;if(this.curSelectObj instanceof L["a"]&&(this.curSelectObj.name=e.value,this.$bus.$emit("updateNodeName".concat(this.isSub?this.parentNode.id:""),this.curSelectObj,!0)),this.curSelectObj instanceof C&&(this.curSelectObj.name=e.value),this.curSelectObj instanceof M["a"])null!==(t=this.curSelectObj)&&void 0!==t&&null!==(n=t.edit)&&void 0!==n&&n.name1||(this.curSelectObj.name=e.value)}if(e.showRob&&"GatherRule"==e.showRob&&this.curSelectObj instanceof M["a"]&&(this.curSelectObj.type=e.value),"InLine"===e.nodeName1&&"Type"===e.nodeName2){var i=Object(z["a"])(e.value),o=[],s=this.curNodeAttr.InLine.RangeRule&&this.curNodeAttr.InLine.RangeRule.Rule;s&&s.length>0&&(s.forEach((function(e,t){o.push(e.name+"/"+Object(z["b"])(e.IsSelected))})),this.curSelectObj.taskMsg="".concat(i,": ").concat(o.join(",")))}if("InLine"===e.nodeName1&&"RangeRule"===e.nodeName2&&e.value&&e.value.Rule&&e.value.Rule.length>0){var a=Object(z["a"])(this.curNodeAttr.InLine.Type),l=[];e.value.Rule.forEach((function(e,t){l.push(e.name+"/"+Object(z["b"])(e.IsSelected))})),this.curSelectObj.taskMsg="".concat(a,": ").concat(l.join(","))}this.showRob(e),1==e.nodeLevel?this.curNodeAttr[e.nodeName]=e.value:2==e.nodeLevel?this.curNodeAttr[e.nodeName1][e.nodeName2]=e.value:3==e.nodeLevel&&(this.curNodeAttr[e.nodeName1][e.nodeName2][e.nodeName3]=e.value),this.curSelectObj instanceof M["a"]&&"LineShape"===e.nodeName2&&this.$bus.$emit("changeLineShape".concat(this.isSub?this.parentNode.id:""),this.curSelectObj),this.curSelectObj instanceof M["a"]&&"strokeDasharray"===e.nodeName2&&(this.curSelectObj.strokeDasharray=e.value,this.curSelectObj.refresh())},showRob:function(e){var t=this;e.showRob&&this.data.forEach((function(n){n.attributes.forEach((function(n){var i=e.showRob.split(",");i.forEach((function(i){if(n.nodeName2===i||n.nodeName3===i)if("RushInfo"===i)5===e.value?Object.assign(n,{name:"人数",value:1,max:999999,unit:"（人）",hide:!1}):6===e.value?Object.assign(n,{name:"比例",value:60,max:100,unit:"%",hide:!1}):n.hide=!0;else if("GatherRule"===i)1===e.value||2===e.value?n.hide=!1:n.hide=!0;else if("Params"===i)0===e.value||1===e.value?n.hide=!1:n.hide=!0;else if("Content"===i)2===e.value?n.hide=!1:n.hide=!0;else if("Value"===i)0!==e.value?n.hide=!1:n.hide=!0;else if("IsEnbled"===i)e.value&&t.curSelectObj.attributes.BaseInfo&&0===t.curSelectObj.attributes.BaseInfo.Mode?n.hide=!1:n.hide=!0;else if("OpinionNodeID"===i){var o=t.curSelectObj.attributes.BaseInfo;setTimeout((function(){0===o.Mode&&o.SubWFID&&1===o.Merge.IsEnbled?n.hide=!1:n.hide=!0}),0)}}))}))}))},doOpenDialog:function(e){var t=this,n=e,i={code:n.value&&n.value.Expression||"",language:"java",checked:this.checked,value:n.value};n.config&&n.config.content&&("RangeRule"===n.config.content||"SumAllNode"===n.config.content?(i.nodes=this.nodes,i.value=n.value||{}):"Summary"===n.config.content||"SendCondition"===n.config.content?(i.lines=this.lines,i.value=n.value||{}):"EventSetting"===n.config.content?i.isEvent=!0:"SetSubFlow"===n.config.content?i.mode=this.curSelectObj.attributes.BaseInfo.Mode:"SetOpinionNode"===n.config.content?i.subNodes=this.curSelectObj.nodes:"SumStartNode"===n.config.content&&(i.nodes=this.nodes,i.value=n.value||[])),dsf.layer.openDialog({title:n.name,width:n.config.width,height:n.config.height,overflow:"auto",content:n.config.content,params:i,btns:[{class:this.subIsDisabled?"hide":"",text:"确定",handler:function(e){if("SetSubFlow"===n.config.content){if(e.validate()){var i=e.yes();return n.value=i.SubWFID,t.curSelectObj.attributes.BaseInfo.Mode=i.Mode,t.curSelectObj.attributes.BaseInfo.SubWFName=i.SubWFName,t.curSelectObj.attributes.BaseInfo.OpinionNodeID=null,t.curSelectObj.attributes.BaseInfo.OpinionNodeName=null,i.SubWFID?t.$http.get("wfm/getWFDefinition",{sID:i.SubWFID}).then((function(e){return t.changeProperty(n),t.$bus.$emit("initSubNode",t.curSelectObj,e.data.data.WorkFlow&&e.data.data.WorkFlow.ElementList||[]),!0})).catch((function(e){})):(t.$bus.$emit("initSubNode",t.curSelectObj,[]),!0)}return!1}if("SetOpinionNode"===n.config.content){var o=e.yes();n.value=o.id,t.curSelectObj.attributes.BaseInfo.OpinionNodeName=o.name,t.changeProperty(n)}else"SelectImg"===n.config.content?(n.value=e.getContent(),Object.assign(t.curSelectObj,j["h"][n.value]),t.curSelectObj.imgType=n.value,t.curSelectObj,t.$bus.$emit("nodeMove",t.curSelectObj),t.changeProperty(n)):(n.value=e.getContent(),t.changeProperty(n))}},{text:"取消"}]}),"SetSubFlow"!==n.config.content||n.value||dsf.layer.message("请慎重操作，选择子流程任务后，将自动获取子流程任务，覆盖子流程")}}},A=B,F=(n(976),n(0)),W=Object(F["a"])(A,P,T,!1,null,"420525b2",null);W.options.__file="designer/flow/flowInfo.vue";var X=W.exports,V=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{ref:"svgRoot",staticClass:"svgRoot"},[n("lines",{ref:"lines",attrs:{"is-draw-line":e.isDrawLine,lines:e.lines,nodes:e.nodes,events:e.events,checked:e.checked}}),n("nodes",{attrs:{"is-draw-line":e.isDrawLine,nodes:e.nodes,checked:e.checked}}),n("events",{attrs:{"is-draw-line":e.isDrawLine,nodes:e.nodes,events:e.events,checked:e.checked}})],1)},G=[];V._withStripped=!0;var H=n(623),Y=n(626),U=n(625),q={name:"FlowContent",components:{Lines:H["a"],Events:Y["a"],subprocess:U["a"]},props:{lines:{type:Array,default:function(){return[]}},nodes:{type:Array,default:function(){return[]}},events:{type:Array,default:function(){return[]}},isDrawLine:{type:Boolean,default:function(){return!1}},checked:{type:Object,default:function(){return{}}}},data:function(){return{}},created:function(){},methods:{}},J=q,K=Object(F["a"])(J,V,G,!1,null,null,null);K.options.__file="designer/flow/flowContent.vue";var Z=K.exports,Q=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"lanes"},e._l(e.lanes,(function(t,o){return i("div",{key:t.id||o,staticClass:"lane",class:{selected:e.checked===t},style:{left:e.toPx(t.left),top:e.toPx(t.top),width:"vertical"===t.direction?e.toPx(t.size):"",height:"horizontal"===t.direction?e.toPx(t.size):""},attrs:{index:o},on:{click:function(n){return e.selectLane(n,t)}}},[i("div",{staticClass:"head"},[i("div",{staticClass:"title"},[i("el-popover",{attrs:{placement:"vertical"===t.direction?"bottom":"right",title:"修改名称",width:"200",trigger:"manual"},model:{value:t.isEdit,callback:function(n){e.$set(t,"isEdit",n)},expression:"lane.isEdit"}},[i("div",{staticClass:"el-input"},[t.isEdit?i("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"lane.name"},{name:"focus",rawName:"v-focus"}],staticClass:"el-input__inner",attrs:{autofocus:"",type:"text",placeholder:"请输入内容"},domProps:{value:t.name},on:{change:function(n){t.attributes.Name=t.name,e.hideEdit()},input:function(n){n.target.composing||e.$set(t,"name",n.target.value)}}}):e._e()]),i("span",{staticClass:"textContent ellipsis",style:{width:e.toPx(t.size),transform:"horizontal"===t.direction?"rotate(-90deg) translateX(-"+t.size+"px)":""},attrs:{slot:"reference"},on:{dblclick:function(n){return e.edit(t)}},slot:"reference"},[e._v(" "+e._s(t.name)+" ")])]),i("img",{staticClass:"plus left",attrs:{src:n(643)},on:{click:function(n){return e.addLane(t.direction,o)}}}),i("img",{staticClass:"plus right",attrs:{src:n(643)},on:{click:function(n){return e.addLane(t.direction,o+1)}}}),i("span",{staticClass:"resizeLane",on:{mousedown:function(n){return e.dragLane(n,t)}}})],1)]),i("div",{staticClass:"bg/"}),i("div",{staticClass:"laneSelected"})])})),0)},ee=[];Q._withStripped=!0;var te={name:"Lanes",props:{lanes:{type:Array,default:function(){return[]}},checked:{type:Object,default:function(){return{}}}},data:function(){return{current:null,minSize:100}},mounted:function(){var e=this;document.addEventListener("mousedown",(function(t){var n,i,o=t.target;"tooltip"!==o.getAttribute("role")&&"tooltip"!==(null===o||void 0===o||null===(n=o.parentElement)||void 0===n?void 0:n.getAttribute("role"))&&"tooltip"!==(null===o||void 0===o||null===(i=o.parentElement)||void 0===i?void 0:i.parentElement.getAttribute("role"))&&e.hideEdit()})),document.addEventListener("mousemove",(function(t){e.moveLane(t)})),document.addEventListener("mouseup",(function(t){e.dropLane(t)}))},methods:{toPx:function(e){return"".concat(e,"px")},selectLane:function(e,t){this.$bus.$emit("update-checked",t),e.stopPropagation()},addLane:function(e,t){this.$emit("addLane",e,t)},dragLane:function(e,t){this.$bus.$emit("update-checked",t),this.current=Object(c["a"])({},t),this.$bus.$emit("update-baseLine",{show:this.current.direction,top:0,left:0})},dropLane:function(e){if(this.current){var t=this.$store.state.flow.page,n=this.$store.state.flow.svgRoot,i=this.$store.state.flow.page.scale;this.current.direction===j["a"].vertical?this.current.size=(e.pageX-this.current.left-t.left+n.scrollLeft)/i:this.current.size=(e.pageY-this.current.top-t.top+n.scrollTop)/i,this.current.size=this.current.size>this.minSize?this.current.size:this.minSize,this.$bus.$emit("update-baseLine",{showV:!1,showH:!1,top:0,left:0}),this.$store.commit("flow/changeLane",this.current),this.$bus.$emit("resize"),this.current=null}},moveLane:function(e){if(!this.current)return!1;var t,n=this.$store.state.flow.page,i=this.$store.state.flow.svgRoot,o=this.$store.state.flow.page.scale;if(this.current.direction===j["a"].vertical){var s=this.current.left+this.minSize,a=e.pageX-n.left+i.scrollLeft;t={top:10,left:(a>s*o?a:s*o)/o}}else{var l=this.current.top+this.minSize,r=e.pageY-n.top+i.scrollTop;t={top:(r>l*o?r*o:l)/o,left:10}}var c=Object.assign(t,{showV:"vertical"===this.current.direction,showH:"horizontal"===this.current.direction});this.$bus.$emit("update-baseLine",c),this.$bus.$emit("autoScroll",{type:"lane",data:this.current,mouse:{x:e.pageX,y:e.pageY}})},edit:function(e){this.lanes.forEach((function(t){t.isEdit=e===t}))},hideEdit:function(){this.lanes.forEach((function(e){e.isEdit=!1}))}}},ne=te,ie=(n(978),Object(F["a"])(ne,Q,ee,!1,null,"11303e4c",null));ie.options.__file="designer/flow/Lanes.vue";var oe=ie.exports,se=n(460),ae=n(952),le=n.n(ae),re={name:"Flow",components:{FlowInfo:X,FlowContent:Z,Lanes:oe},data:function(){return{activeNames:[0],isDrawLine:!1,dragNode:null,dragEvent:null,dragAttach:null,endTarget:null,width:0,height:0,maxWidth:0,maxHeight:0,flow:null,flowInfo:null,sID:this.$route.query&&this.$route.query.id,nodes:[],lines:[],events:[],distance:30,cloneObj:null,crashNode:null,dragSize:20,maxSizeOffset:50,flowTools:z["e"],boundaryEvents:z["d"],attached:z["c"],checked:null,baseLine:{show:"",top:0,left:0},showLineV:!1,showLineH:!1,isGlobalPosMove:!1,globalPos:null,globalMoveLastMouse:null,globalRect:null,isGlobalSelect:!1,selectGlobalPos:null,selectGlobalPonits:{start:{x:0,y:0},end:{x:0,y:0}},globalSelect:null,isCtrlKey:!1,ctrlCopyNodes:null,isCopyNodes:!1,copyNodesPos:null,copyNodes:[],hasMoved:!1,isPrintImage:!1,printImageUrl:""}},computed:Object(c["a"])({},Object(d["mapState"])({page:function(e){return e.flow.page},scale:function(e){return e.flow.page.scale},lanes:function(e){return e.flow.lanes},selectedList:function(e){return e.flow.selectedList},flowModel:function(e){return e.flow.flowModel}})),created:function(){},mounted:function(){this.reset(),this.init()},methods:Object(c["a"])(Object(c["a"])({toPx:S["i"],verifySub:S["j"],reset:function(){var e=this.$refs.ds_page;this.$store.commit("flow/setPage",{width:e.clientWidth,height:e.clientHeight})},init:function(){var e=this;return Object(r["a"])(l.a.mark((function t(){return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.initData();case 2:e.loadElement(),e.initEvent();case 4:case"end":return t.stop()}}),t)})))()},initData:function(){var e=this,t={sID:this.sID};return Object.assign(t,this.$route.query),this.$http.get("wfm/getWFDefinition",t).then(function(){var t=Object(r["a"])(l.a.mark((function t(n){var i,o,s,a,r,c,d;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=n.data,c={BaseInfo:{ID:"",Name:"",Version:"0.0.0001",TimeLimit:{Type:"",Value:""},Desc:"",Event:{onStart:"",onClose:"",onForceClose:"",onExSend:"",onDestory:""},Vendor:{ID:"",Name:""}},NodeList:[],LineList:[],EventList:[],LaneList:{horizontal:[],vertical:[]},ElementList:[]},e.flowInfo=(null===r||void 0===r||null===(i=r.data)||void 0===i?void 0:i.WorkFlow)||c,t.next=5,e.getProperties("flow");case 5:return d=t.sent,e.flow={attributes:Object.assign(Object(S["b"])(d),e.flowInfo)},t.next=9,Object(S["h"])("line");case 9:e.setFlowModel((null===r||void 0===r||null===(o=r.data)||void 0===o?void 0:o.flowModel)||(null===r||void 0===r||null===(s=r.data)||void 0===s||null===(a=s.WorkFlow)||void 0===a?void 0:a.flowModel)||"normal");case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){e.flowInfo={}}))},loadElement:function(){var e=this,t=this.flowInfo&&this.flowInfo.ElementList||[];if(t&&t.length>0)for(var n=0;n<t.length;n++){var i=t[n];if("node"==i.nodeType)(function(){var t=i;t.in=t.in||[],t.out=t.out||[],t.point.x=parseFloat(t.point.x),t.point.y=parseFloat(t.point.y),t=Object.assign({x:t.point.x,y:t.point.y},t),z["e"].forEach((function(e){e.data.forEach((function(e){t.attributes.BaseInfo.Type==e.type&&(t.attributes.BaseInfo.Type=e.name)}))}));var n=e.addNode(t);if(t.nodes){var o=t.nodes;n.nodes=[],n.lines=[],n.events=[],o.forEach((function(t){t=Object.assign({x:t.point.x,y:t.point.y},t),n.nodes.push(e.addSubNode(t,n))}))}t.events&&t.events.forEach((function(e){var i=new D["a"](e);i.parentNode=t,n.events.push(i)})),t.lines&&t.lines.forEach((function(n){n.linkInfo&&(n.linkInfo.fromOffset=parseFloat(n.linkInfo.fromOffset),n.linkInfo.toOffset=parseFloat(n.linkInfo.toOffset)),n.parentNodeId=t.id,setTimeout((function(){e.$bus.$emit("addLine".concat(t.id),n)}),0)})),e.nodes.push(n)})();else if("line"==i.nodeType){var o=i;o.linkInfo&&(o.linkInfo.fromOffset=parseFloat(o.linkInfo.fromOffset),o.linkInfo.toOffset=parseFloat(o.linkInfo.toOffset)),this.$bus.$emit("addLine",o)}else if("lane"==i.nodeType){var s=i;this.createLane({id:s.id,name:s.name,size:s.size,index:s.index,direction:s.direction,attributes:s.attributes})}else"event"==i.nodeType&&this.events.push(new D["a"](i))}this.resize()},setFlowModel:function(e){var t=this;this.$store.commit("flow/setFlowModel",e),this.nodes.forEach((function(n){n.reset(e),t.$bus.$emit("nodeMove",n)}))},getSaveData:function(){this.flow.attributes.BaseInfo.ID=this.sID;var e={WorkFlow:{BaseInfo:this.flow.attributes.BaseInfo,NodeList:[],LineList:[],EventList:[],LaneList:{horizontal:[],vertical:[]},ElementList:[],flowModel:this.flowModel}};"systematic"===this.flowModel&&(e.sImgData=this.printImageUrl),this.nodes.forEach((function(e){if(e.lines){var t=dsf.mix(!0,[],e.lines);e.lines=t.map((function(e){return delete e.paper,e}))}e.events&&(e.events=e.events.map((function(e){return e.parentNodeId=e.parentNode.id,delete e.parentNode,Object(c["a"])({},e)})))}));for(var t={nodes:Object(s["a"])(JSON.parse(JSON.stringify(this.nodes))),lanes:Object(c["a"])({},this.lanes),lines:Object(s["a"])(this.lines),events:Object(s["a"])(this.events)},n=dsf.mix(!0,{},t),i=(this.getFlowAllObjectMap(n),[]),o=0;o<i.length;o++)for(var a=n.lines.length-1;a>=0;a--)n.lines[a].attributes.ID==i[o]&&n.lines.splice(a,1);for(var l=function(i){var o=n.nodes[i];o.nodes&&o.nodes.forEach((function(e){delete e.isRender,delete e.edit})),z["e"].forEach((function(e){e.data.forEach((function(e){o.attributes.BaseInfo.Type==e.name&&(o.attributes.BaseInfo.Type=e.type)}))}));var s=o.point.y,a=0;o.attributes.BaseInfo.StageID="",o.attributes.BaseInfo.CLaneID="";for(var l=0;l<t.lanes.horizontal.length;l++){var r=t.lanes.horizontal[l];if(a+=parseInt(r.size),s<a){o.attributes.BaseInfo.StageID=r.id,o.attributes.BaseInfo.CLaneID=r.id;break}}var c=o.point.x,d=0;o.attributes.BaseInfo.LLaneID="";for(var u=0;u<t.lanes.vertical.length;u++){var h=t.lanes.vertical[u];if(d+=parseInt(h.size),c<d){o.attributes.BaseInfo.LLaneID=h.id;break}}e.WorkFlow.NodeList.push(o.attributes),o.nodeType="node",e.WorkFlow.ElementList.push(o)},r=0;r<n.nodes.length;r++)l(r);for(var d=0;d<n.lines.length;d++){var u=n.lines[d];delete u.paper,e.WorkFlow.LineList.push(u.attributes),delete u.arrowEnd,delete u.isRender,u.nodeType="line",e.WorkFlow.ElementList.push(u)}for(var h=0;h<n.events.length;h++){var f=n.events[h];e.WorkFlow.EventList.push(f.attributes),f.nodeType="event",e.WorkFlow.ElementList.push(f)}for(var p=0;p<t.lanes.horizontal.length;p++){var v=t.lanes.horizontal[p],g=Object(S["a"])(v);delete g.isRender,e.WorkFlow.LaneList.horizontal.push(v.attributes),g.nodeType="lane",e.WorkFlow.ElementList.push(g)}for(var b=0;b<t.lanes.vertical.length;b++){var m=t.lanes.vertical[b],y=Object(S["a"])(m);delete y.isRender,e.WorkFlow.LaneList.vertical.push(m.attributes),y.nodeType="lane",e.WorkFlow.ElementList.push(y)}return e},doSave:function(){this.saveFlow()},saveFlow:function(){var e=this.getSaveData(),t={sData:JSON.stringify(e)};Object.assign(t,{sID:this.$route.query.id},this.$route.query),this.$http.post("wfm/saveWFDefinition",t).done((function(e){e.success?dsf.layer.message("保存成功",!0):dsf.layer.message("保存失败",!1)})).error((function(){dsf.layer.message("保存失败",!1)}))},initEvent:function(){var e=this;document.addEventListener("dragover",(function(t){e.dragNode&&(e.hasMoved=!0,e.isCtrlKey=t.ctrlKey,e.dragToolOver(t)),e.dragEvent&&e.dragEventOver(t),e.dragAttach&&e.dragAttachedOver(t)})),document.addEventListener("dragend",(function(t){!e.hasMoved&&e.dragNode&&(e.dragNode&&document.body.removeChild(e.dragNode),e.dragNode=null,e.$bus.$emit("isMoveNode",!1),e.hasMoved=!1),e.dragNode&&(e.dragToolEnd(t),e.hasMoved=!1),e.dragEvent&&(e.dragEventEnd(t),e.dragEvent&&document.body.removeChild(e.dragEvent),e.dragEvent=null,e.cloneObj=null,e.crashNode=null,e.$bus.$emit("endMoveEvent",!0)),e.dragAttach&&(e.dragAttachedEnd(t),e.dragAttach&&document.body.removeChild(e.dragAttach),e.dragAttach=null,e.cloneObj=null,e.crashNode=null,e.$bus.$emit("endMoveEvent",!0))})),this.$bus.$on("update-baseLine",(function(t){e.baseLine=t})),this.$bus.$on("update-checked",(function(t){e.checked=t||e.flow})),this.$bus.$on("parentAutoScroll",this.parentAutoScroll),this.$bus.$on("autoScroll",this.autoScroll),this.$bus.$on("resize",this.resize),this.$bus.$on("dragCloneEvent",this.dragCloneEvent),this.$bus.$on("dragCloneAttached",this.dragCloneAttached),this.$bus.$on("dragNode",this.dragTool),this.$bus.$on("startGlobalMove",this.startGlobalMove),this.$bus.$on("startCopyNodes",this.startCopyNodes),this.$bus.$on("deleteLine",this.deleteLine),this.$bus.$on("initSubNode",this.initSubNode),document.addEventListener("keydown",this.keydown),window.onresize=function(){e.reset(),e.resize()},this.$refs.root.addEventListener("mousedown",(function(t){var n,i,o,s;e.selectedList;if("svg"===(null===t||void 0===t||null===(n=t.target)||void 0===n?void 0:n.tagName)&&-1===(null===t||void 0===t||null===(i=t.target)||void 0===i||null===(o=i.parentNode)||void 0===o||null===(s=o.parentElement)||void 0===s?void 0:s.className.indexOf("subprocess"))){e.checked=e.flow,e.lines.forEach((function(e){e.edit.isEdit=!1,e.edit.editName=!1})),e.$bus.$emit("selectGlobal",null),e.isGlobalSelect=!0;var a=e.$store.getters["flow/getSvgOffset"],l=e.$store.getters["flow/getMousePointByCanvas"]({x:t.pageX,y:t.pageY});e.selectGlobalPos={x:l.x+a.left,y:l.y+a.top}}})),this.$refs.root.addEventListener("mousemove",(function(t){e.readOnly||(e.setCursor(t),e.isGlobalPosMove&&e.globalMove(t),e.isGlobalSelect&&e.selectGlobalMove(t),e.isCopyNodes&&e.nodesMove(t))})),document.addEventListener("mouseup",(function(t){e.isGlobalPosMove&&(e.isGlobalPosMove=!1,e.globalPos=null,e.resize(),e.$store.commit("flow/clearPoints")),e.isGlobalSelect&&(e.selectGlobalEnd(t),e.resize(),e.$store.commit("flow/clearPoints")),e.isCopyNodes&&e.nodesMoveEnd(t)})),this.$refs.ds_page.addEventListener("wheel",this.scrollwheel,!0),document.addEventListener("copy",(function(t){e.selectedList.length>0&&e.documentCopy(t)})),document.addEventListener("paste",(function(t){e.ctrlCopyNodes&&e.pasteNode(t)}))},initSubNode:function(e,t){var n=this;e.open.show=!0,e.lines&&e.lines.forEach((function(e){e.remove()})),this.$set(e,"nodes",[]),this.$set(e,"lines",[]),this.$set(e,"events",[]),t.forEach((function(t){if("node"==t.nodeType)Object.assign(t,{x:t.point.x,y:t.point.y}),e.nodes.push(n.addSubNode(t,e));else if("line"==t.nodeType){var i=t;i.linkInfo&&(i.linkInfo.fromOffset=parseFloat(i.linkInfo.fromOffset),i.linkInfo.toOffset=parseFloat(i.linkInfo.toOffset)),setTimeout((function(){n.$bus.$emit("addLine".concat(e.id),{id:i.id,type:i.type,name:i.name,path:i.path,from:i.from,fromType:i.fromType,to:i.to,linkInfo:i.linkInfo,attributes:i.attributes,parentNodeId:e.id})}),0)}else if("event"==t.nodeType){var o=new D["a"](t);o.parentNode=e,newNode.events.push(o)}})),this.nodeResize(e)},copyNewNode:function(e,t,n,i){var o,s;null===e||void 0===e||null===(o=e.dataTransfer)||void 0===o||null===(s=o.setDragImage)||void 0===s||s.call(o,new Image,0,0);var a=e.target||e,l=a.cloneNode(!0);return l.setAttribute("draggable",!0),l.offset={x:n?n.x:0,y:n?n.y:0},i&&(l.copyNode=t),i||102!==t.type||(l.tool=t),l.className=l.className+" drag_nodeOuter "+this.flowModel,Object.assign(l.style,{position:"absolute",zIndex:9999,top:this.toPx(e.pageY-((t.padding||0)+l.offset.y)*this.scale),left:this.toPx(e.pageX-((t.padding||0)+l.offset.x)*this.scale),pointerEvents:"none",cursor:"move",transform:"scale(".concat(this.scale,") translateZ(0px)"),transformOrigin:"left top"}),document.body.appendChild(l),this.$bus.$emit("isMoveNode",i?l.copyNode:l),l},startCopyNodes:function(e){this.isCopyNodes=!0,this.copyNodesPos={x:e.pageX,y:e.pageY}},createCopyNodes:function(e){var t=this,n=this.selectedList||null;n&&n.length>1&&(this.copyNodes=[],n.forEach((function(e){var n=document.querySelector('.nodeOuter[data-id="'.concat(e.id,'"]')),i={x:e.point.x*t.scale,y:e.point.y*t.scale},o=t.$store.getters["flow/getMousePointByPoint"](i);n.pageX=o.x,n.pageY=o.y;var s=t.copyNewNode(n,e,null,!0);s.point=o,t.copyNodes.push(s)})))},dragTool:function(e,t,n,i){var o;n=null!==(o=n)&&void 0!==o?o:{x:e.offsetX-(this.page.left/2-j["f"].width-this.page.left/2*.05)/2,y:e.offsetY-this.page.left/2*.05},this.dragNode=this.copyNewNode(e,t,n,i)},getDisplacement:function(e){var t={x:e.pageX,y:e.pageY},n=Object(S["c"])(this.copyNodesPos),i=Object(S["c"])(t);return{x:i.x-n.x,y:i.y-n.y}},nodesMove:function(e){var t=this,n=this.getDisplacement(e);(!this.copyNodes||this.copyNodes&&0===this.copyNodes.length)&&(Math.abs(n.x)>5||Math.abs(n.y)>5)&&this.createCopyNodes(e),this.copyNodes.forEach((function(e){e.copyNode;var i=e.offset,o={x:e.point.x+n.x-i.x*t.scale,y:e.point.y+n.y-i.y*t.scale};e.style.top=t.toPx(o.y),e.style.left=t.toPx(o.x)})),this.isCtrlKey=e.ctrlKey},dragToolOver:function(e){var t,n=this.dragNode,i=n.offset;n.style.top=this.toPx(e.pageY-i.y*this.scale),n.style.left=this.toPx(e.pageX-i.x*this.scale);var o=n.copyNode;if(this.endTarget=this.getTargetIsNodes(e.target,o||n.tool),this.endTarget){var s=this.endTarget&&this.endTarget.className;if((null===s||void 0===s||null===(t=s.indexOf)||void 0===t?void 0:t.call(s,"nodes isSub"))>-1){var a=Object(S["f"])(this.nodes,this.endTarget);this.$bus.$emit("dragToSubNode",o!==a?a:null)}else this.$bus.$emit("dragToSubNode",null);o&&this.$bus.$emit("moveCopyNode".concat(o.parentNodeId||""),e,o)}},getTargetIsNodes:function(e,t){var n,i,o,s=document.querySelector(".svgRoot");if(!s.contains(e))return null;if(t&&"102"==t.type&&(null===e||void 0===e||null===(i=e.className)||void 0===i||null===(o=i.indexOf)||void 0===o?void 0:o.call(i,"nodes isSub"))>-1)return this.getTargetIsNodes(null===e||void 0===e?void 0:e.parentElement);return(null===e||void 0===e||null===(n=e.className)||void 0===n?void 0:n.indexOf("nodes"))>-1?e:this.getTargetIsNodes(null===e||void 0===e?void 0:e.parentElement)},getBeforeCopyLine:function(e){var t=this,n=[];e.forEach((function(e){n=[].concat(Object(s["a"])(n),Object(s["a"])(e.out),Object(s["a"])(e.in))})),n=Object(s["a"])(new Set(n));var i=[],o=[],a=[];return n.forEach((function(n){var s=Object(S["d"])(t.lines,n);if(s){var l;l="event"===s.fromType?Object(S["d"])(t.events,s.from):Object(S["d"])(e,s.from);var r=Object(S["d"])(e,s.to);if(l&&r){var c=Object(S["a"])(s);c.id=j["i"].uuid(),i.push({line:c,nodeId:l.id}),o.push({line:c,nodeId:r.id}),a.push(c)}}})),{fromNodeIds:i,toNodeIds:o,newLines:a}},resetLineFromAndTo:function(e,t,n,i){e.length>0&&e.forEach((function(e){e.nodeId===i.id&&(n.in.push(e.line.id),e.line.from=n.id)})),t.length>0&&t.forEach((function(e){e.nodeId===i.id&&(n.out.push(e.line.id),e.line.to=n.id)}))},copyEventsLines:function(e){var t=this;e.forEach((function(e){if("event"===e.fromType){var n=Object(S["d"])(t.events,e.from,"fromId");n?(delete n.fromId,e.from=n.id):e.from=null}e.from&&e.to&&t.$bus.$emit("addLine",{id:e.id,type:e.type,name:e.name,from:e.from,fromType:e.fromType,to:e.to,linkInfo:e.linkInfo})}))},nodesMoveEnd:function(e){var t=this;if(this.copyNodes&&this.copyNodes.length>0){var n,i=this.copyNodes.map((function(e){return e.copyNode})),o=this.getBeforeCopyLine(i),s=o.fromNodeIds,a=o.toNodeIds,l=o.newLines,r=this.getDisplacement(e),c=[];this.copyNodes.forEach((function(e){var i=e.copyNode,o=(e.offset,{pageX:e.point.x+r.x,pageY:e.point.y+r.y}),l=t.nodeMoveEnd(o,e);l.id===i.id?n=!0:t.resetLineFromAndTo(s,a,l,i),t.checked=l,c.push(l)})),n||this.copyEventsLines(l),this.$store.commit("flow/setSelectedList",c)}this.isCopyNodes=!1,this.copyNodesPos=null,this.copyNodes=[],this.$bus.$emit("isMoveNode",!1)},nodeMoveEnd:function(e,t){var n,i,o,s,a=t&&t.copyNode,l=t.offset;if(a)if(a.parentNodeId)this.deleteNode(a),delete a.id,delete a.parentNodeId,delete a.point,i=Object.assign(a,{x:e.pageX-l.x*this.scale>a.padding?e.pageX-l.x*this.scale:a.padding,y:e.pageY-l.y*this.scale>a.padding?e.pageY-l.y*this.scale:a.padding,mouseConvert:!0});else{var r=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX-l.x*this.scale,y:e.pageY-l.y*this.scale}),c=r;if(c={x:c.x>a.padding?c.x:a.padding,y:c.y>a.padding?c.y:a.padding},this.isCtrlKey){s=a.id;var d=j["i"].uuid(),u=JSON.parse(JSON.stringify(a));i=Object.assign({},u,{id:d,out:[],in:[],x:c.x,y:c.y}),i.attributes.BaseInfo.ID=d}else c={x:c.x/this.scale,y:c.y/this.scale},c=Object(S["c"])(c),a.point.x=c.x,a.point.y=c.y,this.$bus.$emit("nodeMove",a),o=!0}if(!o){var h=e.target&&e.target.getAttribute("nodetype"),f=e.target&&e.target.getAttribute("sort");i=i||{type:h,sort:f,x:e.pageX-l.x*this.scale,y:e.pageY-l.y*this.scale,mouseConvert:!0},n=this.copyNodeNext(i,s,a)}return document.body.removeChild(t),this.resize(),o?a:n},copyNodeNext:function(e,t,n){var i=this,o=this.addNode(e);return this.nodes.push(o),t&&this.copyNodeEvent(t,o),n&&n.nodes&&n.nodes.length>0&&(o.nodes=[],n.nodes.forEach((function(e){var t=Object(S["a"])(e),n=Object.assign({x:t.point.x,y:t.point.y},t);o.nodes.push(i.addSubNode(n,o))}))),o},dragToolEnd:function(e){if(this.endTarget){var t,n,i=this.endTarget&&this.endTarget.className,o=Object(S["f"])(this.nodes,this.endTarget);if((null===i||void 0===i||null===(t=i.indexOf)||void 0===t?void 0:t.call(i,"nodes isSub"))>-1&&!this.verifySub(o)){if(o){var s,a;if(this.dragNode&&this.dragNode.copyNode){var l=this.dragNode.copyNode,r=this.dragNode.offset;if(!l.parentNodeId||l.parentNodeId&&l.parentNodeId!==o.id)s=Object.assign(l,{x:e.pageX-r.x*this.scale>l.padding?e.pageX-r.x*this.scale:l.padding,y:e.pageY-r.y*this.scale>l.padding?e.pageY-r.y*this.scale:l.padding,mouseConvert:!0}),this.deleteNode(l),delete l.id;else{s={x:e.pageX-r.x*this.scale,y:e.pageY-r.y*this.scale,mouseConvert:!0};var c=this.getOptions(s);l.point.x=c.x-o.point.x,l.point.y=c.y-o.point.y-o.imgHeight-2*o.padding,this.$bus.$emit("nodeMove".concat(l.parentNodeId),l),this.$bus.$emit("cutOffLine".concat(l.parentNodeId),l),a=!0}}if(!a){var d=e.target&&e.target.getAttribute("nodetype"),u=e.target&&e.target.getAttribute("sort");s=s||{type:d,sort:u,x:e.pageX,y:e.pageY,mouseConvert:!0};var h=this.addSubNode(s,o);o.nodes?o.nodes.push(h):this.$set(o,"nodes",[h]),this.$set(o,"lines",o.lines||[]),this.$set(o,"events",o.events||[]),this.nodeResize(o),this.$bus.$emit("cutOffLine".concat(h.parentNodeId),h)}}document.body.removeChild(this.dragNode)}else((null===i||void 0===i?void 0:i.indexOf("nodes"))>-1||(null===i||void 0===i||null===(n=i.indexOf)||void 0===n?void 0:n.call(i,"nodes isSub"))>-1&&this.verifySub(o))&&(this.checked=this.nodeMoveEnd(e,this.dragNode),this.$bus.$emit("cutOffLine",this.checked),this.$store.commit("flow/setSelectedList",[this.checked]))}else document.body.removeChild(this.dragNode);this.dragNode=null,this.$bus.$emit("isMoveNode",!1)},createDragNode:function(e,t){var n,i;null===e||void 0===e||null===(n=e.dataTransfer)||void 0===n||null===(i=n.setDragImage)||void 0===i||i.call(n,new Image,0,0);var o=e.target.cloneNode(!0);o.className="ds_tool_event_drag",o.setAttribute("draggable",!1),o.offset={x:e.offsetX,y:e.offsetY};var s=Object(S["a"])(t);return this.cloneObj=new D["a"](s,e),Object.assign(o.style,{position:"absolute",zIndex:9999,width:this.toPx(this.cloneObj.width),height:this.toPx(this.cloneObj.height),top:this.toPx(e.pageY-e.offsetY),left:this.toPx(e.pageX-e.offsetX),pointerEvents:"none",transform:"scale(".concat(this.scale,") translateZ(0px)"),transformOrigin:"left top"}),document.body.appendChild(o),o},commonDragOver:function(e,t){if(e.dataTransfer.dropEffect="copy",t){var n,i,o,s,a=t.offset,l=this.computedPoint(e,t);if((null===(n=Array.from(null===e||void 0===e||null===(i=e.target)||void 0===i?void 0:i.classList))||void 0===n?void 0:n.indexOf("task-node"))>-1||null!==(o=Array.from(null===e||void 0===e||null===(s=e.target)||void 0===s?void 0:s.parentElement))&&void 0!==o&&o.indexOf("node")){var r=Object(S["e"])(this.nodes,"nodes",e.target);if(r&&!this.verifySub(r.parent)){var c,d=r.parent,u=r.sub;this.crashNode=u,c="boundaryEvent"===this.cloneObj.sort&&"task"!==u.sort?[]:this.$store.getters["flow/getPoints"](u.id),c||(this.$store.commit("flow/setPointsByNode",{node:u,obj:this.cloneObj}),c=this.$store.getters["flow/getPoints"](u.id));var h={point:{x:l.point.x-d.point.x*this.scale,y:l.point.y-(d.point.y+d.padding+d.imgHeight+2*d.padding)*this.scale}},f=this.getPoint(h,c,this.distance);if(f){this.cloneObj=Object.assign(this.cloneObj,f,{parentNode:d});var p=this.$store.getters["flow/getMousePointByPoint"](f.point);return p.x=p.x+d.point.x*this.scale,p.y=p.y+(d.point.y+d.imgHeight+2*d.padding)*this.scale,t.style.top=this.toPx(p.y),void(t.style.left=this.toPx(p.x))}}var v=Object(S["f"])(this.nodes,e.target);if(v){var g;this.crashNode=v,g="boundaryEvent"===this.cloneObj.sort&&"task"!==v.sort?[]:this.$store.getters["flow/getPoints"](v.id),g||(this.$store.commit("flow/setPointsByNode",{node:v,obj:this.cloneObj}),g=this.$store.getters["flow/getPoints"](v.id));var b=this.getPoint(l,g,this.distance);if(b){this.cloneObj=Object.assign(this.cloneObj,b);var m=this.$store.getters["flow/getMousePointByPoint"](b.point);return t.style.top=this.toPx(m.y),void(t.style.left=this.toPx(m.x))}}}this.crashNode=null,t.style.top=this.toPx(e.pageY-a.x*this.scale),t.style.left=this.toPx(e.pageX-a.x*this.scale)}},commonDragEnd:function(e){var t,n=this;if("drop"===e.type?(e=event||e,e.preventDefault()):event.touches&&(e=event.touches[0]?event.touches[0]:event),this.crashNode){var i=null!==(t=this.$store.getters["flow/getPoints"](this.crashNode.id))&&void 0!==t?t:[],o=this.computedPoint(e,this.cloneObj);if(this.cloneObj.parentNode){var s=this.cloneObj.parentNode;o={point:{x:o.point.x-s.point.x*this.scale,y:o.point.y-(s.point.y+s.padding+s.imgHeight+2*s.padding)*this.scale}}}var a=this.getPoint(o,i,this.distance);if(a){if(i.splice(null===i||void 0===i?void 0:i.indexOf(a),1),this.cloneObj.from){var l=this.cloneObj.parentNode?this.cloneObj.parentNode.events:this.events;l.forEach((function(e){e.id===n.cloneObj.from&&n.$store.commit("flow/addPoint",{id:n.cloneObj.nodeId,obj:{point:{x:e.point.x,y:e.point.y},index:e.index,direction:e.direction}})})),this.deleteEvent(this.cloneObj.from,l),this.cloneObj.id=this.cloneObj.from,delete this.cloneObj.from}this.cloneObj=Object.assign(this.cloneObj,a),this.cloneObj.point.x=this.cloneObj.point.x/this.scale,this.cloneObj.point.y=this.cloneObj.point.y/this.scale,this.cloneObj.nodeId=this.crashNode.id,this.checked=this.cloneObj,this.cloneObj.out&&this.cloneObj.out.length>0&&this.$bus.$emit("eventMove".concat(this.cloneObj.parentNode?this.cloneObj.parentNode.id:""),this.cloneObj)}}},dragBoundaryEvent:function(e,t){this.dragEvent=this.createDragNode(e,t),this.$bus.$emit("startMoveEvent",this.dragEvent)},dragEventOver:function(e){this.commonDragOver(e,this.dragEvent)},dragEventEnd:function(e){this.commonDragEnd(e),this.crashNode&&this.addNewEvent(this.cloneObj)},addNewEvent:function(e){e.parentNode?this.nodes.forEach((function(t){e.parentNode&&e.parentNode.id===t.id&&t.events.push(e)})):this.events.push(e)},dragAttached:function(e,t){var n=Object(S["a"])(t);n.name="mark"===t.type?"A":1,this.dragAttach=this.createDragNode(e,n),this.$bus.$emit("startMoveEvent",this.cloneObj)},dragAttachedOver:function(e){this.commonDragOver(e,this.dragAttach)},dragAttachedEnd:function(e){this.commonDragEnd(e),this.crashNode&&this.addNewEvent(this.cloneObj)},dragCloneEvent:function(e,t){var n=Object(S["a"])(t);n.from=t.id,n.id=j["i"].uuid(),this.dragBoundaryEvent(e,n)},dragLineProperty:function(e,t){var n=Object(S["a"])(t);n.from=t.id,n.id=j["i"].uuid(),this.dragBoundaryEvent(e,n)},copyNodeEvent:function(e,t){var n=this,i=[];if(this.events.forEach((function(t){t.nodeId===e&&i.push(Object(S["a"])(t))})),0!==i.length){this.$store.commit("flow/setPointsByNode",{node:t,obj:i[0]});var o=this.$store.getters["flow/getPoints"](t.id);o.forEach((function(e){i.forEach((function(i){i.direction===e.direction&&i.index===e.index&&(i.fromId=i.id,i.id=j["i"].uuid(),i.point=e.point,i.nodeId=t.id,n.addNewEvent(i))}))}))}},getPoint:function(e,t,n){var i,o=this,s=0;return t.forEach((function(t){var a=o.getDistance(t,e);a<=n&&s<a&&(s=a,i=t)})),i},getDistance:function(e,t){var n=Math.sqrt(Math.pow(e.point.x-t.point.x,2)+Math.pow(e.point.y-t.point.y,2));return n},computedPoint:function(e,t){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});return{point:Object(S["c"])(n)}},getOptions:function(e){var t=Object.assign({id:j["i"].uuid(),type:1},e),n={x:t.x||0,y:t.y||0};if(1==t.mouseConvert){var i=this.$store.getters["flow/getMousePointByCanvas"]({x:t.x,y:t.y});n.x=i.x,n.y=i.y}return n=Object(S["c"])(n),t.x=n.x/this.scale,t.y=n.y/this.scale,t},addNode:function(e){var t=this.getOptions(e),n=t.type;t.name||102==n||(t.order=this.nodes.length+1),t.name=t.name||("201"===n?"开始":"299"===n?"结束":"")||"新建环节"+this.nodes.length;var i=new L["a"](t);return i.reset(this.flowModel),i},addSubNode:function(e,t){var n=this.getOptions(e);n.name=n.name||"新建环节"+(t.nodes&&t.nodes.length||0),1==n.mouseConvert&&(n.x=n.x-t.point.x,n.y=n.y-t.point.y-t.imgHeight-2*t.padding);var i=new L["a"](n);return i.parentNodeId=t.id,i},showSubNode:function(e){},keydown:function(e){var t=this;if((!this.checked||!this.checked.readOnly)&&46==e.keyCode){var n=this.selectedList||null;if(n&&n.length>1)n.forEach((function(e){setTimeout((function(){t.deleteNode(e)}),0)}));else if(this.checked instanceof L["a"])this.deleteNode(this.checked,!0);else if(this.checked instanceof C)this.$store.commit("flow/deleteLane",this.checked),this.resize();else if(this.checked instanceof M["a"])this.deleteLine(this.checked,!0);else if(this.checked instanceof D["a"]){var i=this.checked;"risk"===i.type||"mark"===i.type?dsf.layer.confirm({title:"",message:"确认删除？"}).then((function(){t.deleteEventAndLines(i)})).catch((function(){})):this.deleteEventAndLines(i)}this.checked={}}},deleteEventAndLines:function(e){for(var t=e["out"].length-1;t>=0;t--){var n=Object(S["d"])(this.lines,e["out"][t]);n&&this.deleteLine(n)}var i=e.parentNode?e.parentNode.events:this.events;this.deleteEvent(e.id,i,!0)},deleteNode:function(e,t){var n,i=this;if(!(e.parentNodeId&&(n=this.nodes.find((function(t){return e.parentNodeId===t.id})),t&&this.verifySub(n)))){var o=e.parentNodeId?n.nodes:this.nodes,s=e.parentNodeId?n.lines:this.lines,a=e.parentNodeId?n.events:this.events,l=null===o||void 0===o?void 0:o.indexOf(e);if(l>-1){var r=e;r.in.length>0&&r.out.length>0&&r.in.forEach((function(t){var n=Object(S["d"])(s,t);if(n){var a=Object(S["d"])(o,n.from);r.out.forEach((function(t){var l=Object(S["d"])(s,t);if(l){var r=Object(S["d"])(o,l.to);if(a===r)return;var c=j["i"].uuid(),d={endPoint:l.path[l.path.length-1],fromDirection:n.linkInfo.fromDirection,fromNode:a,startPoint:n.path[0],targetDirection:l.linkInfo.toDirection,targetNode:r},u=Object(se["a"])(d),h={id:c,type:n.type,name:a.name+"→"+r.name,path:u,from:n.from,fromType:n.fromType,isHide:n.isHide,to:l.to,linkInfo:{fromDirection:n.linkInfo.fromDirection,fromOffset:n.linkInfo.fromOffset,toDirection:l.linkInfo.toDirection,toOffset:l.linkInfo.toOffset},attributes:Object.assign(n.attributes,{BaseInfo:{EndNodeID:l.to,ID:c,Name:a.name+"→"+r.name,StartNodeID:n.from}})};e.parentNodeId&&(h.parentNodeId=e.parentNodeId),i.$bus.$emit("addLine".concat(e.parentNodeId||""),h)}}))}}));for(var c=r.out.length-1;c>=0;c--){var d=Object(S["d"])(s,r.out[c]);d&&this.deleteLine(d)}for(var u=r.in.length-1;u>=0;u--){var h=Object(S["d"])(s,r.in[u]);h&&this.deleteLine(h)}for(var f=0;f<a.length;f++){var p=a[f].nodeId;if(p===r.id){for(var v=a[f],g=v.out.length-1;g>=0;g--){var b=Object(S["d"])(this.lines,v.out[g]);b&&this.deleteLine(b)}a.splice(f,1),f--}}o.splice(l,1)}}},deleteLine:function(e,t){var n;if(!(e.parentNodeId&&(n=this.nodes.find((function(t){return e.parentNodeId===t.id})),t&&this.verifySub(n)))){e.remove();var i=e.parentNodeId?n.nodes:this.nodes,o=e.parentNodeId?n.lines:this.lines,s=null===o||void 0===o?void 0:o.indexOf(e);s>-1&&this.deleteFromOrOut(i,o,e,s)}},deleteFromOrOut:function(e,t,n,i){var o=Object(S["d"])(e,n.from),s=Object(S["d"])(e,n.to);if(o){var a,l=null===(a=o["out"])||void 0===a?void 0:a.indexOf(n.id);l>=0&&o["out"].splice(l,1)}if(s){var r,c=null===(r=s["in"])||void 0===r?void 0:r.indexOf(n.id);c>=0&&s["in"].splice(c,1)}t.splice(i,1),this.$bus.$emit("updateIntersection")},deleteEvent:function(e,t,n){var i=(t||this.events).findIndex((function(t){return t.id===e}));i>-1&&(t||this.events).splice(i,1),this.$store.commit("flow/addPoint",{id:this.checked.nodeId,obj:{point:{x:this.checked.point.x,y:this.checked.point.y},index:this.checked.index,direction:this.checked.direction}})},addLane:function(e,t){this.createLane({direction:e,index:t})},createLane:function(e){var t=e.direction;e.name=e.name||"泳道"+(this.lanes[t].length+1),e.id=e.id||j["i"].uuid();var n=new C(e),i=this.lanes[t][(e.index||this.lanes[t].length)-1];t==j["a"].vertical?n.left=i?i.size+i.left:0:n.top=i?i.size+i.top:0,this.$store.commit("flow/addLane",{direction:t,lane:n,index:e.index}),this.resize()},onScroll:function(e){var t=e.target;this.$store.commit("flow/setSvgRoot",{scrollTop:t.scrollTop,scrollLeft:t.scrollLeft})},getFromNodes:function(e){if(!e["in"]||e["in"].length<=0)return null;for(var t=[],n=0;n<e["in"].length;n++){var i=e["in"][n],o=Object(S["d"])(this.lines,i);if(o){var s=Object(S["d"])(this.nodes,o.from);t.push(s)}}return t},getToNodes:function(e){if(!e["out"]||e["out"].length<=0)return null;for(var t=[],n=0;n<e["out"].length;n++){var i=e["out"][n],o=Object(S["d"])(this.lines,i);if(o){var s=Object(S["d"])(this.nodes,o.to);t.push(s)}}return t},getFlowAllObjectMap:function(e){for(var t={},n=0;n<e.nodes.length;n++){var i=e.nodes[n];t[i.id]=i}for(var o=0;o<e.lines.length;o++){var s=e.lines[o];t[s.id]=s}for(var a=0;a<e.lanes.horizontal.length;a++){var l=e.lanes.horizontal[a];t[l.id]=l}for(var r=0;r<e.lanes.vertical.length;r++){l=e.lanes.vertical[r];t[l.id]=l}return t},drawLine:function(){this.isDrawLine=!this.isDrawLine},resize:function(){var e=this.page.width,t=this.page.height,n=e||0,i=t||0,o=this.lanes.vertical[this.lanes.vertical.length-1],s=this.$store.getters["flow/lanesWidth"];o&&o.size+o.left+s>n?this.width=o.size+o.left+s:this.width=e;var a=this.lanes.horizontal[this.lanes.horizontal.length-1],l=this.$store.getters["flow/lanesHeight"];a&&a.size+a.top+l>i?this.height=a.size+a.top+l:this.height=t;var r=0,c=0;this.nodes.forEach((function(e){e.width+e.point.x+2*e.padding>r&&(r=e.width+e.point.x+2*e.padding),e.height+e.point.y+2*e.padding+20>c&&(c=e.height+e.point.y+2*e.padding+20)})),this.width=this.width>r?this.width:r,this.height=this.height>c?this.height:c},nodeResize:function(e){var t=0,n=0;e.nodes.forEach((function(i){i.width+i.point.x+2*i.padding>t&&(t=i.width+i.point.x+2*i.padding),i.height+i.point.y+2*i.padding+20+e.imgHeight+2*e.padding>n&&(n=i.height+i.point.y+2*i.padding+20+e.imgHeight+2*e.padding)})),e.width=e.width>t?e.width:t,e.height=e.height>n?e.height:n,this.$bus.$emit("nodeMove",e)},autoScroll:function(e){var t=null,n=e.type;"node"==n?(t=e.point,e.mouse.x>this.width/2?t.x=t.x+e.data.width+this.maxSizeOffset:t.x=t.x,e.mouse.y>this.height/2?t.y=t.y+e.data.height+this.maxSizeOffset:t.y=t.y):"line"==n?(t=this.$store.getters["flow/getMousePointByCanvas"]({x:e.mouse.x,y:e.mouse.y}),e.mouse.x>this.width/2?t.x=t.x+this.maxSizeOffset:t.x=t.x-this.maxSizeOffset,e.mouse.y>this.height/2?t.y=t.y+this.maxSizeOffset:t.y=t.y-this.maxSizeOffset):"lane"==n&&(t=this.$store.getters["flow/getMousePointByCanvas"]({x:e.mouse.x,y:e.mouse.y}),e.mouse.x>this.width/2?t.x=t.x+this.maxSizeOffset:t.x=t.x,e.mouse.y>this.height/2?t.y=t.y+this.maxSizeOffset:t.y=t.y);var i,o,s,a=this.$refs.ds_page;a&&(t.x<a.scrollLeft&&(i=Math.abs(a.scrollLeft-t.x),o=a.scrollLeft,a.scrollLeft=o-i/3),t.y<a.scrollTop&&(i=Math.abs(a.scrollTop-t.y),s=a.scrollTop,a.scrollTop=s-i/3),t.h<a.scrollTop&&(i=Math.abs(a.scrollLeft-t.x),o=a.scrollLeft,a.scrollLeft=o-i/3),t.x>a.clientWidth+a.scrollLeft&&(this.width=t.x,i=Math.abs(a.clientWidth+a.scrollLeft-t.x),o=a.scrollLeft,a.scrollLeft=o+i/3),t.y>a.clientHeight+a.scrollTop&&(this.height=t.y,i=Math.abs(a.clientHeight+a.scrollTop-t.y),s=a.scrollTop,a.scrollTop=s+i/3))},parentAutoScroll:function(e){var t=e.mouse,n=e.point,i=e.parent,o=e.node;n.x>i.width+i.point.x?n.x=n.x+o.width+this.maxSizeOffset:n.x=n.x,n.y>i.height+i.point.y?n.y=n.y+o.height+this.maxSizeOffset:n.y=n.y,n.x>i.width+0&&(i.width=n.x),n.y>i.height+0&&(i.height=n.y),this.$bus.$emit("nodeMove",i),this.autoScroll({type:"node",data:i,mouse:{x:t.x,y:t.y},point:{x:n.x,y:n.y}})},setCursor:function(e){if("svg"!=e.target.tagName){e.target.className;if("path"==e.target.tagName){var t=Object(S["g"])(e.target);if(t){var n=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});t.type==j["d"].horizontal?0==t.index&&Math.abs(t.sp.x-n.x)<=this.dragSize||t.isLast&&Math.abs(t.ep.x-n.x)<=this.dragSize?this.setRootCursor("move"):this.setRootCursor("ns-resize"):0==t.index&&Math.abs(t.sp.y-n.y)<=this.dragSize||t.isLast&&Math.abs(t.ep.y-n.y)<=this.dragSize?this.setRootCursor("move"):this.setRootCursor("ew-resize")}}}else this.setRootCursor("default")},setRootCursor:function(e){this.$refs.root.style.cursor=e},startGlobalMove:function(e){this.isGlobalPosMove=!0,this.globalPos=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY}),this.globalMoveLastMouse={x:e.pageX,y:e.pageY},this.globalRect=this.getRect()},globalMove:function(e){if(this.isGlobalPosMove){var t={x:e.pageX,y:e.pageY},n=Object(S["c"])(this.globalMoveLastMouse),i=Object(S["c"])(t),o={x:i.x-n.x,y:i.y-n.y};Number.MIN_VALUE,Number.MIN_VALUE;if(0==o.x&&0==o.y)return!1;var s=!1,a=!1;return this.globalRect.x+o.x>0&&(this.globalRect.x+=o.x,s=!0),this.globalRect.y+o.y>=0&&(this.globalRect.y+=o.y,a=!0),this.$bus.$emit("globalMove",o,s,a,e),void(this.globalMoveLastMouse=i)}},getRect:function(){for(var e=Number.MAX_VALUE,t=Number.MAX_VALUE,n=Number.MIN_VALUE,i=Number.MIN_VALUE,o=0;o<this.nodes.length;o++){var s=this.nodes[o];s.point.x<e&&(e=s.point.x),s.point.x+s.width>n&&(n=s.point.x+s.width),s.point.y<t&&(t=s.point.y),s.point.y+s.height>i&&(i=s.point.y+s.height)}for(var a=0;a<this.lines.length;a++)for(var l=this.lines[a],r=0;r<l.path.length;r++)l.path[r].x<e&&(e=l.path[r].x),l.path[r].x>n&&(n=l.path[r].x),l.path[r].y<t&&(t=l.path[r].y),l.path[r].y>i&&(i=l.path[r].y);return{x:e,y:t,width:n,height:i}},getWheelDirect:function(e){var t;return e=e||window.event,e.wheelDelta?(e.wheelDelta>0&&(t="up"),e.wheelDelta<0&&(t="down")):e.detail&&(e.detail>0&&(t="up"),e.detail<0&&(t="down")),t},scrollwheel:function(e){if(e=e||window.event,e.wheelDelta&&e.ctrlKey){e.preventDefault();var t=this.getWheelDirect(e);this.rootScale(t)}},rootScale:function(e){var t=1;t=Number("up"===e?(this.scale+.05<2?this.scale+.05:2).toFixed(2):(this.scale>.4?this.scale-.05:.4).toFixed(2)),this.$store.commit("flow/setPage",{scale:t}),this.$store.commit("flow/clearPoints")},selectGlobalMove:function(e){if(this.globalSelect||(this.globalSelect=document.createElement("div"),this.globalSelect.className="select-nodes",Object.assign(this.globalSelect.style,{zIndex:9999,transform:"translate3d(".concat(this.selectGlobalPos.x/this.scale,"px, ").concat(this.selectGlobalPos.y/this.scale,"px, 0)"),pointerEvents:"none"}),this.$refs.root.appendChild(this.globalSelect)),this.selectGlobalPos){var t,n,i,o,s=this.selectGlobalPos,a=this.$store.getters["flow/getSvgOffset"],l=this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY}),r={x:l.x+a.left,y:l.y+a.top};r.x>s.x?(n=s.x,i=r.x-s.x):(n=r.x,i=s.x-r.x),r.y>s.y?(t=s.y,o=r.y-s.y):(t=r.y,o=s.y-r.y),this.selectGlobalPonits.start.x=n/this.scale,this.selectGlobalPonits.start.y=t/this.scale,this.selectGlobalPonits.end.x=(n+i)/this.scale,this.selectGlobalPonits.end.y=(t+o)/this.scale,Object.assign(this.globalSelect.style,{transform:"translate3d(".concat(n/this.scale,"px, ").concat(t/this.scale,"px, 0)"),width:this.toPx(i/this.scale),height:this.toPx(o/this.scale)})}},selectGlobalEnd:function(e){if(this.isGlobalSelect=!1,this.globalSelect){this.$store.getters["flow/getMousePointByCanvas"]({x:e.pageX,y:e.pageY});this.$bus.$emit("selectGlobal",this.selectGlobalPonits.start,this.selectGlobalPonits.end),this.$refs.root.removeChild(this.globalSelect),this.globalSelect=null}},documentCopy:function(e){var t=this.selectedList;t&&t.length>1?this.ctrlCopyNodes=Object(s["a"])(t):this.ctrlCopyNodes=[this.checked]},pasteNode:function(e){var t=this;if(!this.ctrlCopyNodes)return!1;var n=[],i=this.getBeforeCopyLine(this.ctrlCopyNodes),o=i.fromNodeIds,s=i.toNodeIds,a=i.newLines;this.ctrlCopyNodes.forEach((function(e){var i=e,a=i.id,l=j["i"].uuid(),r=JSON.parse(JSON.stringify(i)),c=Object.assign({},r,{id:j["i"].uuid(),out:[],in:[],x:i.point.x+10,y:i.point.y+10});c.attributes.BaseInfo.ID=l;var d=t.copyNodeNext(c,a,i);t.resetLineFromAndTo(o,s,d,i),n.push(d),t.checked=d})),this.copyEventsLines(a),this.ctrlCopyNodes=n,this.$store.commit("flow/setSelectedList",n)},toPrintImage:function(e,t){var n=this;return Object(r["a"])(l.a.mark((function i(){var o,s;return l.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return i.next=2,n.html2canvas();case 2:o=i.sent,e?n.printImageUrl=o:(s=document.createElement("a"),s.download=n.flowInfo.BaseInfo.Name+".png",s.href=o,n.$nextTick((function(){s.click()}))),setTimeout((function(){t&&n.hideNodes(t,!1),e&&n.$nextTick((function(){n.saveFlow()})),n.isPrintImage=!1}),300);case 5:case"end":return i.stop()}}),i)})))()},html2canvas:function(){var e=this.page,t=this.scale>1?this.width*this.scale:this.width/this.scale,n=this.scale>1?this.height*this.scale:this.height/this.scale;return le()(this.$refs.container,{useCORS:!0,x:e.left,y:e.top,width:t,height:n}).then((function(e){var t=e.toDataURL("image/png",1);return t}))},printImage:function(e){var t=this;if(0!==this.nodes.length){this.isPrintImage=!0;var n={nodes:this.nodes,value:[]};dsf.layer.openDialog({title:"选择需要隐藏的节点",width:"400px",height:"266px",overflow:"auto",content:"SumStartNode",params:n,btns:[{text:"确定",handler:function(){var n=Object(r["a"])(l.a.mark((function n(i){var o;return l.a.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(o=i.getContent(),!(o.length>0)){n.next=5;break}return t.hideNodes(o,!0),t.toPrintImage(e,o),n.abrupt("return");case 5:t.toPrintImage(e);case 6:case"end":return n.stop()}}),n)})));function i(e){return n.apply(this,arguments)}return i}()},{text:"取消"}]})}else this.toPrintImage(e)},hideNodes:function(e,t){var n=this,i=[];e.forEach((function(e){n.nodes.forEach((function(n){n.id===e&&(n.isHide=t,i=[].concat(Object(s["a"])(n.in),Object(s["a"])(n.out)))})),n.events.forEach((function(n){n.nodeId===e&&(n.isHide=t,i=[].concat(Object(s["a"])(i),Object(s["a"])(n.out)))}))})),i.length>0&&this.$bus.$emit("hideLines",i,t)}},k),{},{getProperties:S["h"]})},ce=re,de=(n(980),Object(F["a"])(ce,i,o,!1,null,null,null));de.options.__file="designer/flow/flow.vue";t["default"]=de.exports}}]);
//# sourceMappingURL=dsf-platform.Flow.js.map